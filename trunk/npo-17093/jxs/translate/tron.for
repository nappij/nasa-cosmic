      PROGRAM TRON
C
C     THIS PROGRAM WILL TRANSLATE A CODEV LENS DECK TO AN ACCOSV LENS DECK
C     USING A FILE GENERATED BY THE CODEV COMMANDS `PRI` AND `ANA`.
C
C     SECONDLY, THIS PROGRAM WILL TRANSLATE AN ACCOSV LENS DECK TO A CODEV
C     LENS DECK USING A FILE GENERATED BY THE ACCOSV COMMANDS `LEPRT`
C     AND `PXTY ALL`.
C     USER WILL BE PROMPTED FOR NAME OF FILE TO BE TRANSLATED.
C     NEW FILE NAME IS LENS.
C
C     AUTHOR: LAUREL WOOLEY
C             UNIVERSITY OF ROCHESTER
C             WRITTEN UNDER CONTRACT TO JET PROPULSION LABORATORY, OPERATED
C             BY CALIFORNIA INSTITUTE OF TECHNOLOGY FOR NASA
C
C     QUESTIONS, COMMMENTS, CORRECTIONS:
C             CONTACT JOHN E. STACY
C                     M.S. 169-314
C                     JET PROPULSION LABORATORY
C                     4800 OAK GROVE DRIVE
C                     PASADENA, CA 91109
C                     (818)354-2313
C
C     NO WARRANTIES, EXPRESS OR IMPLIED, ARE MADE FOR THIS PROGRAM WITH
C     RESPECT TO FITNESS FOR ANY PARTICULAR APPLICATION OR USE.
C
C**************************************************************************
C**  COMMON BLOCK CODEV DECLARATIONS
      CHARACTER*4 DIM,APERT(225)
      INTEGER*4 ICCY(0:225),ITHC(0:225),IGLC(0:225),IWTW1,IWTW2,IWTW3
      INTEGER*4 IWTW4,IWTW5,IWTW6,IWTW7,ICCX(30),KC(66),IAC(66),IBC(66)
      INTEGER*4 ICC(66),IDC(66),IXDC(100),IYDC(100),IADC(100),IBDC(100)
      INTEGER*4 ICDC(100),ICCF(66)
      REAL*4 ORDER(66),WLF1,WLF2,WLF3,WLF4,WLF5,WLF6,WLF7
      REAL*4 F(225),AL(66),AM(66),AN(66)
      REAL*8 RFND1(20),RFND2(20),RFND3(20),RFND4(20),RFND5(20)
C**  COMMON BLOCK BOTH DECLARATIONS
      CHARACTER*4 SOLVE(40)
      CHARACTER*13 GLASS(0:225)
      CHARACTER*64 TITLE
      INTEGER*4 I1,I2,I3,I4,I5,I6,I7,I8,I9,I10,M,ISTOP,IREF,ISURF
      INTEGER*4 NAPERT(225),NDECE(100),NSOLVE(40),NUMA,MESSAGE(20)
      REAL*4 DIF(66)
      REAL*8 ADE(100),BDE(100),CDE(100),XDE(100),YDE(100),CURVEY(0:225)
      REAL*8 THICKNS(0:225),RK(66),A(66),B(66),C(66),D(66),SOLVF1(40)
      REAL*8 F1(225)
      LOGICAL AFO,IC(66),CUF(66)
C**  COMMON BLOCK ACCOSV DECLARATIONS
      CHARACTER*6 UNITS
      INTEGER*4 IORDER(66),IWT1,IWT2,IWT3,IWT4,IWT5
      REAL*4 WVW1,WVW2,WVW3,WVW4,WVW5,WT1,WT2,WT3,WT4,WT5,THETA(66)
      REAL*4 RN1
      REAL*8 N1(20),N2(20),N3(20),N4(20),N5(20),F2(225)
C** COMMON BLOCK CAONLY DECLARATIONS
      CHARACTER*3 SURFMES(20),SOLVE1(40),SOLVE2(40)
      CHARACTER*4 TYPE(66)
      CHARACTER*13 CATALOG(20),MATRL(20),GL(0:225)
      CHARACTER*24 SUBMES4(20)
      INTEGER*4 NTYPE(66),NRETUT(100),NRETUF(100),IPKCV1(200)
      INTEGER*4 IPKAD1(200),IPKAD2(200),IPKAE1(200),IPKAE2(200)
      INTEGER*4 IPKAF1(200),IPKAF2(200),IPKAG1(200),IPKAG2(200)
      INTEGER*4 IPKA1(200),IPKA2(200),IPKB1(200),IPKB2(200),IPKG1(200)
      INTEGER*4 IPKG2(200),IPKX1(200),IPKX2(200),IPKY1(200),IPKY2(200)
      INTEGER*4 IPKGL1(200),IPKGL2(200),IPKTH1(200),IPKTH2(200)
      INTEGER*4 IPKCC1(200),IPKCC2(200),ICCA(200),ICVA(200),ITHA(200)
      INTEGER*4 IGLA(200),IAEA(200),IAFA(200),IAGA(200),IADA(200)
      INTEGER*4 IXA(200),IYA(200),IAA(200),IBA(200),IGA(200),J1,J2,J3
      INTEGER*4 J4,J5,J6,J7,J8,J9,JE,JF,JG,JD,JX,JY,JA,JB,JM
      INTEGER*4 INDICE(225),ICIR(225),IRECT(225),IELIP(225),ICOCYF(20)
      INTEGER*4 ICOCYT(20),ICOCXF(20),ICOCXT(20),TILT(66),RTILT(66)
      INTEGER*4 RDECE(100),MESNUM(20),IPKCV2(200)
      REAL*4 WL1(20),WL2(20),WL3(20),WL4(20),WL5(20),WL6(20),WL7(20)
      REAL*4 TWL1(20),TWL2(20),TWL3(20),TWL4(20),TWL5(20)
      REAL*4 CATWL1(20),CATWL2(20),CATWL3(20),CATWL4(20),CATWL5(20)
      REAL*4 CATWL6(20),CATWL7(20),W1(20),W2(20),W3(20),W4(20),W5(20)
      REAL*4 IND1(20),IND2(20),IND3(20),IND4(20),IND5(20),TIND1(20)
      REAL*4 TIND2(20),TIND3(20),TIND4(20),TIND5(20)
C UMARG WAS DECLARED TWICE HERE FOR SOME REASON. BBC 9/84.
      REAL*8 UMARG,YMARG,UCHIEF,CUX(30),RADE(100),RBDE(100)
      REAL*8 RCDE(100),RXDE(100),RYDE(100)
      LOGICAL VIGNET,TEL,RETURN(100),ZMFLAG
C**  COMMON BLOCK ACONLY DECLARATIONS
      CHARACTER*4 TORIC(10),COMMAND(100),PIKUP(200),SHAPE(225),CASE(10)
      CHARACTER*4 SPECSF(225)
      CHARACTER*36 SUBMES1(20)
      CHARACTER*40 SUBMES2(20)
      CHARACTER*48 SUBMES3(20)
      INTEGER*4 INDEX(20),NTORIC(10),NCASE(10),NUMBER(10),IPIKTO(200)
      INTEGER*4 IPIKFR(200),NASP(66),J10,K1,NGRT(10),NSHAPE(225)
      REAL*4 PIKA(200),DDIST(10),RNUMBER(10),RIC1(225),RIC2(225)
      REAL*4 RCUF1(225),RCUF2(225)
      REAL*8 TCVR(10),PY,PUCY,RADIUS(0:225),PIKB(200),NAO,YAN
      LOGICAL OB(225)
C** LOCAL DECLARATIONS
      CHARACTER*1 FLAG1
C VAX USES 9 CHAR FOR FILENAME, 1 FOR SEPARATOR, AND 3 FOR TYPE. BBC 9/84.
      CHARACTER*13 NAME		
      CHARACTER*110 LINE
      LOGICAL CVFILE
C
      COMMON /CODEV/DIM,APERT,ICCY,ITHC,IGLC,IWTW1,IWTW2,IWTW3,IWTW4,
     *        IWTW5,IWTW6,ILWTW7,ICCX,KC,IAC,IBC,ICC,IDC,ORDER,IXDC,
     *        IYDC,IADC,IBDC,ICDC,ICCF,WLF1,WLF2,WLF3,WLF4,WLF5,WLF6,
     *        WLF7,RFND1,RFND2,RFND3,RFND4,RFND5,F,AL,AM,AN
      COMMON /BOTH/I1,I2,I3,I4,I5,I6,I7,I8,I9,I10,GLASS,MESSAGE,M,
     *        ISTOP,IREF,ISURF,AFO,NAPERT,NDECE,F1,DIF,ADE,BDE,CDE,XDE,
     *        YDE,CURVEY,THICKNS,RK,A,B,C,D,IC,CUF,NSOLVE,SOLVF1,SOLVE,
     *        TITLE,NUMA
      COMMON /ACCOSV/IORDER,WVW1,WVW2,WVW3,WVW4,WVW5,WT1,WT2,WT3,WT4,
     *        WT5,IWT1,IWT2,IWT3,IWT4,IWT5,THETA,F2,RN1,UNITS,N1,
     *        N2,N3,N4,N5
      COMMON /CAONLY/UMARG,YMARG,UCHIEF,YCHIEF,TYPE,NTYPE,NRETUT,
     *        NRETUF,CATWL1,CATWL2,CATWL3,CATWL4,CATWL5,CATWL6,CATWL7,
     *        CUX,VIGNET,TEL,RETURN,MATRL,SOLVE1,SOLVE2,ZMFLAG,SURFMES,
     *        CATALOG,WL1,WL2,WL3,WL4,WL5,WL6,WL7,IND1,IND2,IND3,IN4,
     *        IND5,TWL1,TWL2,TWL3,TWL4,TWL5,TIND1,TIND2,TIND3,TIND4,
     *        TIND5,GL,IPKCV1,IPKCV2,IPKAD1,IPKAD2,IPKAE1,IPKAE2,
     *        IPKAF1,IPKAF2,IPKAG1,IPKAG2,IPKA1,IPKA2,IPKB1,IPKB2,
     *        IPKG1,IPKG2,IPKX1,IPKX2,IPKY1,IPKY2,IPKTH1,IPKTH2,IPKCC1,
     *        IPKCC2,ICCA,ICVA,ITHA,IGLA,IAEA,IAFA,IAGA,IADA,IXA,IYA,
     *        IAA,IBA,IGA,J1,J2,J3,J4,J5,J6,J7,J8,J9,JE,JF,JG,JD,JX,JY,
     *        JA,JB,JM,INDICE,ICIR,IRECT,IELIP,ICOCYF,ICOCYT,ICOCXF,
     *        ICOCXT,TILT,RTILT,W1,W2,W3,W4,W5,RDECE,RADE,RBDE,RCDE,
     *        RXDE,RYDE,MESNUM,SUBMES4
      COMMON /ACONLY/TCVR,PY,PUCY,INDEX,NTORIC,DDIST,SUBMES1,SUBMES2,
     *        SUBMES3,TORIC,NCASE,COMMAND,NUMBER,RADIUS,PIKA,PIKB,
     *        IPIKTO,IPIKFR,PIKUP,SHAPE,CASE,NASP,OB,SPECSF,NAO,YAN,
     *        J10,K1,NGRT,RIC1,RIC2,RCUF1,RCUF2,RNUMBER,NSHAPE
C
C     OPEN(UNIT=1)	! VAX DOES NOT NEED TO DEFINE SYSTEM OUTPUT. BBC 9/84.
C
C*****FORMAT STATEMENTS
 1    FORMAT(A1)
 2    FORMAT(A110)
 4    FORMAT(A10)
 6    FORMAT(A55)
C
C*******************************************************************************
C*****INITIALIZE
      CVFILE=.FALSE.
C*******************************************************************************
C     PROMPT USER FOR LENS FILE NAME
C WE DID AWAY WITH THE FANCY TITLE.  BBC 9/84.
      PRINT *, '                ENTER NAME OF FILE TO BE TRANSLATED'
      READ (5,77) NAME		! LOGICAL UNIT 5 IS DEFAULT FOR SYSTEM INPUT.
77    FORMAT (A13)		! 13 CHAR FILENAME MAX.
C*******************************************************************************
C*****MAIN PROGRAM
C
      OPEN(UNIT=6,FILE=NAME,STATUS='OLD')
C*****DETERMINE IF FILE IS CODEV OR ACCOSV DATA
200   READ(6,2,END=800)LINE
      IF (LINE(5:7) .EQ. 'PRI') THEN
        CVFILE=.TRUE.
      ELSE IF (LINE(3:7) .NE. 'LEPRT') THEN
        GOTO 200
      ELSE
        CVFILE=.FALSE.
      END IF
C*****REMOVE BLANKS FROM NAME AND OPEN APPROPRIATE FILE
      I = 14
201   I = I - 1
      IF (I .GT. 0 .AND. NAME(I:I) .NE. '.') GOTO 201
      IF (I .EQ. 0) THEN
	I = 14
202     I = I - 1
	IF (I .GT. 0 .AND. NAME(I:I) .EQ. ' ') GOTO 202
	IF (I .EQ. 0) THEN
	  TYPE *,'INVALID FILENAME. PROGRAM HALT.'
	  CALL EXIT
	END IF
      ELSE
	I = I - 1
      END IF
C VAX REQUIRES THREE CHARACTER FILE TYPES. BBC 9/84.
      IF (CVFILE) THEN
        OPEN(UNIT=5,FILE=NAME(1:I)//'.ACC',STATUS='NEW')
        I=1
      ELSE
        OPEN(UNIT=5,FILE=NAME(1:I)//'.SEQ',STATUS='NEW')
        I=1  ! END LOOP
      END IF
      IF (CVFILE) GOTO 600
C*******************************************************************************
C*****ACCOSV TRANSLATED TO CODEV
C
      CALL DECODE1
      CALL CONVERT1
      CALL OUTPUT1
      GOTO 700
C*******************************************************************************
C*****CODEV TRANSLATED TO ACCOSV
C
C600   CALL DECODE2
C      CALL CONVERT2
C      CALL OUTPUT2
C
C*******************************************************************************
C
600   GOTO 700
800   PRINT *, 'FILE CONTAINS UNACCEPTABLE DATA.  PROGRAM ABORTED.'
700   END FILE(5)
      CLOSE(UNIT=5)
      CLOSE(UNIT=6)
      END
