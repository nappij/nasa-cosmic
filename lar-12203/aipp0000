      PROGRAM AIPP (INPUT=64,OUTPUT=64,PUNCH=64,TAPES=64,TAPE5=INPUT,    MAIN        2
     *TAPE6=OUTPUT,TAPE7=PUNCH,TAPE3=64,TAPE4=64,TAPE8=64,TAPE9=64,      MAIN        3
     *TAPE10=64,TAPE11,TAPE12,TAPE13)                                    11AUG       2
C     ****************************************************************** MAIN        5
C     **  ATMOSPHERIC INTERACTION PLUME PROGRAM        5/1/74         ** MAIN        6
C     **          AEROCHEM RESEARCH LABORATORIES, INC.                ** MAIN        7
C     **                    PRINCETON, NEW JERSEY   O8540             ** MAIN        8
C     ****************************************************************** MAIN        9
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      DIMENSION ID(20)                                                   MAIN       11
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    MAIN       12
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         MAIN       13
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        MAIN       14
     * ,      MAP                                                        MAIN       15
      REAL MASSMD,L1,L2,LBAR                                             MAIN       16
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  MAIN       17
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          MAIN       18
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      MAIN       19
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       MAIN       20
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    MAIN       21
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      MAIN       22
     1 ,SUMP,SUMPV,SUMPE                                                 MAIN       23
      COMMON/MAINSH/ KOUNT,KINT                                          MAIN       24
      COMMON/IBUGS1/ IBUGSH                                              MAIN       25
      COMMON/CHEM1/ ZID(5), IRR(30),IRT(30),RC(30,3),IRRR(30,5),         MAIN       26
     1 AV,CM(21,21),FI(21),WP(21),                                       MAIN       27
     2 WM(21),WDOT(21,30),CSI(21),QX(21)                                 MAIN       28
      COMMON/INTL/XLX,IKI,REX                                            MAIN       29
      COMMON/INPUX/ITD,X0,Y0,FRAC  ,KFL                                  MAIN       30
      COMMON/SHOPUT/ XSHW,RSHW,PSIW,PSHW,TSHW,USHW,CSHW(20)              MAIN       31
      COMMON/INSHOP/ POO,TOO,UOO,PHOO,COO(20)                            MAIN       32
      COMMON/XLM/XLMD                                                    MAIN       33
      COMMON/DMD/KMNF                                                    MAIN       34
      COMMON/SUB/XDIS,L1,L2,PHIO,RSTAR,RMD,MASSMD,RNOZ,THTP,THRU         MAIN       35
      COMMON/DSL/RDSL,PHDSL,XINIT                                        MAIN       36
      COMMON/TRIPLE/DEL1,PP1,TT1,UU1,TH3,PP3,TT3,UU3,SLANG,SHANG         MAIN       37
      COMMON/TURPLE/DEL2,CPSHW,GAMSHW,ZMWSH1                             MAIN       38
      COMMON/UTPP/PSH11,TSH11,USH11,FLANG,CSH11(20)                      MAIN       39
      INTEGER THRU                                                       MAIN       40
      DIMENSION ERROR(3)                                                 MAIN       41
      EQUIVALENCE (MOVE,IEXTRA(15))                                      MAIN       42
      EQUIVALENCE (KALARM, IEXTRA(20))                                   MAIN       43
      DATA ERROR / 4HMAIN,4HBDRY,4HSTEP /                                MAIN       44
C     SETTING UP THE PROBLEM                                             MAIN       45
C     REVISED SUBSCRIPTS (ZEROS DELETED)                                 MAIN       46
      WRITE(6,150)                                                       MAIN       47
  150 FORMAT(1H1,//////////40X,*ATMOSPHERIC INTERACTION PLUME PROGRAM*,  MAIN       48
     1 ///40X,*AEROCHEM RESEARCH LABORATORIES, INC.*,/45X,               MAIN       49
     2 *PRINCETON, NEW JERSEY 08540*,/////45X,*REVISED - JUNE 7,1974*)   MAIN       50
      IDATA=0                                                            MAIN       51
      JTEST=0                                                            11AUG       3
      READ(5,50) NDATA,EGSF1,EGSF2                                       11AUG       4
  261 CONTINUE                                                           MAIN       53
      READ (5,9966) (ID(I), I=1,20)                                      MAIN       54
      WRITE (6,9967) (ID(I),I=1,20)                                      MAIN       55
 9966 FORMAT (20A4)                                                      MAIN       56
 9967 FORMAT (1H1,20A4)                                                  MAIN       57
      WRITE(6,51) NDATA,EGSF1,EGSF2                                      11AUG       5
   51 FORMAT(1H0,/10X,17HNO. OF DATA SETS ,I5,6X,6HEGSF1=,F6.2,6X,       11AUG       6
     16HEGSF2=,F6.2)                                                     11AUG       7
      DO 5 I=1,7300                                                      MAIN       60
    5 A(I,1)=0.0                                                         MAIN       61
      BETAP=1.013E06                                                     MAIN       62
      HJ=4.182E07                                                        MAIN       63
      RCON=1.9871                                                        MAIN       64
      KALARM=0                                                           MAIN       65
      KOUNT=0                                                            MAIN       66
      KINT=0                                                             MAIN       67
      LL=-1                                                              MAIN       68
      READ (5,50) NSEC,DXLSS,XLMAX,XLMDD,IMD,NNT                         MAIN       69
      WRITE (6,52) NSEC,DXLSS,XLMAX,XLMDD,IMD,NNT                        MAIN       70
   50 FORMAT(I10,3E12.5,2I2)                                             MAIN       71
   52 FORMAT (1H ,4X,5HNSEC=,I5,4X,6HDXLSS=,1PE10.3,4X,6HXLMAX=,E10.3,   MAIN       72
     *  4X,6HXLMDD=,E10.3,4X,4HIMD=,I5,4X,4HNNT=,I5///)                  MAIN       73
      XLMMX=DXLSS                                                        MAIN       74
      FSEC=NSEC                                                          MAIN       75
      TOLD=0.                                                            MAIN       76
       XLMD=1.E10                                                        MAIN       77
      IF (ISB.NE.-1) GO TO 73                                            11AUG       8
      ENDFILE 12                                                         11AUG       9
   73 CONTINUE                                                           11AUG      10
      CALL PUTIN                                                         MAIN       78
      IF (IPART.NE.0) CALL PPUTIN                                        MAIN       79
      IF (IKINE.NE.0) CALL CPUTIN(IDENT,IKINE,NDS)                       MAIN       80
      IF (KMN.GT.1) GO TO 101                                            MAIN       81
      IF(IKIND.LT.3.OR.IKI.NE.0) GO TO 21                                MAIN       82
      CPB=0.0                                                            MAIN       83
      ZMB=0.0                                                            MAIN       84
      DO109 I=1,NDS                                                      MAIN       85
      ZMB=ZMB+CSTREM(I)/MW(I)                                            MAIN       86
  109 CPB=CPB+CSTREM(I)*A(I,3)                                           MAIN       87
      ZMB=1.0/ZMB                                                        MAIN       88
      EMF=USTREM*SQRT((CPB*ZMB-RCON)/(CPB*TSTREM*RU))                    MAIN       89
      PE=0.0                                                             MAIN       90
      EM=0.0                                                             MAIN       91
      DO23 I=2,KMAX                                                      MAIN       92
      EM=EM+MA(I)                                                        MAIN       93
   23 PE=PE+P(I)                                                         MAIN       94
      EM=EM/(KMAX-1)                                                     MAIN       95
      PE=PE/(KMAX-1)                                                     MAIN       96
      IF(IPART.EQ.0) GO TO 25                                            MAIN       97
      RHG=0.0                                                            MAIN       98
      PGM=0.0                                                            MAIN       99
      DO24 I=2,KMAX                                                      MAIN      100
      RHG=RHG+RHO(I)                                                     MAIN      101
      DO24 J=1,NPG                                                       MAIN      102
      N=I-1                                                              MAIN      103
   24 PGM=PGM+RHP2(N,J)                                                  MAIN      104
      PGM=PGM/RHG                                                        MAIN      105
      GO TO 26                                                           MAIN      106
   25 PGM=0.0                                                            MAIN      107
   26 XLMD=REX*1.38*EM*SQRT(GAMA*PE/PSTREM)/(EMF**0.25)                  MAIN      108
C     CARD OMITTED                                                       MAIN      109
    3 FORMAT(E12.5)                                                      MAIN      110
      IF(IKIND.LT.3) XLMD=1.E10                                          MAIN      111
      IF(IMD.NE.0) XLMD=XLMDD                                            MAIN      112
      WRITE(9,3) XLMD                                                    MAIN      113
      WRITE(6,28) XLMD                                                   MAIN      114
   28 FORMAT(//3X,*THE MACH DISC IS LOCATED AT X=*,E11.3,1X,*CM*//)      MAIN      115
      GO TO 106                                                          MAIN      116
   21 IF(ISHOCK.NE.1) GO TO 101                                          MAIN      117
      PENF=PSTREM                                                        MAIN      118
      GAMM=CPB/(CPB-RCON/ZMB)                                            MAIN      119
      EMEX=MA(KMAX)                                                      MAIN      120
      SEMX2=SQRT(EMEX**2-1.0)                                            MAIN      121
      EMF2=EMF**2                                                        MAIN      122
      THN=PHI(KMAX)                                                      MAIN      123
      PEX=P(KMAX)                                                        MAIN      124
      EMB=EMEX*(PEX/PENF)**((GAMA-1.)/GAMA*0.5)                          MAIN      125
      TL=1.E-4*EMB                                                       MAIN      126
      C1=SQRT((GAMA+1.)/(GAMA-1.))                                       MAIN      127
      C3=GAMA/(GAMA-1.)                                                  MAIN      128
      THC=C1*ATAN(SEMX2 /C1)-ATAN(SEMX2 )-THN                            MAIN      129
      DO 104 IT=1,100                                                    MAIN      130
      EMB2=EMB**2                                                        MAIN      131
      SQEMB=SQRT(EMB2-1.0)                                               MAIN      132
      ZTA=C1*ATAN(SQEMB/C1)-ATAN(SQEMB)-THC                              MAIN      133
      PP=PEX*(1.+(GAMA-1.)/2.*EMEX**2)**C3/((1.+(GAMA-1.)/2.*EMB2)**C3)  MAIN      134
      BTA=ASIN (SQRT(1.+(GAMM+1.)/(2.*GAMM)*(PP/PENF-1.))/EMF)           MAIN      135
      SINBTA=SIN(BTA)                                                    MAIN      136
      SNBTA2=SINBTA**2                                                   MAIN      137
      COSBTA=COS(BTA)                                                    MAIN      138
      E=((EMF*SINBTA)**2-1.)/TAN(BTA)/((GAMM+1.)/2.*EMF2-(EMF*SINBTA)    MAIN      139
     1   **2+1.) -TAN(ZTA)                                               MAIN      140
      DNOM=(GAMM+1.)/2.*EMF2  -(EMF*SINBTA  )**2+1.0                     MAIN      141
      DZMB=EMB/(SQEMB*(1.+(EMB2-1.)/C1**2))-1./(EMB*SQEMB)               MAIN      142
      DPB=-PP*EMB/(1+(GAMA-1.)/2.*EMB2)*GAMA                             MAIN      143
      DBTA=(GAMM+1.)/(4.*GAMM*EMF2*SINBTA*COSBTA)*DPB                    MAIN      144
      DHDMB=-DZMB/((COS(ZTA))**2)+         ((-((EMF*SINBTA  )**2-1.)*DBT MAIN      145
     1A/(SNBTA2)+2.*(EMF*COSBTA)**2*DBTA)/DNOM+((EMF*SINBTA)*            MAIN      146
     2*2-1.)*2.*(EMF*COSBTA  )**2*DBTA/DNOM**2)                          MAIN      147
      IF (ABS( E) .LT. TL ) GO TO 107                                    MAIN      148
      EMB=EMB-E/DHDMB                                                    MAIN      149
  104 CONTINUE                                                           MAIN      150
      WRITE (6,108)   IT,E,DHDMB,EMB,ZTA,BTA,PP                          MAIN      151
  108 FORMAT(8X,27HITERATION DOES NOT CONVERGE ,I4/2X,6E12.5)            MAIN      152
  107 CONTINUE                                                           MAIN      153
      PSI=BTA                                                            MAIN      154
      PSH=PP                                                             MAIN      155
      RSH=R(KMAX)                                                        MAIN      156
      XSH=X(KMAX)                                                        MAIN      157
      GM1=(GAMM+1.)/(GAMM-1.)                                            MAIN      158
      TSH=TSTREM*(PP/PENF+GM1)      /                                    MAIN      159
     1 (   GM1+PENF/PP)                                                  MAIN      160
      UN=(PP/PENF+GM1)/(GM1*PP/PENF+1.)*USTREM*SINBTA                    MAIN      161
      USH=SQRT((USTREM*COSBTA  )**2+UN**2)                               MAIN      162
  106 CONTINUE                                                           MAIN      163
  101 KMX2= KMX+2                                                        MAIN      164
      ICONT=0                                                            MAIN      165
      INTGER=ALPHAP                                                      MAIN      166
      NUCASE=0                                                           MAIN      167
      IERROR=0                                                           MAIN      168
      LL=0                                                               MAIN      169
      S=0.0                                                              MAIN      170
      XLX=1.0E5                                                          MAIN      171
      SPDY=0.0                                                           MAIN      172
      IKK=0                                                              MAIN      173
      LINT=0                                                             MAIN      174
      SLED=(1.0E-8)*REX                                                  MAIN      175
C     ESTABLISHING STABLE STEP SIZE                                      MAIN      176
 200  CALL SECOND(TIME)                                                  21OCT       1
      TLEFT=FSEC-TIME                                                    MAIN      178
      TSTEP=TIME-TOLD                                                    MAIN      179
      IF (LL.LE.0) GO TO 205                                             MAIN      180
      IF (TSTEP.GT.(0.5*TLEFT)) GO TO 210                                MAIN      181
  205 TOLD=TIME                                                          MAIN      182
      CALL STABLE                                                        MAIN      183
      ICOUNT=0                                                           MAIN      184
      MOVE=0                                                             MAIN      185
      IF((LL.GT.LPLANE).OR.(X(2).GT.XLMAX)) GO TO 247                    MAIN      186
      IF((X2(1).GE.XLMD).AND.(ISHOCK.NE.4).AND.(KMN.EQ.0).AND.(ISB.NE.1) MAIN      187
     1) GO TO 206                                                        MAIN      188
      IF ((X2(1).LT.XLMD).OR.(KMN.GE.1).OR.(ISB.EQ.1))                   29JUNE      1
     1GO TO 250                                                          MAIN      190
      WRITE(6,982) XSHW,XLMD                                             MAIN      191
  982 FORMAT(/5X,E10.3,2X,E10.3)                                         MAIN      192
      WRITE(6,983) DEL2,P2(2),T2(2),U2(2),RHO2(2),ZMWK(2)                MAIN      193
  983 FORMAT(/5X,6E10.3)                                                 MAIN      194
C                                                                        MAIN      195
C.....COMPUTING PROPERTIES IN SUBSONIC AND SUPERSONIC REGIONS            MAIN      196
C     DOWNSTREAM OF TRIPLE POINT AND WRITING ON TAPE4 FOR INPUT IN       MAIN      197
C     SS REGION CALCULATIONS.                                            MAIN      198
      ICONST=1                                                           MAIN      199
      CALL TRIPLE                                                        MAIN      200
      WRITE(4,232) (CSH11(I), I=1,NDS)                                   MAIN      201
      WRITE(4,233) X2(1),R2(1),P2(2),T2(2),U2(2),PHI2(2)                 MAIN      202
      WRITE(4,232)(C2(I,2),I=1,NDS )                                     MAIN      203
      WRITE(4,234) FLANG,SLANG,PP1,TT1,UU1,SHANG,PP3,TT3,UU3             MAIN      204
232   FORMAT(E10.3)                                                      MAIN      205
  233 FORMAT(6E12.5)                                                     MAIN      206
  234 FORMAT(9E12.5)                                                     MAIN      207
      ITYPE=1                                                            MAIN      208
      ISHOCK=1                                                           MAIN      209
      MMAX=20                                                            MAIN      210
      XST=2.*Y(KMAX)/TAN( ASIN(1./MA(2)))                                MAIN      211
      DO 1126 M=2,19                                                     MAIN      212
      XW(M)=X2(1)+ABS(FLOAT(1-M)/FLOAT(20-M)*R2(1)/TAN(PHI(1)))          11AUG      11
 1126 RW(M)=R2(1) *(FLOAT(20-M))/19.                                     MAIN      214
      XW(1)=X2(1)                                                        MAIN      215
      RW(1)=R2(1)                                                        MAIN      216
      XW(20)=1.E8                                                        MAIN      217
       RW(20)=0.0                                                        MAIN      218
      WRITE(6,650)                                                       MAIN      219
  650 FORMAT(/10X,*###FICTITIOUS WALL COORDINATES FOR CONTINUING SHOCK L MAIN      220
     1AYER SOLUTION DOWNSTREAM OF MACH DISC###*/)                        MAIN      221
      WRITE (6,621)                                                      MAIN      222
      SW(1)=S                                                            18JUNE      2
      SWA=SW(1)                                                          MAIN      224
      PHIW(1)=ATAN((RW(2)-RW(1))/(XW(2)-XW(1)))                          MAIN      225
      M=1                                                                MAIN      226
 3900 M=M+1                                                              MAIN      227
      IF (M-MMAX) 4100,4200,4200                                         MAIN      228
 4100 PHIW(M)=ATAN((RW(M+1)-RW(M-1))/(XW(M+1)-XW(M-1)))                  MAIN      229
      GO TO 4400                                                         MAIN      230
 4200 PHIW(M)=2.0*ATAN((RW(M)-RW(M-1))/(XW(M)-XW(M-1)))                  MAIN      231
      PHIW(M)=PHIW(M)-PHIW(M-1)                                          MAIN      232
 4400 FKW=(SIN(PHIW(M))-SIN(PHIW(M-1)))/(XW(M)-XW(M-1))                  MAIN      233
      IF (ABS(FKW/(XW(M)-XW(M-1)))-1.E-06) 4600,4600,4500                MAIN      234
 4500 DELSWA=(PHIW(M)-PHIW(M-1))/FKW                                     MAIN      235
      GO TO 4700                                                         MAIN      236
 4600 DELSWA=SQRT((XW(M)-XW(M-1))**2+(RW(M)-RW(M-1))**2)                 MAIN      237
 4700 SWA=SWA+DELSWA                                                     MAIN      238
      SW(M)=SWA                                                          MAIN      239
      WRITE (6,620) M,XW(M),RW(M),PHIW(M),PW(M),SW(M)                    MAIN      240
      IF (M-MMAX) 3900,4900,4900                                         MAIN      241
  620 FORMAT (1H ,1X,I2,1X, 6(1PE10.3,5X))                               MAIN      242
  621 FORMAT (1H ,/2X,1HM,2X,2HXW,13X,2HRW,13X,4HPHIW,11X,2HPW,13X,      MAIN      243
     1  2HSW)                                                            MAIN      244
 4900 XLMD=1.E20                                                         MAIN      245
      IKI=0                                                              MAIN      246
      XLX=X2(2)                                                          MAIN      247
      CALL STABLE                                                        MAIN      248
      GO TO 250                                                          MAIN      249
  210 K=1                                                                MAIN      250
      IF(IFLAG.EQ.0)GO TO 247                                            21OCT       2
      WRITE(7,220)  X(K),R(K),PHI(K)                                     MAIN      251
  220 FORMAT (6E12.5)                                                    MAIN      252
      DO 240 K=2,KMAX                                                    MAIN      253
      WRITE(7,220)  X(K),R(K),PHI(K),P(K),T(K),U(K)                      MAIN      254
      WRITE(7,230)  (C(I,K) ,I=1,NDS)                                    MAIN      255
  230 FORMAT(8E10.3)                                                     MAIN      256
  240 CONTINUE                                                           MAIN      257
      X11=1.E8                                                           MAIN      258
      X22=1.E-4                                                          MAIN      259
      WRITE(7,225)X(1),R(1),X11,R(1),X(KMAX),R(KMAX),X22,R(KMAX)         MAIN      260
  225 FORMAT(2E12.5/2E12.5/2E12.5/2E12.5)                                MAIN      261
      IF(IKIND.LT.4) GO TO 247                                           MAIN      262
      WRITE(7,220)X(KMAX),R(KMAX),PSI,PSH,TSH,USH                        MAIN      263
      WRITE(7,230)(CSTREM(I),I=1,NDS)                                    MAIN      264
      WRITE(7,220) XSTREM,RSTREM,PHSTRM,PSTREM,TSTREM,USTREM             MAIN      265
      WRITE(7,230) (CSTREM(I),I=1,NDS)                                   MAIN      266
      IF(ITYPE.NE.3) GO TO 247                                           MAIN      267
      WRITE(7,220) XSHW,RSHW,PSIW,PSHW,TSHW,USHW                         MAIN      268
      WRITE(7,230)  (CSHW(I),I=1,NDS)                                    MAIN      269
      WRITE(7,220) XOO,ROO,PHOO,POO,TOO,UOO                              MAIN      270
      WRITE(7,230)  (COO(I),I=1,NDS)                                     MAIN      271
      GO TO 247                                                          MAIN      272
C     ..... BEHIND THE MACH DISC CONDITIONS .....                        MAIN      273
  206 IF(IKI.EQ.0) GO TO 211                                             MAIN      274
      WRITE(6,1400)                                                      MAIN      275
      DO 350 K=2,KMAX                                                    MAIN      276
  350 WRITE(6,1401) X2(K),R2(K),RHO2(K),P2(K),T2(K),U2(K),PHI2(K),       MAIN      277
     1MA(K),GAMA,ZMWK(K)                                                 MAIN      278
 1400 FORMAT(//5X,*PROPERTIES UPSTREAM OF THE MACH DISC ARE *//5X,       MAIN      279
     1*X(CM)*,7X,*R(CM)*,7X,*RHO(G/CM3)*,2X,*P(ATM)     T(K)        U(CM MAIN      280
     2/SEC   PHI(RAD)    MA          GAMMA     MOL.WT.*)                 MAIN      281
 1401 FORMAT(5X,10(1PE12.5))                                             18JUNE      3
      KA=K                                                               MAIN      283
      DO 207 K=2,KMAX                                                    MAIN      284
      TL=T2(K)*1.E-4                                                     MAIN      285
      RHOXY=.15                                                          MAIN      286
C     CARD OMITTED                                                       MAIN      287
      RHOY=RHO2(K)/RHOXY                                                 MAIN      288
      DO 40 IT=1,100                                                     MAIN      289
      PY=P2(K)+RHO2(K)*U2(K)**2*(1.-RHOXY)/BETAP                         MAIN      290
      HY=H(K)+U2(K)**2/(2.*HJ)*(1.-RHOXY**2)                             MAIN      291
      TY=T2(K)*PY/P2(K)*RHOXY                                            MAIN      292
      DO 41 ITT=1,100                                                    MAIN      293
      DHYT=0.0                                                           MAIN      294
      HYT=0.0                                                            MAIN      295
      DO 42 I=1,NDS                                                      MAIN      296
      DO 42 JJ=1,NN                                                      MAIN      297
      HYT=HYT+A(I,JJ)*TY   **(JJ-2)*C2(I,K)                              MAIN      298
   42 DHYT=DHYT+A(I,JJ)*FLOAT(JJ-2)*TY   **(JJ-3)*C2(I,K)                MAIN      299
      D=HYT-HY                                                           MAIN      300
      IF(ABS(D).LT.TL) GO TO 43                                          MAIN      301
      TY=TY-D/DHYT                                                       MAIN      302
   41 CONTINUE                                                           MAIN      303
      WRITE(6,44) IT,K,HY,HYT ,DHYT                                      MAIN      304
      STOP                                                               MAIN      305
   43 RHOY1=PY*ZMWK(K)/RV/TY                                             MAIN      306
      IF((ABS(RHOY1/RHOY)-1.) .LT. .001) GO TO 46                        MAIN      307
      RHOY=(RHOY1+RHOY)*.5                                               MAIN      308
      RHOXY=RHO2(K)/RHOY                                                 MAIN      309
   40 CONTINUE                                                           MAIN      310
      WRITE (6,44) IT,K,RHOY,RHOY1,RHOXY                                 MAIN      311
   44   FORMAT(2X,26HITERATIONS DO NOT CONVERGE,/2X,3HIT=,I3,2X,2HK=,I3, MAIN      312
     *2X,3HHY=,E12.5,2X,5HH(K)=,E12.5,2X,5HDHYT=,E12.5)                  MAIN      313
   46 UY=U2(K)*RHO2(K)/RHOY1                                             MAIN      314
C     CARD OMITTED                                                       MAIN      315
C     CARD OMITTED                                                       MAIN      316
C     CARD OMITTED                                                       MAIN      317
  80  IF(K.GT.2) GO TO 65                                                MAIN      318
      WRITE(6,60)                                                        MAIN      319
   60 FORMAT(//10X,*THE MACH DISC HAS BEEN REACHED- POST-NORMAL SHOCK    MAIN      320
     1PROPERTIES ALONG NEXT DOWNSTREAM SURFACE ARE-*//,2X,5HX(CM),       MAIN      321
     28X,5HR(CM),2X,11HRHO(GM/CM3),3X,6HP(ATM),8X,4HT(K),4X,9HU(CM/SEC)  MAIN      322
     3/)                                                                 MAIN      323
   65 WRITE(6,45) X2(K),R2(K),RHOY1,PY,TY,UY                             MAIN      324
   45 FORMAT(6E12.5)                                                     MAIN      325
      IF(K.GT.2) GO TO 207                                               MAIN      326
      WRITE(6,61)                                                        MAIN      327
   61 FORMAT(//10X,*SPECIES MASS FRACTIONS ON THE AXIS AT THE MACH DISC  MAIN      328
     1ARE*/)                                                             MAIN      329
      DO 8002 I=1,NDS                                                    MAIN      330
 8002 WRITE(6,8001) I,C2(I,2)                                            MAIN      331
 8001 FORMAT(10X,*C(*,I2,*)=*,E14.4)                                     MAIN      332
  207 CONTINUE                                                           MAIN      333
      IF(IPART.EQ.0) GO TO 400                                           MAIN      334
      WRITE (6,460)                                                      MAIN      335
  460 FORMAT(//15X,*PARTICLE PROPERTIES AT THE MACH DISC*/)              MAIN      336
      DO 405 K=1,KMAX                                                    MAIN      337
      WRITE (6,450) K                                                    MAIN      338
      WRITE(6,451) (W(K,J),J=1,NPG)                                      MAIN      339
      WRITE (6,452) (V(K,J),J=1,NPG)                                     MAIN      340
      WRITE(6,453) (TP(K,J),J=1,NPG)                                     MAIN      341
      WRITE(6,454) (RHP(K,J),J=1,NPG)                                    MAIN      342
  405 CONTINUE                                                           MAIN      343
  450 FORMAT(//1H , 2HK=,I5/)                                            MAIN      344
  451 FORMAT(1H ,19HDOWNSTREAM VELOCITY ,2X,1P8E12.3)                    MAIN      345
  452 FORMAT(1H ,21HCROSS-STREAM VELOCITY ,1P8E12.3)                     MAIN      346
  453 FORMAT(1H ,20HPARTICLE TEMPERATURE ,1X,1P8E12.3)                   MAIN      347
  454 FORMAT(1H ,16HPARTICLE DENSITY ,5X,1P8E12.3)                       MAIN      348
  400 K=KA                                                               MAIN      349
  247 CONTINUE                                                           MAIN      350
      IF (X2(1).GE.XLMD.AND.ISHOCK.NE.4) GO TO 212                       18JUNE      4
      IDATA=IDATA+1                                                      MAIN      352
      IF (IDATA.LT.NDATA) GO TO 261                                      MAIN      353
      ENDFILE 13                                                         11AUG      12
      CALL EXIT                                                          MAIN      354
  212 LPLANE=LL+30                                                       29JUNE      2
  211 XLMD=1.E20                                                         MAIN      356
  250 IFLAG=0                                                            MAIN      357
      IF (PAR(2).EQ.0.0) GO TO 479                                       11AUG      13
      IPAR2=PAR(2)                                                       11AUG      14
      IF (MOD(LL,IPAR2).EQ.0) WRITE(6,455) LL,X2(2),DELS                 11AUG      15
  455 FORMAT(35X,3HLL=,I5,4X,2HX=,F8.1,4X,10HSTEP SIZE=,E11.4)           11AUG      16
  479 CONTINUE                                                           11AUG      17
      IF(DELS.LT.SLED) GO TO 9961                                        MAIN      358
      L=1                                                                MAIN      359
      IF (ICOUNT.EQ.0) GO TO 270                                         MAIN      360
      S=S-DELSO                                                          MAIN      361
      DELSO=0.5*DELSO                                                    MAIN      362
      IF(KMN.LE.1) GO TO 295                                             MAIN      363
      IF (KARM.EQ.11) DELSO=0.1*DELSO                                    MAIN      364
      KARM=0                                                             MAIN      365
      GO TO 295                                                          MAIN      366
  270 KSM=IEXTRA(7)                                                      MAIN      367
      FCARE=COS(PHI(KSM)-PHI(L))                                         MAIN      368
      IF (FCARE.GT.0.25) GO TO 290                                       MAIN      369
      DELSO=DELS*0.25                                                    MAIN      370
      GO TO 295                                                          MAIN      371
  290 DELSO=DELS*FCARE                                                   MAIN      372
C     INNER BOUDARY OR WALL CONDITIONS                                   MAIN      373
  295 S=S+DELSO                                                          MAIN      374
      DLS(1)=DELSO                                                       MAIN      375
  300 NBOUND=0                                                           MAIN      376
      L=1                                                                MAIN      377
      CALL BNDRY                                                         MAIN      378
      EXTRA(1) = Y(L)                                                    MAIN      379
      EXTRA(2)=R(L)                                                      MAIN      380
      IF(MU.NE.0.0) UM(K-1)=MU                                           MAIN      381
      IF (K.GE.KMAX) GO TO 1000                                          MAIN      382
      IF (NUCASE.NE.0) GO TO 9960                                        MAIN      383
C     CALCULATION OF STREAMLINE CURVATURE                                MAIN      384
  500 SUMPV=0.0                                                          MAIN      385
      SUMP=0.0                                                           MAIN      386
      SUMPE=0.0                                                          MAIN      387
      IF (((K-1).GT.KMX2).OR.(IPART.EQ.0)) GO TO 502                     MAIN      388
      CALL DRAG                                                          MAIN      389
      DO 501 J=1,NPG                                                     MAIN      390
      SUMP=SUMP+XMOMP(J)*RHP(K-1,J)                                      MAIN      391
      SUMPV=SUMPV+ XMOMV(J)*RHP(K-1,J)                                   MAIN      392
      SUMPE=SUMPE+  RHP(K-1,J)*(ENEP1(J)+ENEP2(J))                       MAIN      393
  501 CONTINUE                                                           MAIN      394
  502 IF((KMN.GT.1).AND.(K.LE.KMN)) GO TO 3000                           MAIN      395
      IF (IFLAG.NE.0) GO TO 700                                          MAIN      396
 3070 CONTINUE                                                           18JUNE      5
      DPDY(K)=2.0*(P(K+1)-P(K))/(Y(K+1)-Y(K-1))                          MAIN      397
      DPHIDS(K)=-2.0*(P(K+1)-P(K))/(RHO(K+1)*U(K+1)**2*DELY(K+1)+RHO(K)* MAIN      398
     *U(K)**2*DELY(K))*BETAP                                             MAIN      399
      DPHIDS(K)=DPHIDS(K)+SUMPV*2.0/(RHO(K+1)*U(K+1)**2+RHO(K)*U(K)**2)  MAIN      400
      GO TO 801                                                          MAIN      401
  700 DPDY(K)=2.0*(P2(K+1)-P2(K))/(Y2(K+1)-Y2(K-1))                      MAIN      402
      DPHODS   =-2.0*(P2(K+1)-P2(K))/(RHO2(K+1)*U2(K+1)**2*DELY(K+1)+R   MAIN      403
     *HO2(K)*U2(K)**2*DELY(K))*BETAP                                     MAIN      404
      DPHODS= DPHODS+SUMPV*2.0/(RHO2(K+1)*U2(K+1)**2+RHO2(K)*U2(K)**2)   MAIN      405
      DPHIDS(K)=.45*DPHIDS(K)+.55*DPHODS                                 MAIN      406
C     LOCATING NEW GRID POINTS                                           MAIN      407
C     IK FIRST PT.,IKI ONE INITIAL POINT                                 MAIN      408
  800 IF((IKIND.EQ.2).OR.(NNT.NE.0).OR.(K.GT.KFL).OR.(IKIND.EQ.1).OR.    MAIN      409
     *(R(K).LE.REX)) GO TO 801                                           MAIN      410
      IF(IKK.NE.0) GO TO 802                                             MAIN      411
      IF(DPDY(K).LE.0.0) GO TO 801                                       MAIN      412
      IF (IKK .EQ. 0) IK=K                                               MAIN      413
      IKK=1                                                              MAIN      414
  802 DPY=P2(K+1)-P2(K)                                                  MAIN      415
      SPDY=DPY+SPDY                                                      MAIN      416
      P2P=SPDY/P2(K+1)                                                   MAIN      417
      OAT=1.-1./EGSF1                                                    11AUG      18
      IF((P2P.LE.OAT).OR.(IKI.NE.0)) GO TO 801                           11AUG      19
      XLX=X2(2)                                                          MAIN      419
      LINT=LINT+1                                                        MAIN      420
      IF (LINT.EQ.1) GO TO 801                                           MAIN      421
      IF (KMN.LE.1) CALL ENTAL(IK)                                       MAIN      422
      IKIND=3                                                            MAIN      423
      ISHOCK=0                                                           MAIN      424
      USTREM=1.E-6                                                       MAIN      425
      TSTU=T2(KFL)                                                       MAIN      426
      IF(KMAX.GT.KFL) TSTU=T2(KFL+1)                                     MAIN      427
      PSTREM=P2(KFL)*(250./TSTU)**(GAMA/(GAMA-1.))                       MAIN      428
      PSTREM=EGSF2*PSTREM                                                11AUG      20
      IF (KMN.GT.1) PSTREM=1.0E-6                                        MAIN      429
  801 PHI1=PHI(K)+DPHIDS(K)*D LS(K-1)                                    MAIN      430
 3100 THETA=PI/2.0-0.5*(PHI2(K-1)+PHI1)                                  MAIN      431
      TTHETA=TAN(THETA)                                                  MAIN      432
      PHIBAR=.5*(PHI(K)+PHI1)                                            MAIN      433
      TPHBR=TAN(PHIBAR)                                                  MAIN      434
      IF (ABS(THETA).LT.(PI/4.).OR.ABS(THETA).GT.(3.*PI/4.)) GO TO 810   MAIN      435
       IF (ABS(THETA-PI/2.).GT.1.E-04) GO TO 805                         MAIN      436
      X2(K)=X2(K-1)                                                      MAIN      437
      R2(K)=R(K)+(X2(K)-X(K))*TAN(.5*(PHI(K)+PHI1))                      MAIN      438
      GO TO 820                                                          MAIN      439
  805 R2(K)=((X2(K-1)-X(K))*TTHETA    *TPHBR      +R(K)*TTHETA    +R2(K- MAIN      440
     *1)*TPHBR      )/(TTHETA    +TPHBR)                                 MAIN      441
      X2(K)=X2(K-1)-(R2(K)-R2(K-1))/TTHETA                               MAIN      442
      GO TO 820                                                          MAIN      443
  810 IF (ABS(THETA).GT.1.E-04) GO TO 815                                MAIN      444
      R2(K)=R2(K-1)                                                      MAIN      445
      X2(K)=X(K)+(R2(K)-R(K))/TPHBR                                      MAIN      446
      GO TO 820                                                          MAIN      447
  815 X2(K)=(R2(K-1)-R(K)+X2(K-1)*TTHETA    +X(K)*TAN(.5*(PHI(K)+PHI1))) MAIN      448
     */(TAN(.5*(PHI(K)+PHI1))+TTHETA)                                    MAIN      449
      R2(K)=R2(K-1)-(X2(K)-X2(K-1))*TTHETA                               MAIN      450
  820 D=SQRT((X2(K)-X(K))**2+(R2(K)-R(K))**2)                            MAIN      451
      IF (ABS(PHI1-PHI(K))-(1.0E-6   )) 821,822,822                      MAIN      452
  821 DLS(K)=D                                                           MAIN      453
      GO TO 824                                                          MAIN      454
  822 D LS(K)=D*(PHI1-PHI(K))/(2.0*SIN(.5*(PHI1-PHI(K))))                MAIN      455
  824 PHI2(K)=PHI(K)+D LS(K)*DPHIDS(K)                                   MAIN      456
C     CALCULATION OF STREAMTUBE PROPERTIES                               MAIN      457
      B=SQRT((X2(K)-X2(K-1))**2+(R2(K)-R2(K-1))**2)                      MAIN      458
      IF (ABS(PHI2(K)-PHI2(K-1))-(10.**(-4)))  825,825,850               MAIN      459
  825 DELY(K)=B                                                          MAIN      460
      GO TO 875                                                          MAIN      461
  850 DELY(K)=(PHI2(K)-PHI2(K-1))*B/(2.0*SIN(.5*(PHI2(K)-PHI2(K-1))))    MAIN      462
  875 AA(K)=PI*(R2(K)+R2(K-1))**DELTA*DELY(K)                            MAIN      463
      Y2(K)=Y2(K-1)+DELY(K)                                              MAIN      464
      GO TO 971                                                          MAIN      465
 3000 TANPH=TAN(PHIO)                                                    MAIN      466
      XBAR=X2(1)-XINIT                                                   MAIN      467
      LBAR=L2-L1                                                         MAIN      468
      THRU=0                                                             MAIN      469
C                                                                        MAIN      470
C     CALCULATING DIVIDING STREAMLINE RADIUS AND SLOPE FOR SS REGION     MAIN      471
C                                                                        MAIN      472
      IF(X2(1).GT.XINIT+L1) GO TO 3001                                   MAIN      473
      RDSL=RMD+TANPH*XBAR*(1.0-(XBAR/(2.0*L1)))                          MAIN      474
      RDSL=PAR(6)*XBAR**3+RDSL                                           11AUG      21
      RMAX=RMD+TANPH*L1/2.0+PAR(6)*L1**3                                 11AUG      22
      PHDSL=ATAN(TANPH*(1.0-(XBAR/L1)))                                  MAIN      476
      GO TO 3003                                                         MAIN      477
 3001 IF(X2(1).GT.XINIT+L2) GO TO 3002                                   MAIN      478
      RDSL=RMAX+(RMAX-RSTAR)*(XBAR-L1)**2/LBAR**2*(-3.0+2.0*(XBAR-L1)/LB MAIN      479
     1AR)                                                                MAIN      480
      RDSL=RDSL+PAR(7)*(XBAR-L1)**4/LBAR**4                              11AUG      23
      PHDSL=ATAN((6.0*(RMAX-RSTAR)*(XBAR-L1)/LBAR**2)*((XBAR-L1)/LBAR    MAIN      481
     1-1.0))                                                             MAIN      482
      GO TO 3003                                                         MAIN      483
 3002 CONTINUE                                                           18JUNE      7
      U(2)=U(2)*1.01/MA(2)                                               18JUNE      8
      MA(2)=1.01                                                         18JUNE      9
      GO TO 3070                                                         18JUNE     10
      THRU=1                                                             MAIN      487
C                                                                        MAIN      488
C     CALCULATING NEW SUBSONIC STREAMTUBE COORDINATES AND AREA           MAIN      489
C                                                                        MAIN      490
 3003 X2(K)=X2(1)                                                        MAIN      491
      R2(K)=RDSL                                                         MAIN      492
      IF ((X2(1).LT.XINIT).OR.(X2(1).GT.XINIT+L2).OR.(PAR(8).EQ.0.0).OR. 11AUG      24
     *(IFLAG.EQ.0)) GO TO 525                                            11AUG      25
      IPAR8=PAR(8)                                                       11AUG      26
      IF (MOD(LL,IPAR8).EQ.0) WRITE(6,529) X2(1),RDSL                    11AUG      27
  529 FORMAT(35X,19HDSL COORDINATES ARE,2X,2HX=,F8.1,4X,2HR=,F8.1)       11AUG      28
  525 CONTINUE                                                           11AUG      29
      IF ((MOD(LL,20).NE.0).OR.(X2(1).GT.XINIT+L2).OR.(IFLAG.EQ.0)) GO   11AUG      30
     *TO 542                                                             11AUG      31
      AAA=X2(1)/RNOZ                                                     11AUG      32
      BBB=RDSL/RNOZ                                                      11AUG      33
      WRITE(11) AAA,BBB                                                  11AUG      34
  542 CONTINUE                                                           11AUG      35
      PHI2(K)=PHDSL                                                      MAIN      493
      DELY(K)=R2(K)-R2(K-1)                                              MAIN      494
      AA(K)=PI*(R2(K)+R2(K-1))**DELTA*DELY(K)                            MAIN      495
      Y2(K)=Y2(K-1)+DELY(K)                                              MAIN      496
  971 CALL STEP                                                          MAIN      497
      IF((IFLAG.NE.0) .AND.((K-1).LE.KMX2).AND.(IPART.NE.0)) CALL PART   MAIN      498
      IF (KALARM.LE.0) GO TO 885                                         MAIN      499
      MOVE=0                                                             18JUNE     11
  877 KALARM=0                                                           MAIN      500
      IF (ICOUNT-25)250,9910,9910                                        MAIN      501
  885 IF (NUCASE .NE. 0) GO TO 9960                                      MAIN      502
      IF (MOVE.NE.0) GO TO 1000                                          MAIN      503
  970 IF (K.GT.KMN) GO TO 972                                            MAIN      504
      DLS(K)=DLS(1)                                                      MAIN      505
      RBAR(K)=R(K)                                                       MAIN      506
  972 K=K+1                                                              MAIN      507
      IF (K-KMAX)  500,1000,1000                                         MAIN      508
C     OUTER BOUNDARY CONDITIONS                                          MAIN      509
 1000 NBOUND=1                                                           MAIN      510
       IKK=0                                                             MAIN      511
      SPDY=0.0                                                           MAIN      512
      CALL BNDRY                                                         MAIN      513
      IF (MOVE.NE.0) GO TO 801                                           MAIN      514
      MOVE=0                                                             MAIN      515
      IF (KALARM) 1030,1030,877                                          MAIN      516
 1030 IF (NUCASE) 9960,1050,9960                                         MAIN      517
 1050 Y2(K)=Y2(K-1)+DELY(K)                                              MAIN      518
 1070 IF (IFLAG) 1080,1150,1080                                          MAIN      519
 1080 MAX=KMAX+1                                                         MAIN      520
      DO 1100 L=2,MAX                                                    MAIN      521
      J=L-1                                                              MAIN      522
      R(J)=R2(J)                                                         MAIN      523
      X(J)=X2(J)                                                         MAIN      524
      PHI(J)=PHI2(J)                                                     MAIN      525
      IF (J-1) 1100,1100,1082                                            MAIN      526
 1082 U(J)=U2(J)                                                         MAIN      527
      P(J)=P2(J)                                                         MAIN      528
      T(J)=T2(J)                                                         MAIN      529
      RHO(J)=RHO2(J)                                                     MAIN      530
      ZMW=0.0                                                            MAIN      531
      DO 1084 I=1,NDS                                                    MAIN      532
 1084 ZMW=ZMW+C2(I,J)/MW(I)                                              MAIN      533
      ZMW=1.0/ZMW                                                        MAIN      534
      ZMWK(J)=ZMW                                                        MAIN      535
      DO 1086 I=1,NDS                                                    MAIN      536
      C(I,J)=C2(I,J)                                                     MAIN      537
 1086 XS(I,J)=C(I,J)*ZMW/MW(I)                                           MAIN      538
      H(J)=0.0                                                           MAIN      539
      DO 1088 I=1,NDS                                                    MAIN      540
      DO 1088 JJ=1,NN                                                    MAIN      541
 1088 H(J)=H(J)+A(I,JJ)*T(J)**(JJ-2)*C(I,J)                              MAIN      542
      Y(J)= Y(J-1)+DELY(J)                                               MAIN      543
      SX(J)=SX(J)+DLS(J)                                                 MAIN      544
 1100 CONTINUE                                                           MAIN      545
      IF (IKIND.GT.3) CALL SHOCKE                                        MAIN      546
      ICONT=ICONT+1                                                      MAIN      547
      IF ((IFLAG.NE.0).AND.(IPART.NE.0))CALL PBNDY                       MAIN      548
      KMX2= KMX+2                                                        MAIN      549
      LL=LL+1                                                            MAIN      550
      ICOUNT=0                                                           MAIN      551
      IF ((ISB.NE.1).OR.(X2(1).LE.XINIT+L2).OR.(JTEST.NE.0)) GO TO 565   11AUG      36
      JTEST=1                                                            11AUG      37
      AAA=(XINIT+L2)/RNOZ                                                11AUG      38
      BBB=RSTAR/RNOZ                                                     11AUG      39
      WRITE(11) AAA,BBB                                                  11AUG      40
      ENDFILE 11                                                         11AUG      41
  565 CONTINUE                                                           11AUG      42
      IF(MOD(ICONT,INTGER)) 201,1130,201                                 MAIN      552
  201 IF(X (2).LT.XLMMX) GO TO 200                                       MAIN      553
      XLMMX=XLMMX+DXLSS                                                  MAIN      554
 1130 K=KMAX                                                             MAIN      555
      CALL PUTOUT(1)                                                     MAIN      556
      IF ((PAR(1).EQ.0.0).AND.(IFLAG.NE.0).AND.(IPART.NE.0)) CALL PPTOUT 11AUG      43
     *(1)                                                                11AUG      44
      GO TO 200                                                          MAIN      558
 1150 IF (IKIND.GE.4) CALL SHOCKE                                        MAIN      559
      IFLAG=1                                                            MAIN      560
      GO TO 300                                                          MAIN      561
C     ERROR MESSAGES                                                     MAIN      562
 9910 NUCASE=876                                                         MAIN      563
 9955 IERROR=1                                                           MAIN      564
 9960 IF (IERROR.EQ.0) GO TO 9964                                        MAIN      565
      WRITE (6,9965) ERROR(IERROR),NUCASE                                MAIN      566
      WRITE (6,8966) IFLAG,ICONT,ICOUNT,MOVE,KALARM                      MAIN      567
C     CALL PDUMP (A(1,1),N,5)                                            MAIN      568
      DO 9969 I=1,NDS                                                    MAIN      569
      IF(C2(I,K).LT.0.0) GO TO 9961                                      MAIN      570
 9969 CONTINUE                                                           MAIN      571
      GO TO 9968                                                         MAIN      572
 9964 WRITE(6,9963) IERROR                                               MAIN      573
      WRITE (6,8966) IFLAG,ICONT,ICOUNT,MOVE,KALARM                      MAIN      574
 8966 FORMAT (1H0,10X,23HPROGRAM EXIT CONDITIONS,/15X,6HIFLAG=,I3,4X,    MAIN      575
     1 6HICONT=,I3,4X,7HICOUNT=,I3,4X,5HMOVE=,I3,4X,7HKALARM=,I3)        MAIN      576
 9963 FORMAT (1H0,/10X,7HIERROR=,I3/)                                    MAIN      577
      GO TO 9968                                                         MAIN      578
 9961 WRITE(6,9962)                                                      MAIN      579
 9962 FORMAT(2X,11HNEGATIVE C2)                                          MAIN      580
 9965 FORMAT(27H1ERROR ORIGIN IN SUBROUTINE,1X,A6,19H,  STATEMENT NUMBER MAIN      581
     *,I6,1H.)                                                           MAIN      582
 9968 CONTINUE                                                           MAIN      583
      CALL EXIT                                                          MAIN      584
      END                                                                MAIN      585
      SUBROUTINE TRIPLE                                                  TRIPLE      2
C *** THIS ROUTINE OBTAINS THE TRIPLE-POINT SOLUTION FOR A CONFIGURATION TRIPLE      3
C ***        CONSISTING OF A WEAK INCIDENT SHOCK, A WEAK REFLECTED SHOCK TRIPLE      4
C ***        AND A STRONG SHOCK (MACH DISC).  PROPERTIES BEHIND THE      TRIPLE      5
C ***        INCIDENT SHOCK AND IN THE UNSHOCKED FLOW ARE GIVEN.  THE    TRIPLE      6
C ***        ROUTINE ITERATES ON THE WEAK AND STRONG SHOCKS SEPARATELY   TRIPLE      7
C ***        AND USES A SECANT PROCEDURE BASED ON THE PRESSURES BEHIND   TRIPLE      8
C ***        THE TWO SHOCKS AT THE SAME DEFLECTION ANGLE (TOTAL) TO      TRIPLE      9
C ***        OBTAIN THE TRIPLE-POINT SOLUTION.                           TRIPLE     10
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    TRIPLE     12
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         TRIPLE     13
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        TRIPLE     14
     * ,      MAP                                                        TRIPLE     15
      COMMON/TRIPLE/DEL1,PP1,TT1,UU1,TH3,PP3,TT3,UU3,SLANG,SHANG         TRIPLE     16
      COMMON/TURPLE/DEL2,CPSHW,GAMSHW,ZMWSH1                             TRIPLE     17
      COMMON/UTPP/PSH11,TSH11,USH11,FLANG,CSH11(20)                      TRIPLE     18
      DIMENSION         CSHW(20),CSH5(20)                ,CHH(20)        TRIPLE     19
      DIMENSION G(4),DGDX(4,4),Z1(4),Z2(4),Z3(4,4),DUM(4)                TRIPLE     20
      REAL MW,MSHW,MSH1                                                  TRIPLE     21
      WRITE(6,61)                                                        TRIPLE     22
   61 FORMAT(1H0,* TRIPLE IS CALLED*)                                    TRIPLE     23
      IDO=0                                                              TRIPLE     24
      PSHW=P2(2)                                                         TRIPLE     25
      TSHW=T2(2)                                                         TRIPLE     26
      USHW=U2(2)                                                         TRIPLE     27
      RHOSHW=RHO2(2)                                                     TRIPLE     28
      ZMWSHW=ZMWK(2)                                                     TRIPLE     29
      DELPHI=DEL2                                                        TRIPLE     30
      PSH5=PSH11                                                         TRIPLE     31
      TSH5=TSH11                                                         TRIPLE     32
      USH5=USH11                                                         TRIPLE     33
      DO 125 I=1,NDS                                                     TRIPLE     34
  125 CSH5(I)=CSH11(I)                                                   TRIPLE     35
      WRITE(6,62) DEL2,CPSHW,GAMSHW,ZMWSH1,PSHW,TSHW,USHW,RHOSHW,ZMWSHW  TRIPLE     36
   62 FORMAT(5X,9E10.3)                                                  TRIPLE     37
      DO 110 I=1,NDS                                                     TRIPLE     38
      CSHW(I)= C2 (I,2)                                                  TRIPLE     39
  110 CONTINUE                                                           TRIPLE     40
      MSHW=USHW/SQRT(CPSHW/(CPSHW-RCON/ZMWSHW)*HJ*RCON*TSHW/ZMWSHW)      TRIPLE     41
      PI=3.141592654                                                     TRIPLE     42
      TWOPI=2.*PI                                                        TRIPLE     43
      CPSH1=0                                                            TRIPLE     44
      DO 170 I=1,NDS                                                     TRIPLE     45
      DO 160 J=1,NN                                                      TRIPLE     46
  160 CPSH1=CPSH1+FLOAT(J-2)*A(I,J)*TSH5**(J-3)*CSH5(I)                  TRIPLE     47
  170 CONTINUE                                                           TRIPLE     48
      MSH1=USH5/SQRT(CPSH1/(CPSH1-RCON/ZMWSH1)*HJ*RCON*TSH5/ZMWSH1)      TRIPLE     49
      GAMSH1=CPSH1/(CPSH1-RCON/ZMWSH1)                                   TRIPLE     50
      RHOSH1=ZMWSH1*PSH5/(RV*TSH5)                                       TRIPLE     51
      ANGM=ASIN(1./MSHW)                                                 TRIPLE     52
      WRITE(6,20)                                                        TRIPLE     53
   20 FORMAT(1H0,* PROPERTIES UPSTREAM OF STRONG SHOCK ARE*)             TRIPLE     54
      WRITE(6,1) PSH5,TSH5,USH5,CPSH1,MSH1,ZMWSH1,GAMSH1                 TRIPLE     55
      DO 127 I=1,NDS                                                     TRIPLE     56
  127 WRITE (6,53) CSH5(I)                                               TRIPLE     57
   53 FORMAT(10X,* MASS FRACTIONS ARE*,E10.3    )                        TRIPLE     58
      WRITE(6,60) FLANG                                                  TRIPLE     59
   60 FORMAT(10X,*PHISH1=*,E10.3)                                        TRIPLE     60
      WRITE(6,51)                                                        TRIPLE     61
   51 FORMAT(1H0,* PROPERTIES UPSTREAM OF WEAK SHOCK ARE*)               TRIPLE     62
      WRITE(6,1) PSHW,TSHW,USHW,CPSHW,MSHW,ZMWSHW,GAMSHW                 TRIPLE     63
      DO 126 I=1,NDS                                                     TRIPLE     64
  126 WRITE(6,52) CSHW(I)                                                TRIPLE     65
   52 FORMAT(10X,* MASS FRACTIONS ARE*,E10.3)                            TRIPLE     66
      WRITE(6,59) DELPHI                                                 TRIPLE     67
   59 FORMAT(10X,*DELPHI=*,E10.3)                                        TRIPLE     68
    1 FORMAT(10X,* P=*,E10.3,* T=*,E10.3,* U=*,E10.3,* CP=*,E10.3,* MA=* TRIPLE     69
     *,E10.3,* MOL. WEIGHT=*,E10.3,* GAMMA=*,E10.3)                      TRIPLE     70
C *** NORMAL SHOCK SOLUTION                                              TRIPLE     71
C *** INITIAL GUESSES                                                    TRIPLE     72
      TH1=PI/2.                                                          TRIPLE     73
      DEL1=0.                                                            TRIPLE     74
      TT1=3000.                                                          TRIPLE     75
      PP1=RHOSH1*USH5*USH5/BETAP                                         TRIPLE     76
      UU1=5.E+04                                                         TRIPLE     77
      FMASS=RHOSH1*USH5                                                  TRIPLE     78
      FFORCE=PSH5+RHOSH1*USH5*USH5/BETAP                                 TRIPLE     79
      HT=USH5*USH5/(2.*HJ)                                               TRIPLE     80
      DO 300 I=1,NDS                                                     TRIPLE     81
      DO 200 J=1,NN                                                      TRIPLE     82
  200 HT=HT+A(I,J)*TSH5**(J-2)*CSH5(I)                                   TRIPLE     83
  300 CONTINUE                                                           TRIPLE     84
      HTI=HT                                                             TRIPLE     85
      A1=ZMWSH1/RV                                                       TRIPLE     86
C *** NEWTON-RAPHSON ITERATION PROCEDURE ON P,T, AND U                   TRIPLE     87
      ITER=1                                                             TRIPLE     88
  400 A2=PP1*UU1/TT1                                                     TRIPLE     89
      G(1)=A1*A2-FMASS                                                   TRIPLE     90
      G(2)=PP1*(1.+A1*UU1*UU1/(TT1*BETAP))-FFORCE                        TRIPLE     91
      G(3)=UU1*UU1/(2.*HJ)-HT                                            TRIPLE     92
      CPSH1=0.                                                           TRIPLE     93
      DO 600 I=1,NDS                                                     TRIPLE     94
      DO 500 J=1,NN                                                      TRIPLE     95
      G(3)=G(3)+A(I,J)*TT1**(J-2)*CSH5(I)                                TRIPLE     96
  500 CPSH1=CPSH1+FLOAT(J-2)*A(I,J)*TT1**(J-3)*CSH5(I)                   TRIPLE     97
  600 CONTINUE                                                           TRIPLE     98
      DGDX(1,1)=A1*UU1/TT1                                               TRIPLE     99
      DGDX(1,2)=-A1*A2/TT1                                               TRIPLE    100
      DGDX(1,3)=A1*PP1/TT1                                               TRIPLE    101
      DGDX(2,1)=1.+A1*UU1*UU1/(TT1*BETAP)                                TRIPLE    102
      DGDX(2,2)=-A1*A2/(TT1*BETAP)                                       TRIPLE    103
      DGDX(2,3)=2.*A1*A2/BETAP                                           TRIPLE    104
      DGDX(3,1)=0.                                                       TRIPLE    105
      DGDX(3,2)=CPSH1                                                    TRIPLE    106
      DGDX(3,3)=UU1/HJ                                                   TRIPLE    107
      DO 700 I=1,3                                                       TRIPLE    108
  700 G(I)=-G(I)                                                         TRIPLE    109
      YYY=0.                                                             TRIPLE    110
      DO 900 I=1,3                                                       TRIPLE    111
      Z2(I)=G(I)                                                         TRIPLE    112
      DO 800 J=1,3                                                       TRIPLE    113
  800 Z3(I,3)=DGDX(I,J)                                                  TRIPLE    114
  900 CONTINUE                                                           TRIPLE    115
      Z1(1)=PP1                                                          TRIPLE    116
      Z1(2)=TT1                                                          TRIPLE    117
      Z1(3)=UU1                                                          TRIPLE    118
      CALL MATE7(4,3,1,DGDX,G,YYY,DUM,J)                                 TRIPLE    119
C *** J NOT =1  MATE7 COULD NOT FIND A SOLUTION                          TRIPLE    120
      IF (J.EQ.1)  GO TO 1100                                            TRIPLE    121
      WRITE (6,3)                                                        TRIPLE    122
    3 FORMAT (1HO,*NORMAL SHOCK MATRIX FAILURE IN TRIPLE POINT*)         TRIPLE    123
 1000 CALL PDUMP(Z1(1),Z2(4),1)                                          TRIPLE    124
      GO TO 4400                                                         TRIPLE    125
C *** J=1  SOLUTION OBTAINED.  CHECK FOR CONVERGENCE                     TRIPLE    126
 1100 DO 1200 I=1,3                                                      TRIPLE    127
 1200 DUM(I)=DGDX(I,1)                                                   TRIPLE    128
      PP1=PP1+DUM(1)                                                     TRIPLE    129
      TT1=TT1+DUM(2)                                                     TRIPLE    130
      UU1=UU1+DUM(3)                                                     TRIPLE    131
      IF (ABS(DUM(1)/PP1).GT.TOL.OR.ABS(DUM(2)/TT1).GT.TOL.OR.ABS(DUM(3) TRIPLE    132
     1/UU1).GT.TOL) GO TO 1400                                           TRIPLE    133
      DO 1300 I=1,3                                                      TRIPLE    134
      IF (ABS(G(I)).GT.TOL) GO TO 1400                                   TRIPLE    135
 1300 CONTINUE                                                           TRIPLE    136
C *** ITERATIONS HAVE CONVERGED.  PRINT RESULTS AND BEGIN WEAK SHOCK     TRIPLE    137
C ***        ITERATIONS                                                  TRIPLE    138
      GO TO 1600                                                         TRIPLE    142
 1400 IF (ITER.LE.NITER) GO TO 1500                                      TRIPLE    143
C *** ITERATION LIMIT REACHED.  ADMIT FAILURE                            TRIPLE    144
      WRITE (6,4)                                                        TRIPLE    145
    4 FORMAT (1H0,*NORMAL SHOCK ITERATION FAILURE IN TRIPLE POINT*)      TRIPLE    146
      GO TO 1000                                                         TRIPLE    147
C *** ITERATIONS HAVE NOT CONVERGED.  TRY AGAIN                          TRIPLE    148
 1500 ITER=ITER+1                                                        TRIPLE    149
      GO TO 400                                                          TRIPLE    150
C *** INITIAL WEAK SHOCK SOLUTION CORRESPONDS TO NORMAL STRONG SHOCK     TRIPLE    151
 1600 DEL=ABS(DELPHI)                                                    TRIPLE    152
      IWAY=0                                                             TRIPLE    153
C *** GENERAL SHOCK SOLUTION                                             TRIPLE    154
C ***        IWAY=0 INDICATES WEAK SHOCK, SOLVE FOR THETA AND T          TRIPLE    155
C ***        IWAY=1 INDICATES STRONG SHOCK, SOLVE FOR DEL AND T          TRIPLE    156
 1700 ITER=0                                                             TRIPLE    157
C *** INITIAL GUESSES                                                    TRIPLE    158
      IF (IWAY.EQ.1) GO TO 1750                                          TRIPLE    159
      TH=DEL+0.1                                                         TRIPLE    160
      IF (TH.LT.ANGM) TH=ANGM                                            TRIPLE    161
      EMSQ=(MSHW*SIN(TH))**2                                             TRIPLE    162
      TT=TSHW*((1.+.5*(GAMSHW-1.)*EMSQ)*(2.*GAMSHW/(GAMSHW-1.)*EMSQ-1.)  TRIPLE    163
     1*2.*(GAMSHW-1.)/((GAMSHW+1.)**2*EMSQ))                             TRIPLE    164
      FMASS=RHOSHW*USHW                                                  TRIPLE    165
      FFORCE=RHOSHW*USHW**2/BETAP                                        TRIPLE    166
      POLD=PSHW                                                          TRIPLE    167
      UOLD=USHW                                                          TRIPLE    168
      TOLD=TSHW                                                          TRIPLE    169
      HT=UOLD*UOLD/(2.*HJ)                                               TRIPLE    170
      DO 1850 I=1,NDS                                                    TRIPLE    171
      DO 1860 J=1,NN                                                     TRIPLE    172
 1860 HT=HT+A(I,J)*TOLD**(J-2)*CSHW(I)                                   TRIPLE    173
      CHH(I)=CSHW(I)                                                     TRIPLE    174
 1850 CONTINUE                                                           TRIPLE    175
      GO TO 1800                                                         TRIPLE    176
 1750 TT=TT1                                                             TRIPLE    177
      POLD=PSH5                                                          TRIPLE    178
      UOLD=USH5                                                          TRIPLE    179
      TOLD=TSH5                                                          TRIPLE    180
      FMASS=RHOSH1*USH5                                                  TRIPLE    181
      PP=RHOSH1*USH5*USH5/BETAP                                          TRIPLE    182
      FFORCE=PP                                                          TRIPLE    183
      HT=HTI                                                             TRIPLE    184
      TH=TH1                                                             TRIPLE    185
      DO 1770 I=1,NDS                                                    TRIPLE    186
 1770 CHH(I)=CSH5(I)                                                     TRIPLE    187
C *** NEWTON-RAPHSON ITERATION PROCEDURE ON T AND EITHER THETA OR DEL    TRIPLE    188
 1800 CONTINUE                                                           18JUNE     12
      SIT=SIN(TH)                                                        TRIPLE    194
      COT=COS(TH)                                                        TRIPLE    195
      SID=SIN(TH-DEL)                                                    TRIPLE    196
      COD=COS(TH-DEL)                                                    TRIPLE    197
      G(1)=-HT+.5*(UOLD*COT/COD)**2/HJ                                   TRIPLE    198
      CP=0.                                                              TRIPLE    199
      HH=0.                                                              TRIPLE    200
      DO 2000 I=1,NDS                                                    TRIPLE    201
      DO 1900 J=1,NN                                                     TRIPLE    202
      HH=HH+A(I,J)*TT**(J-2)*CHH(I)                                      TRIPLE    203
 1900 CP=CP+FLOAT(J-2)*A(I,J)*TT**(J-3)*CHH(I)                           TRIPLE    204
 2000 CONTINUE                                                           TRIPLE    205
      G(1)=G(1)+HH                                                       TRIPLE    206
      G(2)=POLD*TOLD*COT/SIT+TOLD*FFORCE*SIT*COT*(1.-SID*COT/(COD*SIT))- TRIPLE    207
     1POLD*TT*COD/SID                                                    TRIPLE    208
      DGDX(1,1)=CP                                                       TRIPLE    213
      DGDX(1,2)=-(COT*COT*SID/COD**3)*UOLD*UOLD/HJ                       TRIPLE    214
      IF (IWAY.EQ.0) DGDX(1,2)=-DGDX(1,2)-SIT*COT/(COD*COD)*UOLD*UOLD/HJ TRIPLE    215
      DGDX(2,1)=-POLD*COD/SID                                            TRIPLE    216
      DGDX(2,2)= TOLD*FFORCE*COT*COT/(COD*COD)-POLD*TT/(SID*SID)         TRIPLE    217
      IF (IWAY.EQ.0)DGDX(2,2)=-DGDX(2,2)-POLD*TOLD/(SIT*SIT)+TOLD*FFORCE TRIPLE    218
     1*((1.-SID*COT/(SIT*COD))*(COT*COT-SIT*SIT)+SID*COT/(SIT*COD))      TRIPLE    219
      DO 750 I=1,2                                                       TRIPLE    220
  750 CONTINUE                                                           TRIPLE    223
      YYY=0.                                                             TRIPLE    224
      DO 2100 I=1,2                                                      TRIPLE    225
      Z2(I)=-G(I)                                                        TRIPLE    226
      G(I)=-G(I)                                                         TRIPLE    227
      DO 2100 J=1,2                                                      TRIPLE    228
 2100 Z3(I,J)=DGDX(I,J)                                                  TRIPLE    229
      Z1(1)=TT                                                           TRIPLE    230
      Z1(2)=TH                                                           TRIPLE    231
      IF (IWAY.NE.0) Z1(2)=DEL                                           TRIPLE    232
      CALL MATE7(4,2,1,DGDX,G,YYY,DUM,J)                                 TRIPLE    233
      IF (J.EQ.1) GO TO 2500                                             TRIPLE    234
C *** J NOT =1  MATE7 COULD NOT FIND A SOLUTION                          TRIPLE    235
      IF(IWAY.NE.1) GO TO 2300                                           TRIPLE    236
      WRITE (6,5)                                                        TRIPLE    237
    5 FORMAT (1H0,*STRONG SHOCK MATRIX FAILURE IN TRIPLE POINT*)         TRIPLE    238
      GO TO 2400                                                         TRIPLE    239
 2300 WRITE (6,6)                                                        TRIPLE    240
    6 FORMAT (1H0,*WEAK SHOCK MATRIX FAILURE IN TRIPLE POINT*)           TRIPLE    241
 2400 CALL PDUMP(Z1(1),Z3(4,4),1)                                        TRIPLE    242
      GO TO 4400                                                         TRIPLE    243
C *** J=1  SOLUTION OBTAINED.  CHECK FOR CONVERGENCE                     TRIPLE    244
 2500 DO 2600 I=1,2                                                      TRIPLE    245
 2600 DUM(I)=DGDX(I,1)                                                   TRIPLE    246
      TT=TT+DUM(1)                                                       TRIPLE    249
      IF (IWAY.NE.0) GO TO 2700                                          TRIPLE    250
      TH=TH+DUM(2)                                                       TRIPLE    251
      IF (TH.GT.TWOPI) TH=TH-TWOPI                                       TRIPLE    252
      IF (TH.LT.ANGM) TH=ANGM+DEL                                        TRIPLE    253
      IF (ABS(DUM(1)/TT).GT.TOL.OR.ABS (DUM(2)/TH).GT.TOL) GO TO 3000    TRIPLE    257
      GO TO 2800                                                         TRIPLE    258
 2700 DEL=DEL+DUM(2)                                                     TRIPLE    259
      IF (ABS(DUM(1)/TT).GT.TOL.OR.ABS(DUM(2)/DEL).GT.TOL) GO TO 3000    TRIPLE    260
 2800 DO 2900 I=1,2                                                      TRIPLE    261
      IF (ABS(G(I)).GT.TOL) GO TO 3000                                   TRIPLE    262
 2900 CONTINUE                                                           TRIPLE    263
      GO TO 3300                                                         TRIPLE    264
 3000 IF (ITER.LE.NITER) GO TO 3200                                      TRIPLE    265
C *** ITERATION LIMIT REACHED.  ADMIT FAILURE                            TRIPLE    266
      IF (IWAY.NE.1) GO TO 3100                                          TRIPLE    267
      WRITE (6,7)                                                        TRIPLE    268
    7 FORMAT (1H0,*STRONG SHOCK ITERATION FAILURE IN TRIPLE POINT*)      TRIPLE    269
      GO TO 2400                                                         TRIPLE    270
 3100 WRITE (6,8)                                                        TRIPLE    271
    8 FORMAT (1H0,*WEAK SHOCK ITERATION FAILURE IN TRIPLE POINT*)        TRIPLE    272
      GO TO 2400                                                         TRIPLE    273
C *** ITERATIONS HAVE NOT CONVERGED.  TRY AGAIN                          TRIPLE    274
 3200 ITER=ITER+1                                                        TRIPLE    275
      GO TO 1800                                                         TRIPLE    276
C *** ITERATIONS HAVE CONVERGED                                          TRIPLE    277
 3300 IF (IWAY.NE.0) GO TO 4150                                          TRIPLE    278
C *** WEAK SHOCK SOLUTION                                                TRIPLE    279
      PP=POLD*(1.+A1/(BETAP*TOLD)*UOLD*UOLD*SIT*SIT*(1.-SID/COD*COT/SIT) TRIPLE    280
     1)                                                                  TRIPLE    281
      UU=SQRT(2.*HJ*(HT-HH))                                             TRIPLE    282
C *** SECANT PROCEDURE FOR BALANCING WEAK AND STRONG SHOCK RESULTS       TRIPLE    283
      TH3=TH                                                             TRIPLE    284
      IDO=IDO+1                                                          TRIPLE    285
      PP3=PP                                                             TRIPLE    286
      DP=PP1-PP3                                                         TRIPLE    287
      TT3=TT                                                             TRIPLE    288
      UU3=UU                                                             TRIPLE    289
      IF (IDO.NE.1) GO TO 3500                                           TRIPLE    293
C *** FIRST TIME THROUGH.  CHANGE TH1, GO BACK AND GET A SECOND POINT    TRIPLE    294
      DP1=DP                                                             TRIPLE    295
      THA=TH1                                                            TRIPLE    296
      IGO=0                                                              TRIPLE    297
      TH1=THA+SIGN(1.,DP)*.017453295                                     TRIPLE    298
 3400 IWAY=1                                                             TRIPLE    299
      TANDEL=((GAMSH1+1.)*MSH1*MSH1/(2.*((MSH1*SIN(TH1))**2-1.))-1.)     TRIPLE    300
     1*TAN(TH1)                                                          TRIPLE    301
      DEL=ATAN(1./TANDEL)                                                TRIPLE    302
      GO TO 4100                                                         TRIPLE    303
 3500 IF (IDO.NE.2) GO TO 3700                                           TRIPLE    304
C *** SECOND TIME THROUGH.  CHECK TO SEE IF TRIPLE-POINT SOLUTION HAS    TRIPLE    305
C ***        BEEN BRACKETED                                              TRIPLE    306
      DP2=DP                                                             TRIPLE    307
      THB=TH1                                                            TRIPLE    308
      IF (SIGN(1.,DP2)*SIGN(1.,DP1).LT.0.) GO TO 3600                    TRIPLE    309
C *** NOT BRACKETED.  CHANGE TH1 IN SAME DIRECTION AND TRY AGAIN         TRIPLE    310
      TH1=THB+SIGN(1.,DP)*.017453295                                     TRIPLE    311
      GO TO 3400                                                         TRIPLE    312
C *** BRACKETED.  SET IGO=1 AND USE SECANT PROCEDURE TO CHANGE TH1       TRIPLE    313
 3600 IGO=1                                                              TRIPLE    314
      TH1=THB-DP2/(DP2-DP1)*(THB-THA)                                    TRIPLE    315
      GO TO 3400                                                         TRIPLE    316
C *** THIRD OR GREATER TIME THROUGH.  IGO=1 INDICATES SOLUTION HAS       TRIPLE    317
C ***        PREVIOUSLY BEEN BRACKETED                                   TRIPLE    318
 3700 IF (IGO.EQ.1) GO TO 3900                                           TRIPLE    319
C *** SOLUTION NOT PREVIOUSLY BRACKETED.  CHECK TO SEE ON WHICH SIDE OF  TRIPLE    320
C ***        SOLUTION THE CURRENT VALUE OF DP FALLS, UPDATE DP1 OR DP2   TRIPLE    321
C ***        AS REQUIRED, AND CHANGE TH1.  TRY AGAIN                     TRIPLE    322
      IF (SIGN(1.,DP)*SIGN(1.,DP2).LT.0) GO TO 3800                      TRIPLE    323
      DP1=DP2                                                            TRIPLE    324
      THA=THB                                                            TRIPLE    325
      DP2=DP                                                             TRIPLE    326
      THB=TH1                                                            TRIPLE    327
      TH1=THB+SIGN(1.,DP)*.017453295                                     TRIPLE    328
      GO TO 3400                                                         TRIPLE    329
 3800 DP1=DP2                                                            TRIPLE    330
      THA=THB                                                            TRIPLE    331
      DP2=DP                                                             TRIPLE    332
      THB=TH1                                                            TRIPLE    333
      TH1=THB-DP2/(DP2-DP1)*(THB-THA)                                    TRIPLE    334
      IGO=1                                                              TRIPLE    335
      GO TO 3400                                                         TRIPLE    336
 3900 IF (SIGN(1.,DP)*SIGN(1.,DP2).LT.0) GO TO 4000                      TRIPLE    337
      THB=TH1                                                            TRIPLE    338
      DP2=DP                                                             TRIPLE    339
      TH1=THB-DP2/(DP2-DP1)*(THB-THA)                                    TRIPLE    340
      GO TO 3400                                                         TRIPLE    341
 4000 THA=THB                                                            TRIPLE    342
      DP1=DP2                                                            TRIPLE    343
      THB=TH1                                                            TRIPLE    344
      DP2=DP                                                             TRIPLE    345
      TH1=THB-DP2/(DP2-DP1)*(THB-THA)                                    TRIPLE    346
      GO TO 3400                                                         TRIPLE    347
C *** HAS SECANT ITERATION LIMIT BEEN EXCEEDED                           TRIPLE    348
 4100 IF (IDO.LT.NITER) GO TO 4200                                       TRIPLE    349
C *** ITERATION LIMIT REACHED.  ADMIT FAILURE                            TRIPLE    350
      WRITE (6,9)                                                        TRIPLE    351
    9 FORMAT (1H0,* TRIPLE POINT ITERATIONS FAILED*)                     TRIPLE    352
      WRITE (6,10) PP1,PP3,DEL1,DEL3,TH1,TH3                             TRIPLE    353
   10 FORMAT (*  PP1=*,E10.3,* PP3=*,E10.3,* DEL1=*,E10.3,*DEL2=*,E10.3  TRIPLE    354
     1,* TH=*,E10.3,* TH3=*,E10.3)                                       TRIPLE    355
      GO TO 2400                                                         TRIPLE    356
C *** STRONG SHOCK SOLUTION OBTAINED.  GO BACK AND GET A CORRESPONDING   TRIPLE    357
C ***        WEAK SHOCK SOLUTION                                         TRIPLE    358
 4150 IWAY=0                                                             TRIPLE    359
      PP=POLD*(1.+A1/(BETAP*TOLD)*UOLD*UOLD*SIT*SIT*(1.-SID/COD*COT/SIT) TRIPLE    360
     1)                                                                  TRIPLE    361
      UU=SQRT(2.*HJ*(HT-HH))                                             TRIPLE    362
      DEL1=DEL                                                           TRIPLE    363
      TH1=TH                                                             TRIPLE    364
      PP1=PP                                                             TRIPLE    365
      TT1=TT                                                             TRIPLE    366
      UU1=UU                                                             TRIPLE    367
      DEL3=ABS(DELPHI)-DEL1                                              TRIPLE    368
      DEL=DEL3                                                           TRIPLE    369
      GO TO 1700                                                         TRIPLE    373
C *** CHECK FOR CONVERGENCE OF SECANT ITERATIONS                         TRIPLE    374
 4200 IF (ABS((PP1-PP3)/(PP1+PP3)).LT.0.001) GO TO 4300                  TRIPLE    375
      GO TO 1700                                                         TRIPLE    376
C *** ITERATIONS HAVE CONVERGED.   PRINT OUT RESULTS AND RETURN          TRIPLE    377
 4300 CONTINUE                                                           TRIPLE    378
      FM3=UU3/SQRT(CP/(CP-RCON/ZMWSHW)*TT3*RCON*HJ/ZMWSHW)               TRIPLE    379
      WRITE(6,55)                                                        TRIPLE    380
   55 FORMAT(1H0,* PROPERTIES DOWNSTREAM OF WEAK SHOCK ARE*)             TRIPLE    381
      WRITE(6,12) PP3,TT3,UU3,TH3,DEL3,FM3                               TRIPLE    382
   12 FORMAT(10X,* P=*,E10.3,* T=*,E10.3,* U=*,E10.3,* TH3=*,E10.3,* DEL TRIPLE    383
     *3=*,E10.3,* MA=*,E10.3)                                            TRIPLE    384
      CP=0.                                                              TRIPLE    385
      DO 4600 I=1,NDS                                                    TRIPLE    386
      DO 4500 J=1,NN                                                     TRIPLE    387
 4500 CP=CP+A(I,J)*FLOAT(J-2)*TT1**(J-3)*CSH5(I)                         TRIPLE    388
 4600 CONTINUE                                                           TRIPLE    389
      FM1=UU1/SQRT(CP/(CP-RCON/ZMWSH1)*TT1*RCON*HJ/ZMWSH1)               TRIPLE    390
      WRITE(6,54)                                                        TRIPLE    391
   54 FORMAT(1H0,* PROPERTIES DOWNSTREAM OF STRONG SHOCK ARE* )          TRIPLE    392
      WRITE(6,11) PP1,TT1,UU1,TH1,DEL1,FM1                               TRIPLE    393
   11 FORMAT(10X,* P=*,E10.3,* T=*,E10.3,* U=*,E10.3,* TH1=*,E10.3,* DEL TRIPLE    394
     *1=*,E10.3,* MA=*,E10.3)                                            TRIPLE    395
      THTP=FLANG                                                         TRIPLE    396
      BAO = ABS(TH1)-FLANG                                               TRIPLE    397
      SLANG=THTP+ABS (DEL1)                                              TRIPLE    398
      SHANG=ABS(TH3)-ABS(DEL2-THTP)                                      TRIPLE    399
      WRITE(6,56) SHANG,BAO,SLANG                                        TRIPLE    400
   56 FORMAT(2H0,* WEAK SHOCK ANGLE=*,E10.3,* STRONG SHOCK ANGLE=*,E10.3 TRIPLE    401
     1,* SLIP LINE ANGLE=*,E10.3)                                        TRIPLE    402
      WRITE(6,50)IDO                                                     TRIPLE    403
   50 FORMAT(5X,* NUMBER OF ITERATION=*,I5)                              TRIPLE    404
 4400 RETURN                                                             18JUNE     13
      END                                                                TRIPLE    406
      SUBROUTINE BNDRY                                                   BNDRY       2
C     THIS SUBROUTINE HANDLES MOST BOUNDARY CONDITIONS                   BNDRY       3
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    BNDRY       5
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         BNDRY       6
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        BNDRY       7
     * ,      MAP                                                        BNDRY       8
      EQUIVALENCE (MOVE,IEXTRA(15))                                      BNDRY       9
      EQUIVALENCE (PWSH,EXTRA(11))                                       BNDRY      10
      IF (MOVE) 4950,50,4950                                             BNDRY      11
   50 IF (NBOUND) 3100,100,3100                                          BNDRY      12
C     WALL CONDITIONS                                                    BNDRY      13
  100 K=1                                                                BNDRY      14
      IF (ITYPE-2) 200,110,101                                           BNDRY      15
  110 PWSH=PW(1)+(PW(2)-PW(1))*S/SW(2)                                   BNDRY      16
      GO TO 101                                                          BNDRY      17
C     SHOCK BOUNDARY                                                     BNDRY      18
  101 IF (IFLAG) 103,102,103                                             BNDRY      19
  102 DPDY(K)=2.0*(P(K+1)-PWSH)/(Y(K+1)-Y(K))                            BNDRY      20
      DPHIDS(K)=-DPDY(K)*BETAP/(RHO(K+1)*U(K+1)**2)                      BNDRY      21
      GO TO 104                                                          BNDRY      22
  103 DPDY(K)=2.0*(P2(K+1)-PWSH)/(Y2(K+1)-Y(K))                          BNDRY      23
      DPHODS   =-DPDY(K)*BETAP/(RHO2(K+1)*U2(K+1)**2)                    BNDRY      24
      DPHIDS(K)=.45*DPHIDS(K)+.55*DPHODS                                 BNDRY      25
  104 PHI2(K)=PHI(K)+DPHIDS(K)*DLS(K)                                    BNDRY      26
      IF (ABS(PHI2(K)-PHI(K))-10.0**(-4)) 105,105,106                    BNDRY      27
  105 X2(K)=X(K)+DLS(K)*COS(PHI(K))                                      BNDRY      28
      R2(K)=R(K)+DLS(K)*SIN(PHI(K))                                      BNDRY      29
      GO TO 107                                                          BNDRY      30
  106 RADW=DLS(K)/(PHI(K)-PHI2(K))                                       BNDRY      31
      XO=X(K)+RADW*SIN(PHI(K))                                           BNDRY      32
      RO=R(K)-RADW*COS(PHI(K))                                           BNDRY      33
      X2(K)=XO-RADW*SIN(PHI2(K))                                         BNDRY      34
      R2(K)=RO+RADW*COS(PHI2(K))                                         BNDRY      35
  107 Y2(K)=0.0                                                          BNDRY      36
      Y(K)=0.0                                                           BNDRY      37
      MAX=KMAX                                                           BNDRY      38
      IF (ITYPE-3) 575,1075,1075                                         BNDRY      39
 1075 CALL SHOCKE                                                        BNDRY      40
      IF (KMAX-MAX) 108,108,109                                          BNDRY      41
  108 K=1                                                                BNDRY      42
      GO TO 575                                                          BNDRY      43
  109 K=2                                                                BNDRY      44
      GO TO 575                                                          BNDRY      45
  200 M=1                                                                BNDRY      46
      MAX=KMAX                                                           BNDRY      47
C     FIXED WALL                                                         BNDRY      48
  300 IF (S-SW(M+1)) 500,500,400                                         BNDRY      49
  400 M=M+1                                                              BNDRY      50
      IF (M-MMAX) 300,300,9030                                           BNDRY      51
  500 K=1                                                                BNDRY      52
      Y(K)=0.0                                                           BNDRY      53
      Y2(K)=0.0                                                          BNDRY      54
      PHI2(K)=PHIW(M)+(PHIW(M+1)-PHIW(M))*(S-SW(M))/(SW(M+1)-SW(M))      BNDRY      55
      IF (ABS(PHIW(M+1)-PHIW(M))-10.**(-4)) 525,525,550                  BNDRY      56
  525 X2(K)=XW(M)+(XW(M+1)-XW(M))*(S-SW(M))/(SW(M+1)-SW(M))              BNDRY      57
      R2(K)=RW(M)+(RW(M+1)-RW(M))*(S-SW(M))/(SW(M+1)-SW(M))              BNDRY      58
      GO TO 575                                                          BNDRY      59
  550 RADW=DELSO/(PHI(K)-PHI2(K))                                        BNDRY      60
      XO=X(K)+RADW*SIN(PHI(K))                                           BNDRY      61
      RO=R(K)-RADW*COS(PHI(K))                                           BNDRY      62
      X2(K)=XO-RADW*SIN(PHI2(K))                                         BNDRY      63
      R2(K)=RADW*COS(PHI2(K))+RO                                         BNDRY      64
  575 IF (IFLAG) 600,900,600                                             BNDRY      65
  600 RBAR(K)=.5*(R(K)+R2(K))                                            BNDRY      66
      RBAR(K+1)=.5*(R(K+1)+R2(K+1))                                      BNDRY      67
      YABAR=.5*(Y(K+1)+Y2(K+1))                                          BNDRY      68
      YBBAR=0.0                                                          BNDRY      69
      UBAR(K+1)=SQRT(.5*(U(K+1)**2+U2(K+1)**2))                          BNDRY      70
      RHABAR=.5*(RHO(K+1)+RHO2(K+1))                                     BNDRY      71
      TABAR=.5*(T(K+1)+T2(K+1))                                          BNDRY      72
      PABAR=.5*(P(K+1)+P2(K+1))                                          BNDRY      73
      MW2=0.0                                                            BNDRY      74
      DO 700 I=1,NDS                                                     BNDRY      75
      CABAR(I)=.5*(C(I,K+1)+C2(I,K+1))                                   BNDRY      76
  700 MW2=MW2+CABAR(I)/MW(I)                                             BNDRY      77
      MW2=1.0/MW2                                                        BNDRY      78
      DO 800 I=1,NDS                                                     BNDRY      79
      XABAR(I)=CABAR(I)*MW2/MW(I)                                        BNDRY      80
      H2PM(I)=0.0                                                        BNDRY      81
      HPM(I)=0.0                                                         BNDRY      82
      DO 800 J=1,NN                                                      BNDRY      83
  800 HPM(I)=HPM(I)+A(I,J)*TABAR**(J-2)                                  BNDRY      84
      GO TO 1050                                                         BNDRY      85
  900 RBAR(K)=R(K)                                                       BNDRY      86
      RBAR(K+1)=R(K+1)                                                   BNDRY      87
      YABAR=Y(K+1)                                                       BNDRY      88
      YBBAR=0.0                                                          BNDRY      89
      UBAR(K+1)=U(K+1)                                                   BNDRY      90
      RHABAR=RHO(K+1)                                                    BNDRY      91
      TABAR=T(K+1)                                                       BNDRY      92
      PABAR=P(K+1)                                                       BNDRY      93
      DO 1000 I=1,NDS                                                    BNDRY      94
      CABAR(I)=C(I,K+1)                                                  BNDRY      95
      XABAR(I)=XS(I,K+1)                                                 BNDRY      96
      H2PM(I)=0.0                                                        BNDRY      97
      HPM(I)=0.0                                                         BNDRY      98
      DO 1000 J=1,NN                                                     BNDRY      99
 1000 HPM(I)=HPM(I)+A(I,J)*T(K+1)**(J-2)                                 BNDRY     100
 1050 IF (IEXTRA(1).EQ.0) GO TO 1200                                     BNDRY     101
      KK=K+1                                                             BNDRY     102
      CALL TRANSP (TABAR,PABAR,KK)                                       BNDRY     103
 1200 TAW(K)=0.0                                                         BNDRY     104
      Q(K)=0.0                                                           BNDRY     105
      DO 1300 I=1,NDS                                                    BNDRY     106
 1300 ZJ(I,K)=0.0                                                        BNDRY     107
      IF(KMAX-MAX)1510,1510,1520                                         BNDRY     108
 1510 K=2                                                                BNDRY     109
      GO TO 10000                                                        BNDRY     110
 1520 K=3                                                                BNDRY     111
      GO TO 10000                                                        BNDRY     112
C     OUTER BOUNDARY CONDITIONS                                          BNDRY     113
 3100 N=1                                                                BNDRY     114
      IF (LL) 3110,3110,3190                                             BNDRY     115
 3110 D=SQRT((X(K)-XB(N))**2+(R(K)-RB(N))**2)                            BNDRY     116
      IF (ABS(PHI(K)-PHIB(N))-1.E-04) 3120,3120,3130                     BNDRY     117
 3120 SX(K)=D                                                            BNDRY     118
      GO TO 3190                                                         BNDRY     119
 3130 SX(K)=D*(PHI(K)-PHIB(N))/(2.*SIN(0.5*(PHI(K)-PHIB(N))))            BNDRY     120
 3190 GO TO (3200,5000,5100,5700), IKIND                                 BNDRY     121
C     FIXED BOUNDARY                                                     BNDRY     122
 3200 N=1                                                                BNDRY     123
      SSX=SX(K)+DLS(K-1)                                                 BNDRY     124
 3300 IF (SSX-SB(N+1)) 3500,3500,3400                                    BNDRY     125
 3400 N=N+1                                                              BNDRY     126
      IF (N-NMAX) 3300,9050,9050                                         BNDRY     127
 3500 IF (ABS(PHIB(N+1)-PHIB(N))-1.E-04) 3600,3600,3700                  BNDRY     128
 3600 PHIBAR=0.5*(PHI2(K-1)+PHIB(N))                                     BNDRY     129
      TPHBR=TAN(PHIBAR)                                                  BNDRY     130
      IF (ABS(PHIBAR)-1.E-04) 3620,3620,3640                             BNDRY     131
 3620 X2(K)=X2(K-1)                                                      BNDRY     132
      GO TO 3660                                                         BNDRY     133
 3640 X2(K)=(R2(K-1)-R(K)+TAN(PHIB(N))*X(K)+X2(K-1)/TPHBR      )/(TAN(PH BNDRY     134
     *IB(N))+1./ TPHBR)                                                  BNDRY     135
 3660 R2(K)=R(K)+TAN(PHIB(N))*(X2(K)-X(K))                               BNDRY     136
      PHI2(K)=PHIB(N)                                                    BNDRY     137
      GO TO 4200                                                         BNDRY     138
 3700 RADB=(SB(N+1)-SB(N))/(PHIB(N)-PHIB(N+1))                           BNDRY     139
      ELL1=SQRT((XB(N+1)-XB(N))**2+(RB(N+1)-RB(N))**2)                   BNDRY     140
      ELL2=SQRT(RADB**2-ELL1**2/4.)                                      BNDRY     141
      FIOTA=ATAN((RB(N+1)-RB(N))/(XB(N+1)-XB(N)))                        BNDRY     142
      IF (RADB) 3740,3740,3720                                           BNDRY     143
 3720 XX=XB(N)+.5*(XB(N+1)-XB(N))+ELL2*SIN(FIOTA)                        BNDRY     144
      RR=RB(N)+.5*(RB(N+1)-RB(N))-ELL2*COS(FIOTA)                        BNDRY     145
      GO TO 3800                                                         BNDRY     146
 3740 XX=XB(N)+.5*(XB(N+1)-XB(N))-ELL2*SIN(FIOTA)                        BNDRY     147
      RR=RB(N)+.5*(RB(N+1)-RB(N))+ELL2*COS(FIOTA)                        BNDRY     148
 3800 L=1                                                                BNDRY     149
      EKS=X(K)+DLS(K-1)*COS(PHI(K))                                      BNDRY     150
      IF (RADB) 3820,3840,3840                                           BNDRY     151
 3820 AHR=RR-SQRT(RADB**2-(EKS-XX)**2)                                   BNDRY     152
      GO TO 3900                                                         BNDRY     153
 3840 AHR=RR+SQRT(RADB**2-(EKS-XX)**2)                                   BNDRY     154
 3900 PHIBAR=.5*(PHI2(K-1)+ATAN((EKS-XX)/(RR-AHR)))                      BNDRY     155
      TPHBR=TAN(PHIBAR)                                                  BNDRY     156
      GEE=(R2(K-1)-RR-(EKS-X2(K-1))/TPHBR      )**2-RADB**2+(EKS-XX)**2  BNDRY     157
      DRDX=(EKS-XX)/SQRT(RADB**2-(EKS-XX)**2)                            BNDRY     158
      IF (RADB) 3910,3910,3905                                           BNDRY     159
 3905 DRDX=-DRDX                                                         BNDRY     160
 3910 DPHDX=-.5*((AHR-RR)-(EKS-XX)*DRDX)/RADB**2                         BNDRY     161
      DTPH=DPHDX/(COS(PHIBAR))**2                                        BNDRY     162
      DGEEDX=2.*((EKS-XX)-(R2(K-1)-RR-(EKS-X2(K-1))/TPHBR      )*(1./    BNDRY     163
     *TPHBR   -(EKS-X2(K-1))*DTPH/(TAN(PHIBAR))**2))                     BNDRY     164
      DX=-GEE/DGEEDX                                                     BNDRY     165
      L=L+1                                                              BNDRY     166
      EKS=EKS+DX                                                         BNDRY     167
      IF (RADB) 3920,3940,3940                                           BNDRY     168
 3920 AHR=RR-SQRT(RADB**2-(EKS-XX)**2)                                   BNDRY     169
      GO TO 4000                                                         BNDRY     170
 3940 AHR=RR+SQRT(RADB**2-(EKS-XX)**2)                                   BNDRY     171
 4000 IF (L-4) 3900,4100,4100                                            BNDRY     172
 4100 X2(K)=EKS                                                          BNDRY     173
      R2(K)=AHR                                                          BNDRY     174
      PHI2(K)=-ATAN((EKS-XX)/(AHR-RR))                                   BNDRY     175
 4200 D=SQRT((X2(K)-X(K))**2+(R2(K)-R(K))**2)                            BNDRY     176
      IF (ABS(PHI2(K)-PHI(K))-1.E-04) 4300,4300,4400                     BNDRY     177
 4300 DLS(K)=D                                                           BNDRY     178
      GO TO 4500                                                         BNDRY     179
 4400 DLS(K)=D*(PHI2(K)-PHI(K))/(2.*SIN(0.5*(PHI2(K)-PHI(K))))           BNDRY     180
 4500 B=SQRT((X2(K)-X2(K-1))**2+(R2(K)-R2(K-1))**2)                      BNDRY     181
      IF (ABS(PHI2(K)-PHI2(K-1))-1.E-04) 4600,4600,4700                  BNDRY     182
 4600 DELY(K)=B                                                          BNDRY     183
      GO TO 4800                                                         BNDRY     184
 4700 DELY(K)=B*(PHI2(K)-PHI2(K-1))/(2.0*SIN(.5*(PHI2(K)-PHI2(K-1))))    BNDRY     185
 4800 AA(K)=PI*(R2(K)+R2(K-1))**DELTA*DELY(K)                            BNDRY     186
      Y2(K)=Y2(K-1)+DELY(K)                                              BNDRY     187
      CALL STEP                                                          BNDRY     188
 4950 MOVE=0                                                             BNDRY     189
      GO TO 10000                                                        BNDRY     190
C     FREE BOUNDARY                                                      BNDRY     191
 5000 N=1                                                                BNDRY     192
      PBS=PB(N)+(PB(N+1)-PB(N))*(S2X-SB(N))/(SB(N+1)-SB(N))              BNDRY     193
      GO TO 5700                                                         BNDRY     194
C     NEWTONIAN BOUNDARY                                                 BNDRY     195
 5100 FMSTRM=0.0                                                         BNDRY     196
      DO 5300 I=1,NDS                                                    BNDRY     197
 5300 FMSTRM=FMSTRM+CSTREM(I)/MW(I)                                      BNDRY     198
      FMSTRM=1.0/FMSTRM                                                  BNDRY     199
      QSTRM=PSTREM*FMSTRM*(USTREM**2)/(RV*TSTREM*BETAP)                  BNDRY     200
      IF(IFLAG)5525,5500,5525                                            BNDRY     201
 5500 SIGMA=PHI(K)-PHSTRM                                                BNDRY     202
      GO TO 5550                                                         BNDRY     203
 5525 SIGMA=.5*(PHI(K)+PHI2(K))-PHSTRM                                   BNDRY     204
 5550 IF (SIGMA) 5575,5575,5600                                          BNDRY     205
 5575 PBS=PSTREM                                                         BNDRY     206
      GO TO 5700                                                         BNDRY     207
 5600 IF (SIGMA-0.5*PI) 5650,5650,5625                                   BNDRY     208
 5625 PBS=PSTREM+QSTRM                                                   BNDRY     209
      GO TO 5700                                                         BNDRY     210
 5650 PBS=PSTREM+QSTRM *(SIN(SIGMA))**2                                  BNDRY     211
 5700 IF (IFLAG) 5900,5800,5900                                          BNDRY     212
 5800 DPDY(K)=2.0*(PBS-P(K))/(Y(K)-Y(K-1))                               BNDRY     213
      DPHIDS(K)=-DPDY(K)*BETAP/(RHO(K)*U(K)**2)                          BNDRY     214
      GO TO 6000                                                         BNDRY     215
 5900 DPDY(K)=2.0*(PBS-P2(K))/(Y2(K)-Y2(K-1))                            BNDRY     216
      DPHODS=-DPDY(K)*BETAP/(RHO2(K)*U2(K)**2)                           BNDRY     217
      DPHIDS(K)=.45*DPHIDS(K)+.55*DPHODS                                 BNDRY     218
 6000 MOVE=1                                                             BNDRY     219
      RETURN                                                             BNDRY     220
C     ERROR MESSAGES                                                     BNDRY     221
      NUCASE=100                                                         BNDRY     222
      GO TO 9900                                                         BNDRY     223
 9030 NUCASE=400                                                         BNDRY     224
      GO TO 9900                                                         BNDRY     225
 9050 NUCASE=3200                                                        BNDRY     226
 9900 IERROR=2                                                           BNDRY     227
10000 RETURN                                                             BNDRY     228
      END                                                                BNDRY     229
      SUBROUTINE CHEM(IKINE)                                             CHEM        2
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    CHEM        4
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         CHEM        5
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        CHEM        6
     * ,      MAP                                                        CHEM        7
      COMMON/CHEM1/ ZID(5), IRR(30),IRT(30),RC(30,3),IRRR(30,5),         CHEM        8
     1 AV,CM(21,21),FI(21),WP(21),                                       CHEM        9
     2 WM(21),WDOT(21,30),CSI(21),QX(21)                                 CHEM       10
      COMMON/IBUGS1/ IBUGSH                                              CHEM       11
      DIMENSION G(20),RP(20),RM(20)                                      CHEM       12
C   GAS CONSTANT IN 1.987 CAL/G-MOLE-K                                   CHEM       13
      RRT=1.987*T(K)                                                     CHEM       14
C   GAS CONSTANT IN 82.06 CM3-ATM/G-MOLE-K                               CHEM       15
      RRT1=82.06*T(K)                                                    CHEM       16
      XLLGT=ALOG(T(K)/1000.0)                                            CHEM       17
      DO 3 IR=1,NDS                                                      CHEM       18
      FI(IR)=C(IR,K)/MW(IR)                                              CHEM       19
      QX(IR)=0.0                                                         CHEM       20
      WP(IR)=0.0                                                         CHEM       21
      WM(IR)=0.0                                                         CHEM       22
      WDOT(IR,K)=0.0                                                     CHEM       23
      DO 4 JR=1,NDS                                                      CHEM       24
    4 CM(IR,JR)=0.0                                                      CHEM       25
    3 CONTINUE                                                           CHEM       26
C     CALCULATING GIBBS ENERGY                                           CHEM       27
      DO 6 IR=1,NDS                                                      CHEM       28
      G(IR)=A(IR,1)*.5/T(K)+(A(IR,3)*(1.-XLLGT) -CSI(IR))*T(K)+A(IR,2)   CHEM       29
      IF (NN.LT.4) GO TO 7                                               CHEM       30
      G(IR)=G(IR)-A(IR,4)*T(K)**2-.5*A(IR,5)*T(K)**3-A(IR,6)/3.*T(K)**4  CHEM       31
    7 G(IR)= G(IR)*MW(IR)                                                CHEM       32
C  CALCULATE GIBBS ENERGY IN CAL/MOLE                                    CHEM       33
    6 CONTINUE                                                           CHEM       34
      DO 1 IR=1,IKINE                                                    CHEM       35
      KIRT=IRT(IR)                                                       CHEM       36
      GO TO (841,842,843,844,845,846,847,848),KIRT                       CHEM       37
  848 RKF=RC(IR,1)*(T(K)**RC(IR,2))*EXP(RC(IR,3)/RRT)                    CHEM       38
      GO TO 849                                                          CHEM       39
  841 RKF=RC(IR,1)                                                       CHEM       40
      GO TO 849                                                          CHEM       41
  842 RKF=RC(IR,1)/T(K)                                                  CHEM       42
      GO TO 849                                                          CHEM       43
  843 RKF=RC(IR,1)/T(K)/T(K)                                             CHEM       44
      GO TO 849                                                          CHEM       45
  844 RKF=RC(IR,1)/SQRT(T(K))                                            CHEM       46
      GO TO 849                                                          CHEM       47
  845 RKF=RC(IR,1)*EXP(RC(IR,3)/RRT)                                     CHEM       48
      GO TO 849                                                          CHEM       49
  846 RKF=RC(IR,1)*EXP(RC(IR,3)/RRT)/T(K)                                CHEM       50
      GO TO 849                                                          CHEM       51
  847 RKF=RC(IR,1)/T(K)/SQRT(T(K))                                       CHEM       52
  849 CONTINUE                                                           CHEM       53
      KIRR=IRR(IR)                                                       CHEM       54
      GO TO (851,852,853,854,855,856,857,858,859,860),KIRR               CHEM       55
  851 J1=IRRR(IR,1)                                                      CHEM       56
      J2=IRRR(IR,2)                                                      CHEM       57
      J3=IRRR(IR,3)                                                      CHEM       58
      J4=IRRR(IR,4)                                                      CHEM       59
      E=(G(J1)+G(J2)-G(J3)-G(J4))/RRT                                    CHEM       60
      IF (E.LT.-40.0) E=-40.0                                            CHEM       61
      IF (E .GT. +40.0) E=+40.0                                          CHEM       62
      E=EXP(E)                                                           CHEM       63
      CRR=RKF*RHO(K)                                                     CHEM       64
      RP(IR)=CRR*FI(J1)*FI(J2)                                           CHEM       65
      RM(IR)=CRR*FI(J3)*FI(J4)/E                                         CHEM       66
      DO 773 J=1,4                                                       CHEM       67
      SIGN=1.0                                                           CHEM       68
      IF (J .GT. 2) SIGN=-1.0                                            CHEM       69
      IROW=IRRR(IR,J)                                                    CHEM       70
      CM(IROW,J1)=CM(IROW,J1)+SIGN*CRR*FI(J2)                            CHEM       71
      CM(IROW,J2)=CM(IROW,J2)+SIGN*CRR*FI(J1)                            CHEM       72
      CM(IROW,J3)=CM(IROW,J3)-SIGN*CRR*FI(J4)/E                          CHEM       73
      CM(IROW,J4)=CM(IROW,J4)-SIGN*CRR*FI(J3)/E                          CHEM       74
      QX(IROW)=QX(IROW)+SIGN*(RP(IR)-RM(IR))                             CHEM       75
  773 CONTINUE                                                           CHEM       76
      GO TO 867                                                          CHEM       77
  852 J1=IRRR(IR,1)                                                      CHEM       78
      J2=IRRR(IR,2)                                                      CHEM       79
      J3=IRRR(IR,3)                                                      CHEM       80
      E=(G(J1)+G(J2)-G(J3))/RRT                                          CHEM       81
      IF (E .LT. -40.0) E=-40.0                                          CHEM       82
      IF (E .GT. +40.0) E=+40.0                                          CHEM       83
      E=EXP(E)                                                           CHEM       84
      CRR=RKF*RHO(K)/ZMW*AV                                              CHEM       85
      RP(IR)=CRR*RHO(K)*FI(J1)*FI(J2)                                    CHEM       86
      RM(IR)=CRR*FI(J3)/(E*RRT1)                                         CHEM       87
      DO  774 J=1,3                                                      CHEM       88
      SIGN=1.0                                                           CHEM       89
      IF (J .GT. 2) SIGN =-1.0                                           CHEM       90
      IROW=IRRR(IR,J)                                                    CHEM       91
      CM(IROW,J1)=CM(IROW,J1)+SIGN*CRR*RHO(K)*FI(J2)                     CHEM       92
      CM(IROW,J2)=CM(IROW,J2)+SIGN*CRR*RHO(K)*FI(J1)                     CHEM       93
      CM(IROW,J3)=CM(IROW,J3)-SIGN*CRR/(E*RRT1)                          CHEM       94
      QX(IROW)= QX(IROW)+SIGN*RP(IR)                                     CHEM       95
  774 CONTINUE                                                           CHEM       96
      GO TO 868                                                          CHEM       97
  853 J1=IRRR(IR,1)                                                      CHEM       98
      J2=IRRR(IR,2)                                                      CHEM       99
      J3=IRRR(IR,3)                                                      CHEM      100
      J4=IRRR(IR,4)                                                      CHEM      101
      J5=IRRR(IR,5)                                                      CHEM      102
      E=(G(J1)+G(J2)-G(J3)-G(J4)-G(J5))/RRT                              CHEM      103
      IF (E .LT. - 40.0) E=-40.0                                         CHEM      104
      IF (E .GT. +40.0) E=+40.0                                          CHEM      105
      E=EXP (E)                                                          CHEM      106
      CRR=RKF*RHO(K)                                                     CHEM      107
      RP(IR)=CRR*FI(J1)*FI(J2)                                           CHEM      108
      RM(IR)=CRR*FI(J3)*FI(J4)*FI(J5)*RHO(K)*RRT1/E                      CHEM      109
      DO 775 J=1,5                                                       CHEM      110
      SIGN = 1.0                                                         CHEM      111
      IF (J .GT. 2) SIGN =-1.0                                           CHEM      112
      IROW=IRRR(IR,J)                                                    CHEM      113
      CM(IROW,J1)=CM(IROW,J1)+SIGN*CRR*FI(J2)                            CHEM      114
      CM(IROW,J2)=CM(IROW,J2)+SIGN*CRR*FI(J1)                            CHEM      115
      CM(IROW,J3)=CM(IROW,J3)-SIGN*CRR*FI(J4)*FI(J5)*RHO(K)*RRT1/E       CHEM      116
      CM(IROW,J4)=CM(IROW,J4)-SIGN*CRR*FI(J3)*FI(J5)*RHO(K)*RRT1/E       CHEM      117
      CM(IROW,J5)=CM(IROW,J5)-SIGN*CRR*FI(J3)*FI(J4)*RHO(K)*RRT1/E       CHEM      118
      QX(IROW)=QX(IROW)+SIGN*(RP(IR)-2.0*RM(IR))                         CHEM      119
  775 CONTINUE                                                           CHEM      120
      GO TO 861                                                          CHEM      121
  854 J1=IRRR(IR,1)                                                      CHEM      122
      J2=IRRR(IR,2)                                                      CHEM      123
      J3=IRRR(IR,3)                                                      CHEM      124
      E=(G(J1)+G(J2)-G(J3))/RRT                                          CHEM      125
      IF (E .LT. -40.0) E=-40.0                                          CHEM      126
      IF (E .GT. +40.0) E=+40.0                                          CHEM      127
      E=EXP(E)                                                           CHEM      128
      CRR=RKF*RHO(K)                                                     CHEM      129
      RP(IR)=CRR*FI(J1)*FI(J2)                                           CHEM      130
      RM(IR)=CRR*FI(J3)/E/RRT1*RHO(K)                                    CHEM      131
      DO 771 J=1,3                                                       CHEM      132
      SIGN=1.0                                                           CHEM      133
      IF (J .GT. 2) SIGN = -1.0                                          CHEM      134
      IROW = IRRR(IR,J)                                                  CHEM      135
      CM(IROW,J1)=CM(IROW,J1)+SIGN*CRR*RHO(K)*FI(J2)                     CHEM      136
      CM(IROW,J2)=CM(IROW,J2)+SIGN*CRR*RHO(K)*FI(J1)                     CHEM      137
      CM(IROW,J3)=CM(IROW,J3)-SIGN*CRR/(E*RRT1 )*RHO(K)                  CHEM      138
      QX(IROW)=QX(IROW)+SIGN*RP(IR)                                      CHEM      139
  771 CONTINUE                                                           CHEM      140
      GO TO 868                                                          CHEM      141
  855 J1=IRRR(IR,1)                                                      CHEM      142
      J2=NDS+1                                                           CHEM      143
      J3=IRRR(IR,3)                                                      CHEM      144
      J4=IRRR(IR,4)                                                      CHEM      145
      E=(G(J1)-G(J3)-G(J4))/RRT                                          CHEM      146
      IF (E .LT. -40.0) E= -40.0                                         CHEM      147
      IF (E .GT. +40.0) E=+40.0                                          CHEM      148
      E=EXP (E)                                                          CHEM      149
      CRR=RKF*RHO(K)/ZMW                                                 CHEM      150
      RP(IR)=CRR*FI(J1)                                                  CHEM      151
      RM(IR)=CRR*RRT1*RHO(K)*FI(J3)*FI(J4)/E                             CHEM      152
      DO 772 J=1,4                                                       CHEM      153
      IF (J .EQ. 2) GO TO 772                                            CHEM      154
      SIGN =1.0                                                          CHEM      155
      IF (J .GT. 2) SIGN=-1.0                                            CHEM      156
      IROW=IRRR(IR,J)                                                    CHEM      157
      CM(IROW,J1)=CM(IROW,J1)+SIGN*CRR                                   CHEM      158
      CM(IROW,J3)=CM(IROW,J3)-SIGN*CRR*RRT1*RHO(K)*FI(J4)/E              CHEM      159
      CM(IROW,J4)=CM(IROW,J4)-SIGN*CRR*RRT1*RHO(K)*FI(J3)/E              CHEM      160
      QX(IROW)=QX(IROW)-SIGN*RM(IR)                                      CHEM      161
  772 CONTINUE                                                           CHEM      162
      GO TO 867                                                          CHEM      163
  856 J1=IRRR(IR,1)                                                      CHEM      164
      J2=IRRR(IR,2)                                                      CHEM      165
      J3=IRRR(IR,3)                                                      CHEM      166
      J4=IRRR(IR,4)                                                      CHEM      167
      CRR=RKF*RHO(K)                                                     CHEM      168
      RP(IR)=CRR*FI(J1)*FI(J2)                                           CHEM      169
      RM(IR)=0.0                                                         CHEM      170
      DO 778 J=1,4                                                       CHEM      171
      SIGN=1.0                                                           CHEM      172
      IF (J .GT. 2) SIGN=-1.0                                            CHEM      173
      IROW=IRRR(IR,J)                                                    CHEM      174
      CM(IROW,J1)=CM(IROW,J1)+SIGN*CRR*FI(J2)                            CHEM      175
      CM(IROW,J2)=CM(IROW,J2)+SIGN*CRR*FI(J1)                            CHEM      176
      QX(IROW)=QX(IROW)+SIGN*RP(IR)                                      CHEM      177
  778 CONTINUE                                                           CHEM      178
      GO TO 867                                                          CHEM      179
  857 J1=IRRR(IR,1)                                                      CHEM      180
      J2=IRRR(IR,2)                                                      CHEM      181
      J3=IRRR(IR,3)                                                      CHEM      182
      CRR=RKF*RHO(K)*AV/ZMW                                              CHEM      183
      RP(IR)=CRR*RHO(K)*FI(J1)*FI(J2)                                    CHEM      184
      RM(IR)=0.0                                                         CHEM      185
      DO 779 J=1,3                                                       CHEM      186
      SIGN=1.0                                                           CHEM      187
      IF (J .GT.2) SIGN=-1.0                                             CHEM      188
      IROW=IRRR(IR,J)                                                    CHEM      189
      CM(IROW,J1)= CM(IROW,J1)+SIGN*CRR*RHO(K)*FI(J2)                    CHEM      190
      CM(IROW,J2)= CM(IROW,J2)+SIGN*CRR*RHO(K)*FI(J1)                    CHEM      191
      QX(IROW)=QX(IROW)+SIGN*RP(IR)                                      CHEM      192
  779 CONTINUE                                                           CHEM      193
      GO TO 868                                                          CHEM      194
  858 J1=IRRR(IR,1)                                                      CHEM      195
      J2=IRRR(IR,2)                                                      CHEM      196
      J3=IRRR(IR,3)                                                      CHEM      197
      J4=IRRR(IR,4)                                                      CHEM      198
      J5=IRRR(IR,5)                                                      CHEM      199
      CRR =RKF*RHO(K)                                                    CHEM      200
      RP(IR)=CRR *FI(J1)*FI(J2)                                          CHEM      201
      RM(IR)=0.0                                                         CHEM      202
      DO 780 J=1,5                                                       CHEM      203
      SIGN=1.0                                                           CHEM      204
      IF (J .GT. 2) SIGN=-1.0                                            CHEM      205
      IROW=IRRR(IR,J)                                                    CHEM      206
      CM(IROW,J1)=CM(IROW,J1)+SIGN*CRR*FI(J2)                            CHEM      207
      CM(IROW,J2)=CM(IROW,J2)+SIGN*CRR*FI(J1)                            CHEM      208
      QX(IROW)=QX(IROW)+SIGN*RP(IR)                                      CHEM      209
  780 CONTINUE                                                           CHEM      210
      GO TO 861                                                          CHEM      211
  859 J1=IRRR(IR,1)                                                      CHEM      212
      J2=IRRR(IR,2)                                                      CHEM      213
      J3=IRRR(IR,3)                                                      CHEM      214
      CRR=RKF                                                            CHEM      215
      RP(IR)=CRR*RHO(K)*FI(J1)*FI(J2)                                    CHEM      216
      RM(IR)=0.0                                                         CHEM      217
      DO 776 J=1,3                                                       CHEM      218
      SIGN=1.0                                                           CHEM      219
      IF (J .GT. 2) SIGN =-1.0                                           CHEM      220
      IROW = IRRR(IR,J)                                                  CHEM      221
      CM(IROW,J1)=CM(IROW,J1)+SIGN*CRR*RHO(K)*FI(J2)                     CHEM      222
      CM(IROW,J2)=CM(IROW,J2)+SIGN*CRR*RHO(K)*FI(J1)                     CHEM      223
      QX(IROW)=QX(IROW)+SIGN*RP(IR)                                      CHEM      224
  776 CONTINUE                                                           CHEM      225
      GO TO 868                                                          CHEM      226
  860 J1=IRRR(IR,1)                                                      CHEM      227
      J2=NDS+1                                                           CHEM      228
      J3=IRRR(IR,3)                                                      CHEM      229
      J4=IRRR(IR,4)                                                      CHEM      230
      CRR=RKF*RHO(K)/ZMW                                                 CHEM      231
      RP(IR)=CRR*FI(J1)                                                  CHEM      232
      RM(IR)=0.0                                                         CHEM      233
      DO 777 J=1,4                                                       CHEM      234
      IF (J .EQ. 2) GO TO 777                                            CHEM      235
      SIGN=1.0                                                           CHEM      236
      IF (J .GT. 2) SIGN=-1.0                                            CHEM      237
      IROW = IRRR(IR,J)                                                  CHEM      238
      CM(IROW,J1)=CM(IROW,J1)+SIGN*CRR                                   CHEM      239
  777 CONTINUE                                                           CHEM      240
      GO TO 867                                                          CHEM      241
  861 WP(J5)=WP(J5)+RP(IR)                                               CHEM      242
      WM(J5)=WM(J5)+RM(IR)                                               CHEM      243
  867 WP(J4)=WP(J4)+RP(IR)                                               CHEM      244
      WM(J4)=WM(J4)+RM(IR)                                               CHEM      245
  868 WP(J3)=WP(J3)+RP(IR)                                               CHEM      246
      WM(J3)=WM(J3)+RM(IR)                                               CHEM      247
      WP(J2)=WP(J2)-RP(IR)                                               CHEM      248
      WM(J2)=WM(J2)-RM(IR)                                               CHEM      249
      WP(J1)=WP(J1)-RP(IR)                                               CHEM      250
      WM(J1)=WM(J1)-RM(IR)                                               CHEM      251
    1 CONTINUE                                                           CHEM      252
      DO 897 J=1,NDS                                                     CHEM      253
C      PRODUCTION RATE IN MOLE/GM-CM                                     CHEM      254
      WDOT(J,K)=(WP(J)-WM(J))/U(K)                                       CHEM      255
      WDOT(J,K)=WDOT(J,K)*MW(J)                                          18JUNE     14
      IF(T(K).LT.350.)WDOT(J,K)=0.                                       21OCT       3
  897 CONTINUE                                                           CHEM      256
      DSUK=DLS(K)/U(K)                                                   CHEM      257
      DO 10 IR=1,NDS                                                     CHEM      258
      DSWUK=DSUK                                                         18JUNE     15
      QX(IR)=C(IR,K)/MW(IR)+RHS(IR)/MW(IR)/MDOT(K)+DSWUK*QX(IR)          18JUNE     16
      DO 11 JR=1,NDS                                                     CHEM      261
      CM(IR,JR)= CM(IR,JR)*DSWUK                                         CHEM      262
      IF (IR.EQ.JR) CM(IR,JR)= 1.0+CM(IR,JR)                             CHEM      263
   11 CONTINUE                                                           CHEM      264
      IF (IBUGSH .NE. 0)                                                 CHEM      265
     *WRITE(6,100) K,IR,(CM(IR,JR),JR=1,NDS),QX(IR)                      CHEM      266
  100 FORMAT(1X,2I5,1P8E12.3)                                            CHEM      267
   10 CONTINUE                                                           CHEM      268
      CALL SLDP(QX,CM,NDS)                                               CHEM      269
      DO 12 IR=1,NDS                                                     CHEM      270
      IF (IBUGSH .NE. 0)                                                 CHEM      271
     *WRITE(6,100) K,IR,(CM(IR,JR),JR=1,NDS),QX(IR)                      CHEM      272
      C2(IR,K)=QX(IR)*MW(IR)                                             18JUNE     17
C     CALCULATE NEW MASS FRACTION OF SPECIES                             CHEM      274
   12 CONTINUE                                                           CHEM      275
      RETURN                                                             CHEM      276
      END                                                                CHEM      277
      SUBROUTINE COMBO(L)                                                COMBO       2
C     THIS SUBROUTINE COMBINES TWO STREAMTUBES, CONSERVING MASS,         COMBO       3
C     MOMENTIM, AND ENERGY, WHENEVER THE ALLOWED STEPPING DISTANCE       COMBO       4
C     BECOMES TOO LOW.                                                   COMBO       5
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    COMBO       7
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         COMBO       8
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        COMBO       9
     * ,      MAP                                                        COMBO      10
      COMMON/IBUGS1/ IBUGSH                                              COMBO      11
      DIMENSION FTEST(3), NTEST(3)                                       COMBO      12
      IF ((LL.LT.10).AND.(KMN.GT.1)) GO TO 10000                         COMBO      13
      IF (PAR(10).EQ.0.0) GO TO 610                                      11AUG      45
      JAZZ=PAR(10)                                                       11AUG      46
      IF ((LL.LT.JAZZ).AND.(KMN.GT.1)) GO TO 10000                       11AUG      47
  610 CONTINUE                                                           11AUG      48
      SUMDOT=0.0                                                         COMBO      14
      DO 50 KK=2,KMAX                                                    COMBO      15
   50 SUMDOT=SUMDOT+MDOT(KK)                                             COMBO      16
      IF((ISB.EQ.1).AND.(KMAX.GT.28)) GO TO 100                          COMBO      17
      IF (MDOT(L)/(.5*(R(L)+R(L-1)))**2-SUMDOT/(1.5*(.5*(R(2)+R(KMAX)))* COMBO      18
     **2*FSTEP)) 100,10000,10000                                         COMBO      19
C     SETUP OF TESTS TO DETERMINE IF GRADIENTS ARE TOO HIGH TO ALLOW     COMBO      20
C     COMBINING TUBES                                                    COMBO      21
  100 KI=L-1                                                             COMBO      22
      IF((L.LE.3).AND.(ISB.EQ.1)) GO TO 10000                            COMBO      23
      KF=L+1                                                             COMBO      24
      DO 150 L2=1,3                                                      COMBO      25
  150 NTEST(L2)=0                                                        COMBO      26
      NTRY=0                                                             COMBO      27
  190 GO TO (200,300,400,500),IPTUC                                      COMBO      28
  200 DO 250 KJ=KI,KF                                                    COMBO      29
      IARG=KJ-KI+1                                                       COMBO      30
  250 FTEST (IARG)=P(KJ)                                                 COMBO      31
      GO TO 600                                                          COMBO      32
  300 DO 350 KJ=KI,KF                                                    COMBO      33
      IARG=KJ-KI+1                                                       COMBO      34
  350 FTEST(IARG)=U(KJ)                                                  COMBO      35
      GO TO 600                                                          COMBO      36
  400 DO 450 KJ=KI,KF                                                    COMBO      37
      IARG=KJ-KI+1                                                       COMBO      38
  450 FTEST( IARG  )=U(KJ)                                               COMBO      39
      GO TO 600                                                          COMBO      40
  500 DO 550 KJ=KI,KF                                                    COMBO      41
      IARG=KJ-KI+1                                                       COMBO      42
  550 FTEST( IARG  )=C(1,KJ)                                             COMBO      43
      IF (ABS(FTEST(1)-FTEST(2))-1.E-05) 570,570,560                     COMBO      44
  560 IF (IEXTRA(1)) 570,565,570                                         COMBO      45
  565 NTEST(1)=1                                                         COMBO      46
  570 IF (ABS(FTEST(3)-FTEST(2))-1.E-05) 600,600,580                     COMBO      47
  580 IF (IEXTRA(1)) 600,585,600                                         COMBO      48
  585 NTEST(3)=1                                                         COMBO      49
  600 IF (L-KMAX) 700,900,900                                            COMBO      50
  700 IF (L-2) 1000,1000,800                                             COMBO      51
  800 IF (MDOT(L+1)-MDOT(L-1)) 1000,1000,900                             COMBO      52
  900 IF (L-2) 10000,10000,950                                           COMBO      53
  950 K2=KI                                                              COMBO      54
      L2=1                                                               COMBO      55
      RUP=R(L)                                                           COMBO      56
      RLO=R(KI-1)                                                        COMBO      57
      XUP=X(L)                                                           COMBO      58
      XLO=X(KI-1)                                                        COMBO      59
      PHIUP=PHI(L)                                                       COMBO      60
      PHILO=PHI(KI-1)                                                    COMBO      61
      GO TO 1100                                                         COMBO      62
 1000 IF (L-KMAX) 1050,10000,10000                                       COMBO      63
 1050 K2=KF                                                              COMBO      64
      L2=3                                                               COMBO      65
      RUP=R(KF)                                                          COMBO      66
      RLO=R(KI)                                                          COMBO      67
      XUP=X(KF)                                                          COMBO      68
      XLO=X(KI)                                                          COMBO      69
      PHIUP=PHI(KF)                                                      COMBO      70
      PHILO=PHI(KI)                                                      COMBO      71
 1100 IF (FTEST(2)) 1120,1105,1120                                       COMBO      72
 1105 IF (FTEST(L2)) 1110,1115,1110                                      COMBO      73
 1110 IF (ABS(FTEST(2)-FTEST(L2))/FTEST(L2)-GRAD) 1150,1160,1160         COMBO      74
 1115 IF (GRAD) 1160,1150,1160                                           COMBO      75
 1120 IF (ABS(FTEST(2)-FTEST(L2))/FTEST(2)-GRAD) 1150,1160,1160          COMBO      76
 1150 IF (NTEST(L2)) 1160,1200,1160                                      COMBO      77
 1160 IF (NTRY) 10000,1170,10000                                         COMBO      78
 1170 NTRY=1                                                             COMBO      79
      IF(L2-2) 1000,10000,900                                            COMBO      80
C     COMBINING TUBES                                                    COMBO      81
 1200 D=SQRT((XUP-XLO)**2+(RUP-RLO)**2)                                  COMBO      82
      IF (ABS(PHIUP-PHILO)-(10.**(-4))) 1130,1130,1125                   COMBO      83
 1125 D=D*(PHIUP-PHILO)/(2.0*SIN(0.5*(PHIUP-PHILO)))                     COMBO      84
 1130 DELY(L)=D                                                          COMBO      85
      FMOM=MDOT(L)*U(L)+MDOT(K2)*U(K2)+(AA(L)*P(L)+AA(K2)*P(K2))*BETAP   COMBO      86
      AA(L)=PI*(RUP+RLO)**DELTA*DELY(L)                                  COMBO      87
      FMDOT=MDOT(L)                                                      COMBO      88
      MDOT(L)=FMDOT+MDOT(K2)                                             COMBO      89
      FH=(FMDOT*H(L)+MDOT(K2)*H(K2)+(FMDOT*U(L)**2+MDOT(K2)*U(K2)**2)/(2 COMBO      90
     *.0*HJ))/MDOT(L)                                                    COMBO      91
      SZMWC=0.0                                                          COMBO      92
      DO 2200 I=1,NDS                                                    COMBO      93
      C(I,L)=(FMDOT*C(I,L)+MDOT(K2)*C(I,K2))/MDOT(L)                     COMBO      94
      ZMWC=C(I,L)/MW(I)                                                  COMBO      95
 2200 SZMWC=SZMWC+ZMWC                                                   COMBO      96
      ZMW=1.0/SZMWC                                                      COMBO      97
      ITER=0                                                             COMBO      98
      CP=0.0                                                             COMBO      99
      CP1=0.0                                                            COMBO     100
      CP2=0.0                                                            COMBO     101
      TS=0.5*(T(L)+T(K2))                                                COMBO     102
      US=0.5*(U(L)+U(K2))                                                COMBO     103
      DO 2300 I=1,NDS                                                    COMBO     104
      XS(I,L)=C(I,L)*ZMW/MW(I)                                           COMBO     105
      DO 2300 J=1,NN                                                     COMBO     106
      CP1=CP1+A(I,J)*FLOAT(J-2)*C(I,L)*T(K2)**(J-3)                      COMBO     107
 2250 CP2=CP2+A(I,J)*FLOAT(J-2)*C(I,L)*T(K )**(J-3)                      COMBO     108
 2300 CP=CP+A(I,J)*FLOAT(J-2)*C(I,L)*T(L)**(J-3)                         COMBO     109
      B1=FMOM/(BETAP*AA(L))                                              COMBO     110
      B2=MDOT(L)/(BETAP*AA(L))                                           COMBO     111
      B3=ZMW*AA(L)/(RV*MDOT(L))                                          COMBO     112
      IF (ICONST) 2305,2310,2305                                         COMBO     113
 2305 IF (0.5*(MA(L)+MA(K2))-20.) 2600,2310,2310                         COMBO     114
C     CONSTANT HEAT CAPACITY                                             COMBO     115
 2310 B4=2.0*HJ*(CP1*T(K2)*MDOT(K2)+CP2*T(L)*FMDOT)/MDOT(L)+(MDOT(K2)*U  COMBO     116
     *(K2)**2+FMDOT*U(L)**2)/MDOT(L)                                     COMBO     117
      B5=HJ*CP*B3*B1                                                     COMBO     118
      B6=2.0*HJ*CP*B3*B2-1.0                                             COMBO     119
      DISCR=B5**2-B6*B4                                                  COMBO     120
      IF (DISCR) 2400,2500,2500                                          COMBO     121
 2400 WRITE (6,2410)                                                     COMBO     122
 2410 FORMAT (31H1NEGATIVE DISCRIMINANT IN COMBO)                        COMBO     123
 2415 CALL PDUMP (A(1,1),N,5)                                            COMBO     124
      CALL EXIT                                                          COMBO     125
 2500 U(L)=(B5+SQRT(DISCR))/B6                                           COMBO     126
      GO TO 2900                                                         COMBO     127
C     VARIABLE HEAT CAPACITY                                             COMBO     128
 2600 ITER=ITER+1                                                        COMBO     129
      B4=2.0*HJ*FH                                                       COMBO     130
      DUM1=0.0                                                           COMBO     131
      DUM2=0.0                                                           COMBO     132
      DO 2650 I=1,NDS                                                    COMBO     133
      DO 2650 J=1,NN                                                     COMBO     134
      DUM1=DUM1+A(I,J)*C(I,L)*(B3*(B1-B2*US)*US)**(J-2)                  COMBO     135
 2650 DUM2=DUM2+A(I,J)*C(I,L)*FLOAT(J-2)*(B1*US-B2*US**2)**(J-3)*B3**(J- COMBO     136
     *2)                                                                 COMBO     137
      G=2.0*HJ*DUM1+US**2-B4                                             COMBO     138
      DGDU=2.0*US+2.0*HJ*DUM2*(B1-2.0*B2*US)                             COMBO     139
      DELTAU=-G/DGDU                                                     COMBO     140
      US=US+DELTAU                                                       COMBO     141
      IF (ABS(DELTAU/US)-TOL) 2800,2700,2700                             COMBO     142
 2700 IF (ITER-NITER) 2600,2600,2750                                     COMBO     143
 2750 WRITE (6,2755)                                                     COMBO     144
 2755 FORMAT (27H1ITERATIONS FAILED IN COMBO)                            COMBO     145
      GO TO 2415                                                         COMBO     146
 2800 U(L)=US                                                            COMBO     147
 2900 P(L)=B1-B2*U(L)                                                    COMBO     148
      T(L)=B3*P(L)*U(L)                                                  COMBO     149
      H(L)=0.0                                                           COMBO     150
      DO 2910 I=1,NDS                                                    COMBO     151
      DO 2910 J=1,NN                                                     COMBO     152
 2910 H(L)=H(L)+A(I,J)*C(I,L)*T(L)**(J-2)                                COMBO     153
      RHO(L)=ZMW*P(L)/(RV*T(L))                                          COMBO     154
      FMAX=1.0                                                           COMBO     155
      IF (IEXTRA(1)) 3100,3000,3100                                      COMBO     156
 3000 RE(L)=1.E+20                                                       COMBO     157
      GO TO 3600                                                         COMBO     158
 3100 CALL TRANSP(T(L),P(L),L)                                           COMBO     159
      IF (KAY-MU*CP) 3300,3300,3200                                      COMBO     160
 3200 FMAX=KAY/(CP*MU)                                                   COMBO     161
 3300 DO 3500 I=1,NDS                                                    COMBO     162
      MAX=I                                                              COMBO     163
      DO 3500 J=1,MAX                                                    COMBO     164
      IF (DIH(I,J)*RHO(L)/MU-FMAX) 3500,3500,3400                        COMBO     165
 3400 FMAX=DIH(I,J)*RHO(L)/MU                                            COMBO     166
 3500 CONTINUE                                                           COMBO     167
      DELY(L)=DELY(L)+DELY(K2)                                           COMBO     168
      RE(L)=RHO(L)*U(L)*DELY(L)/(MU*FMAX)                                COMBO     169
 3600 IF (KMN.GT.1) GO TO 3603                                           COMBO     170
      SONIC=(CP*ZMW-RCON)/(CP*T(L)*RU)                                   COMBO     171
      IF(SONIC.GT.0.0) GO TO 3601                                        COMBO     172
      WRITE(6,3602)                                                      COMBO     173
 3602 FORMAT(9HNEG SONIC)                                                COMBO     174
      GO TO 2415                                                         COMBO     175
 3601 MA(L)=U(L)*SQRT(SONIC)                                             COMBO     176
C     REINDEXING STREAMTUBE PROPERTIES                                   COMBO     177
 3603 IF (K2-K) 3800,3800,3900                                           COMBO     178
 3800 L=L-1                                                              COMBO     179
      GO TO 4000                                                         COMBO     180
 3900 PHI(L)=PHI(L+1)                                                    COMBO     181
      R(L)=R(L+1)                                                        COMBO     182
      SX(L)=SX(L+1)                                                      COMBO     183
      X(L)=X(L+1)                                                        COMBO     184
      Y(L)=Y(L+1)                                                        COMBO     185
      L=L+1                                                              COMBO     186
 4000 KMAX=KMAX-1                                                        COMBO     187
      IF (L-KMAX) 4100,4100,9000                                         COMBO     188
 4100 DO 4300 L2=L,KMAX                                                  COMBO     189
      AA(L2)=AA(L2+1)                                                    COMBO     190
      DO 4200 I=1,NDS                                                    COMBO     191
      C(I,L2)=C(I,L2+1)                                                  COMBO     192
 4200 XS(I,L2)=XS(I,L2+1)                                                COMBO     193
      DELY(L2)=DELY(L2+1)                                                COMBO     194
      H(L2)=H(L2+1)                                                      COMBO     195
      MDOT(L2)=MDOT(L2+1)                                                COMBO     196
      P(L2)=P(L2+1)                                                      COMBO     197
      PHI(L2)=PHI(L2+1)                                                  COMBO     198
      PHI2(L2)=PHI2(L2+1)                                                COMBO     199
      R(L2)=R(L2+1)                                                      COMBO     200
      RE(L2)=RE(L2+1)                                                    COMBO     201
      RHO(L2)=RHO(L2+1)                                                  COMBO     202
      SX(L2)=SX(L2+1)                                                    COMBO     203
      T(L2)=T(L2+1)                                                      COMBO     204
      U(L2)=U(L2+1)                                                      COMBO     205
      X(L2)=X(L2+1)                                                      COMBO     206
      Y(L2)=Y(L2+1)                                                      COMBO     207
 4300 MA(L2)=MA(L2+1)                                                    COMBO     208
 9000 RETURN                                                             COMBO     209
10000 RETURN                                                             COMBO     210
      END                                                                COMBO     211
      SUBROUTINE CPUTIN(IDENT,IKINE,NDS)                                 CPUTIN      2
C       ---------------------------------------------------------------  CPUTIN      3
      DIMENSION IDENT (25),IZD(5)                                        CPUTIN      4
      COMMON/CHEM1/ ZID(5), IRR(30),IRT(30),RC(30,3),IRRR(30,5),         CPUTIN      5
     1 AV,CM(21,21),FI(21),WP(21),                                       CPUTIN      6
     2 WM(21),WDOT(21,30),CSI(21),QX(21)                                 CPUTIN      7
      AV=6.03E23                                                         CPUTIN      8
      DO 2 I=1,IKINE                                                     CPUTIN      9
      READ (5,100) (IZD(J),J=1,5),IRR(I),IRT(I),(RC(I,KR),KR=1,3)        CPUTIN     10
      WRITE(6,101) I, (IZD(J),J=1,5),IRR(I),IRT(I),(RC(I,KR),KR=1,3)     CPUTIN     11
      DO 5 J=1,5                                                         CPUTIN     12
      IRRR (I,J)=0                                                       CPUTIN     13
      DO 3 L=1,NDS                                                       CPUTIN     14
      IF (IZD(J)-IDENT(L)) 3,4,3                                         CPUTIN     15
    4 IRRR(I,J)=L                                                        CPUTIN     16
    3 CONTINUE                                                           CPUTIN     17
    5 CONTINUE                                                           CPUTIN     18
      RC(I,1)=RC(I,1)*AV                                                 CPUTIN     19
    2 CONTINUE                                                           CPUTIN     20
  100 FORMAT (A4,3X,A4,10X,A4,3X,A4,3X,A4,9X,I2,I1,E8.2,F4.1,F9.1)       CPUTIN     21
  101 FORMAT (2X,I2,2X,A4,3X,A4,10X,A4,3X,A4,3X,A4,9X,I2,I1,E8.2,        CPUTIN     22
     1 F4.1,F9.1)                                                        CPUTIN     23
      RETURN                                                             CPUTIN     24
      END                                                                CPUTIN     25
      SUBROUTINE DRAG                                                    DRAG        2
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    DRAG        4
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         DRAG        5
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        DRAG        6
     * ,      MAP                                                        DRAG        7
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  DRAG        8
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          DRAG        9
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      DRAG       10
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       DRAG       11
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    DRAG       12
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      DRAG       13
     1 ,SUMP,SUMPV,SUMPE                                                 DRAG       14
      COMMON/CFF/IPTO                                                    DRAG       15
      KZZ=N                                                              DRAG       16
      N=K-1                                                              DRAG       17
       GAMP1=GAMA+1.                                                     DRAG       18
      SQGAM=SQRT(GAMA)                                                   DRAG       19
      SQTPI=1.7724                                                       DRAG       20
      DO 1 J=1, NPG                                                      DRAG       21
      IF (N.GT. NBL(J) ) GO TO 6                                         DRAG       22
      AXX1=    ((U(K)-W(N,J))**2 +V(N,J)**2)                             DRAG       23
      AXX= SQRT(AXX1)                                                    DRAG       24
      UM(K)=0.0                                                          DRAG       25
      DO7 I=1,NDS                                                        DRAG       26
    7 UM(K)=UM(K)+XS(I,K)*MU0(I)*(T(K)/T0(I))**OMEGA(I)                  DRAG       27
C        CALCULATE DRAG COEFFICIENT                                      DRAG       28
      REP(N,J)=RHO(K)*AXX*RP(J)/UM(K)                                    DRAG       29
      MAP= MA(K)*AXX/U (K)                                               DRAG       30
      RMR=MAP/REP(N,J)                                                   DRAG       31
      CDO=24./REP(N,J)                                                   DRAG       32
      IF (REP(N,J).GE.60.) CDO=0.40                                      DRAG       33
      TARG=2.*ALOG(MAP)                                                  DRAG       34
      TAHY=(EXP( 2.*TARG)-1.)/(EXP(2.*TARG)+1.)                          DRAG       35
      CDI=.66+.26*TAHY+.17*EXP(-2.5*(ALOG(MAP)/1.4)**2)                  DRAG       36
      IF(MAP.LT..3) CDI=.40                                              DRAG       37
      CDB=1.0                                                            DRAG       38
      CD=CDI                                                             DRAG       39
      XKN=1.26 * SQGAM*RMR                                               DRAG       40
      IF (XKN.GT.4.) GO TO 4                                             DRAG       41
      IF (XKN .LT. 1.E-8) GO TO 5                                        DRAG       42
      XX1=XKN**0.4                                                       DRAG       43
      XX2=EXP(1.2* XKN**0.5)                                             DRAG       44
      GKN=XX1*XX2/(1.0+XX1*XX2)                                          DRAG       45
      XX3=XKN**0.6                                                       DRAG       46
      XX4=EXP(XKN)                                                       DRAG       47
      DRE=1.0-EXP(-XX3*XX4*(CDO-.4)*REP(N,J)/8.)                         DRAG       48
      CDB=GKN*DRE                                                        DRAG       49
    4 CONTINUE                                                           DRAG       50
      S1=SQRT(0.5*GAMA)*MAP                                              DRAG       51
      S2=S1*S1                                                           DRAG       52
      S3=S2*S1                                                           DRAG       53
      S4=S3*S1                                                           DRAG       54
      S32=S2*0.5                                                         DRAG       55
      SQ=S1*SQRT(T (K)  /TP(N,J))                                        DRAG       56
      CDFM= EXP(-S32)*(1.0+2.0*S2)/SQTPI/S3                              DRAG       57
     1     +(4.0*(S4+S2)-1.0)/2.0/S4*ERF(S1)                             DRAG       58
     2   +0.667*SQTPI/SQ                                                 DRAG       59
      CD=CDB*(CDFM-CDI)+CDI                                              DRAG       60
    5 FQ=CD/24.*REP(N,J)*FFF                                             DRAG       61
C       CALCULATE NUSSELT NUMBER                                         DRAG       62
      XUO= 2.0+ 0.459*(REP(N,J)  **0.55)*(PQ**0.33)                      DRAG       63
      XX5= 5.0*(GAMA**1.5)*RMR/GAMP1/PQ*XUO                              DRAG       64
      XUKDP= XUO/(1.0+XX5)                                               DRAG       65
      XUP= XUKDP+(GAMP1/GAMA*REP(N,J)*PQ*EXP(-0.5/RMR))                  DRAG       66
      GP= 0.5*XUP*FFG                                                    DRAG       67
      XX7 = 4.5 * UM(K) * FQ / (RHSS*RP(J)*RP(J))                        DRAG       68
      XMOMV(J) = XX7*V(K-1,J)                                            DRAG       69
      XMOMP(J) = XX7 * (U (K)-W(K-1,J))                                  DRAG       70
      ENEP1(J)= XX7  *AXX1                                               DRAG       71
      RFM=GAMA/GAMP1*(2.+.67*EXP(-MAP**2./3.)   )                        DRAG       72
      RCEX=0.0                                                           DRAG       73
      IF(RMR.GE..01) RCEX=EXP    (-.5/RMR)                               DRAG       74
      REC=.9+(RFM-.9)* RCEX                                              DRAG       75
      DLT=REC*AXX1/(2.*HJ*CP)                                            DRAG       76
      TR(K)=T(K)+DLT                                                     DRAG       77
      ENEP2(J)=XX7*HJ*2./3.*GP*CP*(TP(K-1,J)-TR(K))/FQ/PQ                DRAG       78
C     CARD OMITTED                                                       DRAG       79
C     CARD OMITTED                                                       DRAG       80
C     CARD OMITTED                                                       DRAG       81
      GO TO 1                                                            DRAG       82
    6 CONTINUE                                                           DRAG       83
      XMOMV(J)=0.0                                                       DRAG       84
      XMOMP(J)=0.                                                        DRAG       85
      ENEP1(J)=0.                                                        DRAG       86
      ENEP2(J)=0.                                                        DRAG       87
    1 CONTINUE                                                           DRAG       88
      N=KZZ                                                              DRAG       89
      RETURN                                                             DRAG       90
      END                                                                DRAG       91
      SUBROUTINE ENTAL(IK)                                               ENTAL       2
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    ENTAL       4
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         ENTAL       5
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        ENTAL       6
     * ,      MAP                                                        ENTAL       7
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  ENTAL       8
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          ENTAL       9
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      ENTAL      10
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       ENTAL      11
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    ENTAL      12
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      ENTAL      13
     1 ,SUMP,SUMPV,SUMPE                                                 ENTAL      14
      COMMON/MAINSH/ KOUNT,KINT                                          ENTAL      15
      COMMON/CHEM1/ ZID(5), IRR(30),IRT(30),RC(30,3),IRRR(30,5),         ENTAL      16
     1 AV,CM(21,21),FI(21),WP(21),                                       ENTAL      17
     2 WM(21),WDOT(21,30),CSI(21),QX(21)                                 ENTAL      18
      COMMON/INSHOP/ POO,TOO,UOO,PHOO,COO(20)                            ENTAL      19
      COMMON/SHOPUT/ XSHW,RSHW,PSIW,PSHW,TSHW,USHW,CSHW(20)              ENTAL      20
      COMMON/INTL/XLX,IKI,REX                                            ENTAL      21
      COMMON/TURBUL/TLE,TPR,EDDYK,ITURB,DELMIX                           ENTAL      22
      COMMON/INPUX/ITD,X0,Y0,FRAC  ,KFL                                  ENTAL      23
      SPH2MX=SIN(PHI2(KMAX))                                             ENTAL      24
      CPH2MX=COS(PHI2(KMAX))                                             ENTAL      25
C     ESTABLISHING LAST POINT FOR WHICH DP>0                             ENTAL      26
      KKX=KFL -1                                                         ENTAL      27
      I=K-1                                                              ENTAL      28
    1 CONTINUE                                                           ENTAL      29
      I=I+1                                                              ENTAL      30
      DPY=P2(I+1)-P2(I)                                                  ENTAL      31
      IF (DPY .LE. 0.0) GO TO 2                                          ENTAL      32
      IF (I.LT.KKX) GO TO 1                                              ENTAL      33
    2  KSH=(I-IK)/2+IK                                                   ENTAL      34
C     SHOCK LOCATION                                                     ENTAL      35
      RSHW=(R2(KSH)+R2(KSH-1))*.5                                        ENTAL      36
      XSHW=(X2(KSH)+X2(KSH-1))*.5                                        ENTAL      37
      IF(KSH.EQ.IK) RSHW=R2(KSH)                                         ENTAL      38
      IF(KSH.EQ.IK) XSHW=X2(KSH)                                         ENTAL      39
  201 FORMAT(5I4)                                                        ENTAL      40
      KFLL=KMAX-KFL                                                      ENTAL      41
      IF (KFLL .GT. 4) KFLL=4                                            ENTAL      42
      IF(ISHOCK.EQ.0) KFLL=4                                             ENTAL      43
      KFLL=4                                                             ENTAL      44
      IKI=KFLL+5                                                         ENTAL      45
      WRITE(9,203) IKI ,DELMIX                                           ENTAL      46
  203 FORMAT(I2,2E12.5)                                                  ENTAL      47
      SMT=0.0                                                            ENTAL      48
      SMP=0.0                                                            ENTAL      49
      SMU=0.0                                                            ENTAL      50
      DO3 J=I,KFL                                                        ENTAL      51
      SMP=SMP+P2(J)                                                      ENTAL      52
      SMT=SMT+T2(J)                                                      ENTAL      53
    3  SMU=SMU+U2(J)                                                     ENTAL      54
      PSHW=SMP/(KFL -I+1)                                                ENTAL      55
      TSHW=SMT/(KFL -I+1)                                                ENTAL      56
      USHW=SMU/(KFL -I+1)                                                ENTAL      57
   13 P2P1=PSHW/P2(IK)                                                   ENTAL      58
      DO 7 L=1,NDS                                                       ENTAL      59
      SMC=0.0                                                            ENTAL      60
      DO 6 J=I,KFL                                                       ENTAL      61
    6 SMC=SMC+C2(L,J)                                                    ENTAL      62
    7 CSHW(L)=SMC/(KFL -I+1)                                             ENTAL      63
      IF(ICONST)8,15,8                                                   ENTAL      64
C     FOR CONSTANT GAMA                                                  ENTAL      65
   15 GAMP1=GAMA+1.                                                      ENTAL      66
      PWW= ASIN(SQRT((GAMP1*P2P1+GAMA-1.)/(2.*GAMA*MA(IK)**2))   )       ENTAL      67
      PSIW=PHI2(IK)-PWW                                                  ENTAL      68
C     NON CONSTANT SPECIFIC HEAT                                         ENTAL      69
      GO TO 22                                                           ENTAL      70
    8  HSH=0.0                                                           ENTAL      71
      DO 9 L=1,NDS                                                       ENTAL      72
      DO 9 JJ=1,NN                                                       ENTAL      73
    9 HSH=HSH+CSHW(L)*A(L,JJ)*TSHW**(JJ-2)                               ENTAL      74
      FCT=(PSHW-P2(IK))*BETAP/(RHO2(IK)*U2(IK)**2)                       ENTAL      75
      GCT=(HSH-H (IK))/ U2(IK)**2*HJ *2.                                 ENTAL      76
      PSSW=0                                                             ENTAL      77
      IF (2.0*FCT.LE.GCT) GO TO 28                                       ENTAL      78
      PSSW=FCT/SQRT(2.*FCT-GCT)                                          ENTAL      79
   28 PSIW=PHI2(IK)-PSSW                                                 ENTAL      80
   22  IF(IPART.NE.2) GO TO 25                                           ENTAL      81
      NDSP=NDS+1                                                         ENTAL      82
      CSH(NDSP)=0.                                                       ENTAL      83
      CSHW(NDSP)=0.                                                      ENTAL      84
      DO24 J=IK,KMAX                                                     ENTAL      85
   24 C2(NDSP,J)=0.                                                      ENTAL      86
   25 IF(IPART.NE.2) NDSP=NDS                                            ENTAL      87
      ZMS=0.0                                                            ENTAL      88
      DO21 J=1,NDS                                                       ENTAL      89
   21 ZMS=ZMS+CSHW(J)/MW(J)                                              ENTAL      90
      ZMS=1./ZMS                                                         ENTAL      91
      SMDT=0.0                                                           ENTAL      92
      KSSH=KSH+1                                                         ENTAL      93
      DO 20 J=KSSH,KFL                                                   ENTAL      94
   20 SMDT=SMDT+MDOT(J)                                                  ENTAL      95
      PSSS=PHI2(KFL )                                                    ENTAL      96
      RSHW=SQRT(R2(KFL )**2-COS(PSSS)*SMDT*TSHW*RV /(PSHW*ZMS *USHW*3.14 ENTAL      97
     *159))                                                              ENTAL      98
      POO=P2(IK)                                                         ENTAL      99
      TOO=T2(IK)                                                         ENTAL     100
      UOO=U2(IK)                                                         ENTAL     101
      XOO=XSHW                                                           ENTAL     102
      ROO=RSHW                                                           ENTAL     103
      PHOO=PHI2(IK)                                                      ENTAL     104
      DO 4 L=1,NDSP                                                      ENTAL     105
    4  COO(L)=C2(L,IK)                                                   ENTAL     106
   10 DELR=(R2(KFL)-RSHW    )*.25                                        ENTAL     107
      DLEX=(X2(KFL)-X2(KSH))*.25                                         ENTAL     108
      DEPHI=(PHI2(KFL)-PHI2(KS H))*.25                                   ENTAL     109
      XSL=X2(KS H)                                                       ENTAL     110
      RSL=RSHW                                                           ENTAL     111
      PHSL=PHI2(KS H)                                                    ENTAL     112
      WRITE(9,200) XSL,RSL,PHSL                                          ENTAL     113
      DO36 II=1,4                                                        ENTAL     114
      XSL=XSL+DLEX                                                       ENTAL     115
      RSL=RSL+DELR                                                       ENTAL     116
      PHSL=PHSL+DEPHI                                                    ENTAL     117
      WRITE(9,200) XSL,RSL,PHSL,PSHW,TSHW,USHW                           ENTAL     118
      WRITE(9,6900) (CSHW(I),I=1,NDSP)                                   ENTAL     119
   36 CONTINUE                                                           ENTAL     120
      DO 12 I=1,NDS                                                      ENTAL     121
   12 CSH (I)=CSTREM(I)                                                  ENTAL     122
      IF(ISHOCK.EQ.1) GO TO 32                                           ENTAL     123
   42 PSH=PSHW                                                           ENTAL     124
      PSPR=PSH/PSTREM                                                    ENTAL     125
      FSTRM=0.0                                                          ENTAL     126
      BPB=0.0                                                            ENTAL     127
      DO 11 I=1,NDS                                                      ENTAL     128
      FSTRM=FSTRM+CSTREM(I)/MW(I)                                        ENTAL     129
   11 BPB=BPB+CSH(I)*A(I,3)                                              ENTAL     130
      FSTRM=1./FSTRM                                                     ENTAL     131
       GAMM=BPB/(BPB-RCON/FSTRM)                                         ENTAL     132
      EMF=USTREM*SQRT((BPB*FSTRM-RCON)/(BPB*TSTREM*RU))                  ENTAL     133
      EMFNS=((PSPR-1.0)*(GAMM+1.)/(2.*GAMM)+1.)                          ENTAL     134
      TSH=TSTREM*(1.+2.*(GAMM-1.)/(GAMM+1.)**2*(EMFNS-1.)*(GAMM+1./EMFNS ENTAL     135
     1 ))                                                                ENTAL     136
      USH=SQRT(2.*(BPB*(TSTREM-TSH)*HJ+USTREM**2/2.)        )            ENTAL     137
      PSI=ASIN (SQRT(EMFNS)/EMF)                                         ENTAL     138
      PTUT=PSH*TSTREM*USH/(TSH*PSTREM*USTREM)                            ENTAL     139
      RSH=SQRT((REX**2-PTUT*R2(KMAX)**2/CPH2MX         )/(1.-PTUT/CPH2MX ENTAL     140
     1 ))                                                                ENTAL     141
      XSH=X2(KMAX)-(RSH-R2(KMAX))*SPH2MX         /CPH2MX                 ENTAL     142
      DELR=(RSH-R2(KMAX))*.25                                            ENTAL     143
      DLEX=(XSH-X2(KMAX))*.25                                            ENTAL     144
      ZZX=(EMF*SIN(PSI))**2                                              ENTAL     145
      Z=(    ZZX          -1.)/TAN(PSI)/((GAMM+1.)/2.*EMF**2-ZZX+1.)     ENTAL     146
      ZTA=ATAN(Z)                                                        ENTAL     147
      DEPHI=(ZTA-PHI2(KMAX))*.25                                         ENTAL     148
      XSL=X2(KFL)                                                        ENTAL     149
      RSL=R2(KFL)                                                        ENTAL     150
      PHSL=PHI2(KFL)                                                     ENTAL     151
      DO 41 II=1,4                                                       ENTAL     152
      XSL=XSL+DLEX                                                       ENTAL     153
      RSL=RSL+DELR                                                       ENTAL     154
      PHSL=PHSL+DEPHI                                                    ENTAL     155
      WRITE(9,200) XSL,RSL,PHSL,PSH,TSH,USH                              ENTAL     156
      WRITE(9,6900) (CSH(I),I=1,NDSP)                                    ENTAL     157
   41 CONTINUE                                                           ENTAL     158
      GO TO 39                                                           ENTAL     159
   32 KFLL=KMAX-KFL                                                      ENTAL     160
      IF(KFLL.EQ.0) GO TO 42                                             ENTAL     161
      KFLL=4                                                             ENTAL     162
      KFL1=KFL+1                                                         ENTAL     163
      R2KMX=(X2(KMAX)-X2SH)*TAN(PSI-PHI2(KMAX))*CPH2MX         +R2(KMAX) ENTAL     164
      X2KMX=X2(KMAX)-(X2(KMAX)-X2SH)*TAN(PSI-PHI2(KMAX))*SPH2MX          ENTAL     165
      XSH=X2KMX                                                          ENTAL     166
      RSH=R2KMX                                                          ENTAL     167
      PSH=P2(KMAX)                                                       ENTAL     168
      TSH=T2(KMAX)                                                       ENTAL     169
      USH=U2(KMAX)                                                       ENTAL     170
C     ..... A GROUP OF CARDS WAS TAKEN FROM HERE .....                   ENTAL     171
   37 DELR=(R2KMX-R2(KFL ))*.25                                          ENTAL     172
      DLEX=(X2KMX-X2(KFL ))*.25                                          ENTAL     173
      DEPHI=(PHI2(KMAX)-PHI2(KFL))*.25                                   ENTAL     174
      XSL=X2(KFL )                                                       ENTAL     175
      RSL=R2(KFL )                                                       ENTAL     176
      PHSL=PHI2(KFL )                                                    ENTAL     177
      SMT=0.0                                                            ENTAL     178
      SMP=0.0                                                            ENTAL     179
      SMU=0.0                                                            ENTAL     180
      DO 43 J=KFL1,KMAX                                                  ENTAL     181
      SMP=SMP+P2(J)                                                      ENTAL     182
      SMT=SMT+T2(J)                                                      ENTAL     183
   43  SMU=SMU+U2(J)                                                     ENTAL     184
      TSH =SMT/(KMAX-KFL)                                                ENTAL     185
      USH =SMU/(KMAX-KFL)                                                ENTAL     186
      PSH =SMP/(KMAX-KFL)                                                ENTAL     187
      DO40 II=1,4                                                        ENTAL     188
      XSL=XSL+DLEX                                                       ENTAL     189
      RSL=RSL+DELR                                                       ENTAL     190
      PHSL=PHSL+DEPHI                                                    ENTAL     191
      WRITE(9,200) XSL,RSL,PHSL,PSH,TSH,USH                              ENTAL     192
      WRITE(9,6900) (CSH(I),I=1,NDSP)                                    ENTAL     193
   40 CONTINUE                                                           ENTAL     194
   39 XWW  =XSHW                                                         ENTAL     195
      XWY  =XWW  +COS(PHI2(KSH))*1.E-2 *XWW                              ENTAL     196
      RWW  =RSHW                                                         ENTAL     197
      RWY  =RWW  +SIN(PHI2(KSH))*(1.E-2)*RWW                             ENTAL     198
      WRITE(9,200) XWW,RWW,XWY,RWY                                       ENTAL     199
      XBB  =XSH                                                          ENTAL     200
      XBC  =XSH     +CPH2MX         *(1.E-2)*XBB                         ENTAL     201
      RBB  =RSH                                                          ENTAL     202
      RBC  =R2(KMAX)+SPH2MX         *(1.E-2)*RBB                         ENTAL     203
      WRITE(9,200) XBB,RBB,XBC,RBC                                       ENTAL     204
      WRITE(9,200) XSH,RSH,PSI,PSH,TSH,USH                               ENTAL     205
      WRITE(9,6900) (CSH(I)    ,I=1,NDSP)                                ENTAL     206
  200 FORMAT(6E12.4)                                                     ENTAL     207
      WRITE (9,200) XSHW,RSHW,PSIW,PSHW,TSHW,USHW                        ENTAL     208
      WRITE(9,6900)(CSHW(L),L=1,NDSP)                                    ENTAL     209
      WRITE(9,200) XOO,ROO,PHOO,POO,TOO,UOO                              ENTAL     210
      WRITE(9,6900) (COO(L),L=1,NDSP)                                    ENTAL     211
 6900 FORMAT(8E10.3)                                                     ENTAL     212
      RETURN                                                             ENTAL     213
      END                                                                ENTAL     214
      FUNCTION ERF(X)                                                    ERF         2
C     ----- THIS CALCULATES THE ERROR FUNCTION AND ITS COMPLEMENT -----  ERF         3
      DATA EPSILN/1.0E-10/,N/100/,CONST/1.1283791679550/                 ERF         4
      KOMPL=+1                                                           ERF         5
      GO TO 5                                                            ERF         6
      ENTRY ERFC                                                         ERF         7
      KOMPL=-1                                                           ERF         8
    5 IF (X) 10,55,15                                                    ERF         9
   10 Z=-X                                                               ERF        10
      GO TO 20                                                           ERF        11
   15 Z= X                                                               ERF        12
   20 IF (Z-5.) 25,25,45                                                 ERF        13
   25 ZSQ=Z*Z                                                            ERF        14
      TERM=CONST*Z*EXP(-ZSQ)                                             ERF        15
      ERF=TERM                                                           ERF        16
      I=0                                                                ERF        17
      R=1.0                                                              ERF        18
   30 I=I+1                                                              ERF        19
      R=R+2.0                                                            ERF        20
      TERM=2.0*ZSQ*TERM/R                                                ERF        21
      ERF=ERF+TERM                                                       ERF        22
      IF (I-N) 35,40,40                                                  ERF        23
   35 IF (TERM-EPSILN*ERF) 40,30,30                                      ERF        24
   40 IF (ERF-1.0) 50,50,45                                              ERF        25
   45 ERF=1.0                                                            ERF        26
   50 IF (X) 60,55,65                                                    ERF        27
   55 ERF=0.0                                                            ERF        28
      GO TO 65                                                           ERF        29
   60 ERF=-ERF                                                           ERF        30
   65 IF (KOMPL) 70,99,99                                                ERF        31
C     ----- COMPUTE COMPLEMENTARY ERROR FUNCTION ERF -----               ERF        32
   70 ERF=1.0-ERF                                                        ERF        33
   99 RETURN                                                             ERF        34
      END                                                                ERF        35
      SUBROUTINE FLUX                                                    FLUX        2
C     THIS SUBROUTINE CALCULATES THE FLUXES OF MASS, MOMENTUM, AND HEAT  FLUX        3
C     ASSUMING TURBULENT TRANSPORT                                       FLUX        4
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    FLUX        6
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         FLUX        7
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        FLUX        8
     * ,      MAP                                                        FLUX        9
      COMMON/INPUX/ITD,X0,Y0,FRAC  ,KFL                                  FLUX       10
      DIMENSION CDENOM(20),PDENOM(20),TDENOM(20)                         FLUX       11
      IF (NBOUND) 10,30,10                                               FLUX       12
   10 Q(K)=0.0                                                           FLUX       13
      TAW(K)=0.0                                                         FLUX       14
      DO 20 I=1,NDS                                                      FLUX       15
   20 ZJ(I,K)=0.0                                                        FLUX       16
      GO TO 10000                                                        FLUX       17
C     ----- SETUP OF AVERAGED FLOW QUANTITIES NEEDED -----               FLUX       18
   30 YBBAR=YABAR                                                        FLUX       19
      TBBAR=TABAR                                                        FLUX       20
      RHBBAR=RHABAR                                                      FLUX       21
      DO 50 I=1,NDS                                                      FLUX       22
      CBBAR(I)=CABAR(I)                                                  FLUX       23
   50 XBBAR(I)=XABAR(I)                                                  FLUX       24
      PBBAR=PABAR                                                        FLUX       25
      IF (IFLAG) 100,400,100                                             FLUX       26
  100 YABAR=.5*(Y(K+1)+Y2(K+1))                                          FLUX       27
      TABAR=.5*(T(K+1)+T2(K+1))                                          FLUX       28
      KU=K+1                                                             FLUX       29
      UBAR(KU)=SQRT(.5*(U(K+1)**2+U2(K+1)**2))                           FLUX       30
      RHABAR=.5*(RHO(K+1)+RHO2(K+1))                                     FLUX       31
  110 RBVG=0.25*(R(K)+R(K-1)+R2(K)+R2(K-1))                              FLUX       32
      RAVG=0.25*(R(K+1)+R(K)+R2(K+1)+R2(K))                              FLUX       33
  130 ZMW2=0.0                                                           FLUX       34
      DO 200 I=1,NDS                                                     FLUX       35
      CABAR(I)=.5*(C(I,K+1)+C2(I,K+1))                                   FLUX       36
  200 ZMW2=ZMW2+CABAR(I)/MW(I)                                           FLUX       37
      ZMW2=1.0/ZMW2                                                      FLUX       38
      DO 300 I=1,NDS                                                     FLUX       39
  300 XABAR(I)=CABAR(I)*ZMW2/MW(I)                                       FLUX       40
      PABAR=.5*(P(K+1)+P2(K+1))                                          FLUX       41
      GO TO 605                                                          FLUX       42
  400 TABAR=T(K+1)                                                       FLUX       43
      KU=K+1                                                             FLUX       44
      UBAR(KU)=U(K+1)                                                    FLUX       45
      RHABAR=RHO(K+1)                                                    FLUX       46
  120 RBVG=0.5*(R(K)+R(K-1))                                             FLUX       47
      RAVG=0.5*(R(K+1)+R(K))                                             FLUX       48
      DO 500 I=1,NDS                                                     FLUX       49
      CABAR(I)=C(I,K+1)                                                  FLUX       50
  500 XABAR(I)=XS(I,K+1)                                                 FLUX       51
      PABAR=P(K+1)                                                       FLUX       52
  605 CALL TRANSP(TABAR,PABAR,K+1)                                       FLUX       53
C     ----- CALCULATION OF HEAT FLUX AND SHEAR -----                     FLUX       54
      DENOMU=(MDOT(K+1)+MDOT(K))/(RHABAR*UBAR(K+1)*RAVG**DELTA*MU+RHBBAR FLUX       55
     1 *UBAR(K)*RBVG**DELTA*MU2)/(2.0**DELTA*PI)                         FLUX       56
      DENOMT=(MDOT(K+1)+MDOT(K))/(RHABAR*UBAR(K+1)*RAVG**DELTA*KAY+      FLUX       57
     1  RHBBAR*UBAR(K)*RBVG**DELTA*KAY2)/(2.0**DELTA*PI)                 FLUX       58
      TAW(K)=(UBAR(K+1)-UBAR(K))/DENOMU                                  FLUX       59
      Q(K)=(TABAR-TBBAR)/DENOMT                                          FLUX       60
C     ----- CALCULATION OF MASS FLUX -----                               FLUX       61
      DO 1900 I=1,NDS                                                    FLUX       62
      CDENOM(I)=(MDOT(K)+MDOT(K+1))/(RHBBAR**2*D2IH(1,2)*UBAR(K)*PI*(2.0 FLUX       63
     1 *RBVG)**DELTA+RHABAR**2*DIH(1,2)*UBAR(K+1)*PI*(2.0*RAVG)**DELTA)  FLUX       64
 1900 ZJ(I,K)=(CABAR(I)-CBBAR(I))/CDENOM(I)                              FLUX       65
      IF(ISHOCK.NE.1) GO TO 1925                                         FLUX       66
      IF(KMAX.GT.KFL) GO TO 1925                                         FLUX       67
      X0=X(1)                                                            FLUX       68
 1925 L=1                                                                FLUX       69
      DIST=X(L)-X0                                                       FLUX       70
      IF (ABS(DIST)-FRAC*Y0) 1830,10000,10000                            FLUX       71
 1830 FLIMIT=ABS(DIST)/(FRAC*Y0)                                         FLUX       72
      Q(K)=Q(K)*FLIMIT                                                   FLUX       73
      TAW(K)=TAW(K)*FLIMIT                                               FLUX       74
      DO 1835 I=1,NDS                                                    FLUX       75
 1835 ZJ(I,K)=ZJ(I,K)*FLIMIT                                             FLUX       76
10000 RETURN                                                             FLUX       77
      END                                                                FLUX       78
      SUBROUTINE LOCATE(XB,YB,X1,Y1,X2,Y2,X3,Y3,IFGOOD)                  LOCATE      2
      DIMENSION XLOC(3)                                                  LOCATE      3
C     IFGOOD = 1  POINT IS BOUNDED                                       LOCATE      4
C            = 2  POINT IS NOT BOUNDED                                   LOCATE      5
      DO 22   I=1,3                                                      LOCATE      6
      GO TO (10,12,14) , I                                               LOCATE      7
   10 XX2 = X1                                                           LOCATE      8
      YY2 = Y1                                                           LOCATE      9
      GO TO 16                                                           LOCATE     10
   12 XX2 = X2                                                           LOCATE     11
      YY2 = Y2                                                           LOCATE     12
      GO TO 16                                                           LOCATE     13
   14 XX2 = X3                                                           LOCATE     14
      YY2 = Y3                                                           LOCATE     15
   16 D = SQRT((XX2-XB)**2+(YY2-YB)**2)                                  LOCATE     16
      COST =(XX2-XB)/D                                                   LOCATE     17
      IF (YY2.GE.YB) GO TO 20                                            LOCATE     18
      XLOC(I) = 3.+COST                                                  LOCATE     19
      GO TO 22                                                           LOCATE     20
   20 XLOC(I) = 1.-COST                                                  LOCATE     21
   22 CONTINUE                                                           LOCATE     22
      IF (XLOC(3).LT.XLOC(2)) GO TO 55                                   LOCATE     23
      IF (XLOC(1).GE.XLOC(2).AND.XLOC(1).LE.XLOC(3)) GO TO 50            LOCATE     24
   40 IFGOOD = 2                                                         LOCATE     25
      GO TO 10000                                                        LOCATE     26
   50 IFGOOD = 1                                                         LOCATE     27
      GO TO 10000                                                        LOCATE     28
   55 IF (XLOC(1).GE.XLOC(2).OR.XLOC(1).LE.XLOC(3)) GO TO 50             LOCATE     29
      GO TO 40                                                           LOCATE     30
10000 RETURN                                                             LOCATE     31
      END                                                                LOCATE     32
      SUBROUTINE MATE7(IDIM,NN,MM,A,B,DET,IND,NOGO)                      MATE7       2
CSIMEQ           SOLVES THE EQUATION AX=B WHERE A,X, AND B ARE MATRICES  MATE7       3
      DIMENSION A(IDIM,1),B(IDIM,1),IND(1)                               MATE7       4
      N=NN                                                               MATE7       5
      M=MM                                                               MATE7       6
C        SET INITIAL CONSTANTS                                           MATE7       7
      NOGO=1                                                             MATE7       8
C        SPECIAL CONSIDERATION WHEN THE ORDER OF MATRIX A IS 1.          MATE7       9
      IF(N.NE.1) GO TO 3                                                 MATE7      10
      IF (A(1,1).EQ.0.) GO TO 110                                        MATE7      11
      HOLD=A(1,1)                                                        MATE7      12
      DO 1 I=1,M                                                         MATE7      13
    1 A(1,I)=B(1,I)/HOLD                                                 MATE7      14
      DET=DET*HOLD                                                       MATE7      15
      RETURN                                                             MATE7      16
    3 NM1=N-1                                                            MATE7      17
      NP1=N+1                                                            MATE7      18
C        INITIALIZE DETERMINANT                                          MATE7      19
      DETM=DET                                                           MATE7      20
C        INITIALIZE COLUMN INDICATORS                                    MATE7      21
      DO 5 I=1,N                                                         MATE7      22
    5 IND(I)=I                                                           MATE7      23
C        BEGIN TRIANGULARIZATION TO GET UPPER TRIANGLE                   MATE7      24
      DO 70 K=1,NM1                                                      MATE7      25
      KP1=K+1                                                            MATE7      26
      KR=K                                                               MATE7      27
      KC=K                                                               MATE7      28
C        SEARCH FOR PIVOTAL ELEMENT                                      MATE7      29
      BIGA=ABS(A(K,K))                                                   MATE7      30
      DO 10 I=K,N                                                        MATE7      31
      DO 10 J=K,N                                                        MATE7      32
      IF(BIGA.GE.ABS(A(I,J))) GO TO 10                                   MATE7      33
      BIGA=ABS(A(I,J))                                                   MATE7      34
      KR=I                                                               MATE7      35
      KC=J                                                               MATE7      36
   10 CONTINUE                                                           MATE7      37
C        TEST FOR SINGULAR MATRIX                                        MATE7      38
      IF(BIGA.EQ.0.) GO TO 110                                           MATE7      39
C        UPDATE DETERMINANT                                              MATE7      40
      DETM=DETM*A(KR,KC)                                                 MATE7      41
C        INTERCHANGE ROWS                                                MATE7      42
      IF(KR.EQ.K) GO TO 30                                               MATE7      43
      DO 20 I=K,N                                                        MATE7      44
      HOLD=A(K,I)                                                        MATE7      45
      A(K,I)=A(KR,I)                                                     MATE7      46
   20 A(KR,I)=HOLD                                                       MATE7      47
C        INTERCHANGE ELEMENTS OF RIGHT HAND SIDES                        MATE7      48
      DO 25 L=1,M                                                        MATE7      49
      HOLD=B(K,L)                                                        MATE7      50
      B(K,L)=B(KR,L)                                                     MATE7      51
   25 B(KR,L)=HOLD                                                       MATE7      52
C        CHANGE SIGN OF DETERMINANT DUE TO ROW INTERCHANGE               MATE7      53
      DETM=-DETM                                                         MATE7      54
C        INTERCHANGE COLUMNS                                             MATE7      55
   30 IF(KC.EQ.K) GO TO 55                                               MATE7      56
      DO 40 J=1,N                                                        MATE7      57
      HOLD=A(J,K)                                                        MATE7      58
      A(J,K)=A(J,KC)                                                     MATE7      59
   40 A(J,KC)=HOLD                                                       MATE7      60
C        INTERCHANGE COLUMN INDICATORS                                   MATE7      61
      I=IND(K)                                                           MATE7      62
      IND(K)=IND(KC)                                                     MATE7      63
      IND(KC)=I                                                          MATE7      64
C        CHANGE SIGN OF DETERMINANT DUE TO COLUMN INTERCHANGE            MATE7      65
      DETM=-DETM                                                         MATE7      66
C        DIVIDE REDUCED EQUATION-ON, BY LEADING ELEMENT                  MATE7      67
   55 DO 60 I=KP1,N                                                      MATE7      68
   60 A(K,I)=A(K,I)/A(K,K)                                               MATE7      69
      DO 63 L=1,M                                                        MATE7      70
   63 B(K,L)=B(K,L)/A(K,K)                                               MATE7      71
C        REDUCE MATRIX AND RIGHT HAND SIDES                              MATE7      72
      DO 70 I=KP1,N                                                      MATE7      73
      DO 65 J=KP1,N                                                      MATE7      74
   65 A(I,J)=A(I,J)-A(I,K)*A(K,J)                                        MATE7      75
      DO 70 L=1,M                                                        MATE7      76
   70 B(I,L)=B(I,L)-A(I,K)*B(K,L)                                        MATE7      77
C        FINAL TEST FOR SINGULAR MATRIX                                  MATE7      78
      IF(A(N,N).EQ.0.) GO TO 110                                         MATE7      79
C        COMPUTE FINAL DETERMINANT                                       MATE7      80
      DET=DETM*A(N,N)                                                    MATE7      81
C        BACK SUBSTITUE TO OBTAIN SOLUTION VECTORS                       MATE7      82
      DO 80 L=1,M                                                        MATE7      83
      B(N,L)=B(N,L)/A(N,N)                                               MATE7      84
      DO 80 I=1,NM1                                                      MATE7      85
      HOLD=0.                                                            MATE7      86
      J=N-I                                                              MATE7      87
      DO 75 KC=1,I                                                       MATE7      88
      K=NP1-KC                                                           MATE7      89
   75 HOLD=HOLD+A(J,K)*B(K,L)                                            MATE7      90
   80 B(J,L)=B(J,L)-HOLD                                                 MATE7      91
C     REARRANGE SOLUTION VECTORS TO ORIGINAL ORDER                       MATE7      92
      DO 90 I=1,N                                                        MATE7      93
      J=IND(I)                                                           MATE7      94
      DO 90 L=1,M                                                        MATE7      95
   90 A(J,L)=B(I,L)                                                      MATE7      96
      RETURN                                                             MATE7      97
C        SINGULAR MATRIX - REDUNDANT SET OF EQUATIONS                    MATE7      98
  110 NOGO=3                                                             MATE7      99
      DET=0.                                                             MATE7     100
      RETURN                                                             MATE7     101
      END                                                                MATE7     102
      SUBROUTINE ORTHOG(SIDE,LIM1,LIM2)                                  ORTHOG      2
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    ORTHOG      4
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         ORTHOG      5
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        ORTHOG      6
     * ,      MAP                                                        ORTHOG      7
      INTEGER SIDE,DIRCTN,PROP1,PROP2                                    ORTHOG      8
      COMMON /INTRP1/ NSTRM(2),TSFC(2),PSFC(2),USFC(2),PHISFC(2),        ORTHOG      9
     1CSFC (2,25), DPTSFC(2)                                             ORTHOG     10
      COMMON/ORSHOK/XTRY,RTRY                                            ORTHOG     11
      AX= FX(SIDE,LIM2)-FX(SIDE,LIM1)                                    ORTHOG     12
      BX= FR(SIDE,LIM2)-FR(SIDE,LIM1)                                    ORTHOG     13
      CX=AX*XTRY+BX*RTRY                                                 ORTHOG     14
      IF(AX.EQ.0.) GO TO 20                                              ORTHOG     15
      TEMP=-BX/AX*FX(SIDE,LIM1)+FR(SIDE,LIM1)                            ORTHOG     16
      TEMP1 = AX+BX*BX/AX                                                ORTHOG     17
      XINT=(CX-BX*TEMP)/TEMP1                                            ORTHOG     18
      RINT = TEMP+BX/AX*XINT                                             ORTHOG     19
      GO TO 30                                                           ORTHOG     20
   20 XINT = FX(SIDE,LIM1)                                               ORTHOG     21
      RINT=(CX-AX*XINT)/BX                                               ORTHOG     22
   30 DPTSFC(SIDE) = SQRT((XINT-XTRY)**2+(RINT-RTRY)**2)                 ORTHOG     23
      D1SQ = (XINT-FX(SIDE,LIM1))**2+(RINT-FR(SIDE,LIM1))**2             ORTHOG     24
      XMID1=(FX(SIDE,LIM1)+FX(SIDE,LIM2))/2.                             ORTHOG     25
      RMID1=(FR(SIDE,LIM1)+FR(SIDE,LIM2))/2.                             ORTHOG     26
      PROP1 = LIM2                                                       ORTHOG     27
      D2SQ = (XMID1-FX(SIDE,LIM1))**2+(RMID1-FR(SIDE,LIM1))**2           ORTHOG     28
      DIRCTN = 1                                                         ORTHOG     29
      IF (D2SQ.LT.D1SQ) DIRCTN = 2                                       ORTHOG     30
      GO TO ( 40 , 47 ), DIRCTN                                          ORTHOG     31
   40 J = LIM1                                                           ORTHOG     32
   42 IF (J.EQ.1) GO TO 54                                               ORTHOG     33
      J = J-1                                                            ORTHOG     34
   44 XMID2=(FX(SIDE,LIM1)+FX(SIDE,J))/2.                                ORTHOG     35
      RMID2=(FR(SIDE,LIM1)+FR(SIDE,J))/2.                                ORTHOG     36
      PROP2 = LIM1                                                       ORTHOG     37
      GO TO 56                                                           ORTHOG     38
   47 J = LIM2                                                           ORTHOG     39
   49 IF (J.EQ.NSTRM(SIDE)) GO TO 54                                     ORTHOG     40
      J = J+1                                                            ORTHOG     41
   52 XMID2 = (FX(SIDE,LIM2)+FX(SIDE,J))/2.                              ORTHOG     42
      RMID2 = (FR(SIDE,LIM2)+FR(SIDE,J))/2.                              ORTHOG     43
      PROP2 = J                                                          ORTHOG     44
      GO TO 56                                                           ORTHOG     45
   54 PROP2 = PROP1                                                      ORTHOG     46
      IF(J.EQ.1) GO TO 56                                                ORTHOG     47
      GO TO 57                                                           ORTHOG     48
   56 DPTMD1 = SQRT((XINT-XMID1)**2+(RINT-RMID1)**2)                     ORTHOG     49
      DMD12 = SQRT((XMID1-XMID2)**2+(RMID1-RMID2)**2)                    ORTHOG     50
      PRPRAT = DPTMD1/DMD12                                              ORTHOG     51
      USFC(SIDE) = FU(SIDE,PROP1)+PRPRAT*(FU(SIDE,PROP2)-FU(SIDE,PROP1)) ORTHOG     52
      PSFC(SIDE) = FP(SIDE,PROP1)+PRPRAT*(FP(SIDE,PROP2)-FP(SIDE,PROP1)) ORTHOG     53
   57 TSFC(SIDE) = FT(SIDE,PROP1)+PRPRAT*(FT(SIDE,PROP2)-FT(SIDE,PROP1)) ORTHOG     54
      DO 59 I=1,NDS                                                      ORTHOG     55
   59 CSFC(SIDE,I)= FC(SIDE,PROP1,I)+PRPRAT*(FC(SIDE,PROP2,I)-FC(SIDE,   ORTHOG     56
     1PROP1,I))                                                          ORTHOG     57
      D3SQ = (FX(SIDE,LIM2)-FX(SIDE,LIM1))**2+(FR(SIDE,LIM2)-FR(SIDE,    ORTHOG     58
     1LIM1))**2                                                          ORTHOG     59
      PHISFC(SIDE) = FPHI(SIDE,LIM1)+(FPHI(SIDE,LIM2)-FPHI(SIDE,LIM1))*  ORTHOG     60
     1SQRT(D1SQ/D3SQ)                                                    ORTHOG     61
10000 RETURN                                                             ORTHOG     62
      END                                                                ORTHOG     63
      SUBROUTINE PART                                                    PART        2
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    PART        4
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         PART        5
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        PART        6
     * ,      MAP                                                        PART        7
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  PART        8
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          PART        9
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      PART       10
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       PART       11
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    PART       12
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      PART       13
     1 ,SUMP,SUMPV,SUMPE                                                 PART       14
      K=K-1                                                              PART       15
      KZZ=N                                                              PART       16
      N=K+1                                                              PART       17
      DEL=(DLS(N)+DLS(N-1))*.5                                           PART       18
      DO 1 J=1, NPG                                                      PART       19
      IF (K.GT. NBL(J)) GO TO 3                                          PART       20
      XX6=DEL *V(K,J)/W(K,J)                                             PART       21
      IF(K.EQ.1) GO TO 13                                                PART       22
      K1=K-1                                                             PART       23
      RX1= (.5*(R(K1+1)+R(K1)))**DELTA                                   PART       24
      RX2=(.5*(R(K1+2)+R(K1+1)))**DELTA                                  PART       25
      DELLY=SQRT((X(K1+2)-X(K1))**2+(R(K1+2)-R(K1))**2)*.5               PART       26
      THEN=(PHI(K1+2)-PHI(K1))/DELLY *.5                                 PART       27
      DWDN=(W(K1+1,J)-W(K1,J))/DELLY                                     PART       28
      DVDN=(V(K1+1,J)-V(K1,J))/DELLY                                     PART       29
      DTDN=(TP(K1+1,J)-TP(K1,J))/DELLY                                   PART       30
      DRRVDN=(RX2  *RHP(K1+1,J)*V(K1+1,J)                                PART       31
     1 -RX1  *RHP(K1,J)*V(K1,J))/DELLY                                   PART       32
      GO TO 16                                                           PART       33
   13 DWDN=0.0                                                           PART       34
      DELLY=SQRT(R(2)**2+(X(2)-X(1))**2)  *.5                            PART       35
      DVDN=V(1,J)/DELLY                                                  PART       36
       DTDN=0.0                                                          PART       37
      DRRVDN=RHP(1,J)*V(1,J)/DELLY*(R(2)/2.)**DELTA                      PART       38
      THEN=PHI(2)/(2.*DELLY)                                             PART       39
   16 THES=(PHI2(N)+PHI2(N-1)-PHI(N)-PHI(N-1))/(DLS(N)+DLS(N-1))         PART       40
      W2(K,J)=W(K,J)-XX6*DWDN                                            PART       41
     1      +XX6*V(K,J)*THEN                                             PART       42
     2      +DEL *V(K,J)*THES +XMOMP(J)*DEL /W(K,J)                      PART       43
      V2(K,J)= V(K,J)- XX6*DVDN                                          PART       44
     1      - DEL *V(K,J)*THEN                                           PART       45
     2      - W(K,J)*DEL *THES                                           PART       46
     3      - XMOMV(J)*DEL /W(K,J)                                       PART       47
C      ENERGY EQUATION                                                   PART       48
      CC=CL                                                              PART       49
      IF(TP(K,J).LE.TPS) CC=CS                                           PART       50
      IF (ICOND(K,J).EQ.0) GO TO 14                                      PART       51
      XX8= WTP(J)*ENEP2(J)      *DEL /W(K,J)/HJ                          PART       52
      XX9=4.0*PI*RP(J)*RP(J)*EP*SIG*(TPS**4.0)/W(K,J)*DEL/HJ             PART       53
      DENG(K,J)=DENG(K,J)+XX8+XX9                                        PART       54
      IF (ABS(DENG(K,J)).LT.HC(J)) GO TO 12                              PART       55
      ICOND(K,J)=0                                                       PART       56
      WRITE (6,102) RP(J),S,K,DENG(K,J)                                  PART       57
   14 CONTINUE                                                           PART       58
      XX8=ENEP2(J)/HJ/W(K,J)/CC                                          PART       59
      XX9=     EP*SIG*3.0/(W(K,J)   *RP(J)*RHSS*CC) *(TP(K,J)**4.0)/HJ   PART       60
      TP2(K,J)= TP(K,J)-XX6*DTDN -(XX8+XX9)*DEL                          PART       61
      IF (((TP2(K,J)-TPS)*(TP(K,J)-TPS)).GE.0.0) GO TO 12                PART       62
      ICOND(K,J)=1                                                       PART       63
      TP2(K,J)=TPS                                                       PART       64
      WRITE (6,103) RP(J),S,K                                            PART       65
  103 FORMAT (1H ,1PE10.3,43H CM PARTICLE  GROUP START SOLIDIFYING AT S= PART       66
     1,0PF10.4,19H CM STREAMTUBE NO. ,I5/)                               PART       67
   12 CONTINUE                                                           PART       68
C        CONTINUITY EQUATION                                             PART       69
      RX1=(.5*(R(K+1)+R(K)))**DELTA                                      PART       70
      R2X1=(.5*(R2(K+1)+R2(K)))**DELTA                                   PART       71
      XX10=RX1 *RHP(K,J)*W(K,J)                                          PART       72
      XX11=RX1 *RHP(K,J)*V(K,J)                                          PART       73
      RHP2(K,J)= 1.0/(R2X1 *W2(K,J))*(XX10*(1.0-DEL *THEN)               PART       74
     1     -DRRVDN*DEL                                                   PART       75
     2        + XX11*THES*DEL )                                          PART       76
      GO TO 1                                                            PART       77
    3 V2(K,J)=0.0                                                        PART       78
      W2(K,J)=0.0                                                        PART       79
      TP2(K,J)=0.0                                                       PART       80
      RHP2(K,J)= 0.0                                                     PART       81
      REP(K,J)=0.0                                                       PART       82
    1 CONTINUE                                                           PART       83
  102 FORMAT (1H ,1PE10.3,40H CM SIZE PARTICLE GROUP SOLIDIFIED AT S= ,  PART       84
     1 0PF10.4,19H CM  STREAMTUBE NO. ,I5, 3X,1PE10.3,3HCAL /)           PART       85
      K=K+1                                                              PART       86
      N=KZZ                                                              PART       87
      RETURN                                                             PART       88
      END                                                                PART       89
      SUBROUTINE PBNDY                                                   PBNDY       2
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    PBNDY       4
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         PBNDY       5
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        PBNDY       6
     * ,      MAP                                                        PBNDY       7
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  PBNDY       8
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          PBNDY       9
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      PBNDY      10
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       PBNDY      11
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    PBNDY      12
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      PBNDY      13
     1 ,SUMP,SUMPV,SUMPE                                                 PBNDY      14
      KMX=0                                                              PBNDY      15
      DO 5 J=1, NPG                                                      PBNDY      16
      NBLJ=NBL(J)                                                        PBNDY      17
      NBL1=NBLJ+1                                                        PBNDY      18
      DNDSP(J)= DNDSP(J)+ DLS(NBL1)*V2(NBLJ,J)/W2(NBLJ,J)                PBNDY      19
      TRBDY(J)= Y2(NBL1 )+DNDSP(J)                                       PBNDY      20
      DO 12 IEM=1,KMAX                                                   PBNDY      21
      IF (TRBDY(J) .LT. Y2(IEM+1)) GO TO 15                              PBNDY      22
   12 CONTINUE                                                           PBNDY      23
      IF (PAR(1).EQ.0.0) WRITE(6,103)                                    11AUG      49
   15 CONTINUE                                                           PBNDY      25
      IF (IEM.NE.NBL(J)) DNDSP(J)=TRBDY(J)-Y2(IEM+1)                     PBNDY      26
      IF (IEM.GT.KMX) KMX=IEM                                            PBNDY      27
      DO 14 LK=1,IEM                                                     PBNDY      28
      IF (LK.GT.NBL(J)) GO TO 17                                         PBNDY      29
      GO TO 16                                                           PBNDY      30
   17 W2(LK,J)=W2(LK-1,J)                                                PBNDY      31
      V2(LK,J)=V2(LK-1,J)                                                PBNDY      32
      TP2(LK,J)=TP2(LK-1,J)                                              PBNDY      33
      RHP2(LK,J)= RHP2(LK-1,J)                                           PBNDY      34
   16 CONTINUE                                                           PBNDY      35
      V(LK,J)= V2(LK,J)                                                  PBNDY      36
      W(LK,J)= W2(LK,J)                                                  PBNDY      37
      TP(LK,J)=TP2(LK,J)                                                 PBNDY      38
   11 RHP(LK,J)= RHP2(LK,J)                                              PBNDY      39
   14 CONTINUE                                                           PBNDY      40
      NBL(J)=IEM                                                         PBNDY      41
    5 CONTINUE                                                           PBNDY      42
      IF (PAR(1).EQ.0.0) WRITE(6,102) S,(TRBDY(J),J=1,NPG)               11AUG      50
  102 FORMAT(  1H ,33H BOUNDARY OF PARTICLE PHASE AT S= ,F11.5, 1P8E11.3 PBNDY      44
     1/)                                                                 PBNDY      45
  103 FORMAT(41H  -------NO PARTICLES IN THIS FLOW FIELD  //)            PBNDY      46
      RETURN                                                             PBNDY      47
      END                                                                PBNDY      48
      SUBROUTINE PPTOUT(KKKK)                                            PPTOUT      2
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    PPTOUT      4
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         PPTOUT      5
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        PPTOUT      6
     * ,      MAP                                                        PPTOUT      7
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  PPTOUT      8
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          PPTOUT      9
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      PPTOUT     10
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       PPTOUT     11
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    PPTOUT     12
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      PPTOUT     13
     1 ,SUMP,SUMPV,SUMPE                                                 PPTOUT     14
      DIMENSION PTP(8)                                                   PPTOUT     15
      IF(KKKK.EQ.1) GO TO 3                                              PPTOUT     16
      LKI=K-1                                                            PPTOUT     17
      LKMAX=K-1                                                          PPTOUT     18
      GO TO 4                                                            PPTOUT     19
    3 LKI=1                                                              PPTOUT     20
      LKMAX=KMX+2                                                        PPTOUT     21
    4 CONTINUE                                                           PPTOUT     22
      DO 2 LK=LKI,LKMAX                                                  PPTOUT     23
      LK1=LK+1                                                           PPTOUT     24
      PTPP=0.0                                                           PPTOUT     25
      DO 6 J=1,NPG                                                       PPTOUT     26
      PTP(J)=RHP2(LK,J)*W2(LK,J)**2/(2.*BETAP)                           PPTOUT     27
      PTPP=PTPP+PTP(J)                                                   PPTOUT     28
    6 CONTINUE                                                           PPTOUT     29
      WRITE(6,101) LK,S,U2(LK1),T2(LK1),RHO(LK1),RE(LK1),Y2(LK1)         PPTOUT     30
     1 ,R2(LK1)                                                          PPTOUT     31
      WRITE (6,99)                                                       PPTOUT     32
      WRITE(6,107) (J,J=1,NPG)                                           PPTOUT     33
      WRITE(6,102) (W2(LK,J),J=1,NPG)                                    PPTOUT     34
      WRITE(6,103) (V2(LK,J),J=1,NPG)                                    PPTOUT     35
      WRITE(6,104) (REP(LK,J),J=1,NPG)                                   PPTOUT     36
      WRITE(6,105) (TP2(LK,J),J=1,NPG)                                   PPTOUT     37
      WRITE(6,106) (RHP2(LK,J),J=1,NPG)                                  PPTOUT     38
      WRITE(6,108) PTPP                                                  PPTOUT     39
    2 CONTINUE                                                           PPTOUT     40
   99 FORMAT(/1H ,39H----- PARTICLE PHASE PROPERTIES -----    /)         PPTOUT     41
  101 FORMAT  (//1H ,15H---STREAMTUBE= ,I5,4H  S=,F12.5///,2X,23H-- LOCA PPTOUT     42
     1L GAS PROPERTIES  //,2X,2HU=,1PE10.3,2X,2HT=,E10.3,2X,8HDENSITY=,  PPTOUT     43
     2E10.3,2X,13HREYNOLDS NO.=,E10.3,2X,3HY2=,E10.3,2X,3HR2=,E10.3)     PPTOUT     44
  102 FORMAT (1H ,19HDOWNSTREAM VELOCITY ,2X,1P8E12.3)                   PPTOUT     45
  103 FORMAT(1H ,21HCROSS-STREAM VELOCITY,1P8E12.3)                      PPTOUT     46
  104 FORMAT(1H ,21HPARTICLE REYNOLDS NO.,1P8E12.3)                      PPTOUT     47
  105 FORMAT(1H ,20HPARTICLE TEMPERATURE,1X,1P8E12.3)                    PPTOUT     48
  106 FORMAT(1H ,16HPARTICLE DENSITY,5X,1P8E12.3)                        PPTOUT     49
  107 FORMAT(1H ,14HPARTICLE GROUP,8(7X,I5))                             PPTOUT     50
  108 FORMAT(1H,24H PARTICLE MOMENTUM FLUX  ,2X,1P8E12.3  )              PPTOUT     51
      RETURN                                                             PPTOUT     52
      END                                                                PPTOUT     53
      SUBROUTINE PPUTIN                                                  PPUTIN      2
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    PPUTIN      4
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         PPUTIN      5
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        PPUTIN      6
     * ,      MAP                                                        PPUTIN      7
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  PPUTIN      8
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          PPUTIN      9
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      PPUTIN     10
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       PPUTIN     11
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    PPUTIN     12
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      PPUTIN     13
     1 ,SUMP,SUMPV,SUMPE                                                 PPUTIN     14
      DIMENSION VI(8),WI(8),TPI(8),RHPI(8)  ,DENGI(8)                    PPUTIN     15
      NAMELIST/NAM1/ FFF,FFG,UMI   ,CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,NPG,  PPUTIN     16
     1 NC,KMX,RP,WI,VI,TPI,RHPI                                          PPUTIN     17
      READ (5,100) FFF,FFG,CL,CS,HTRAN,WT                                PPUTIN     18
      READ(5,100) RHSS,SIG,EP,TPS                                        PPUTIN     19
      READ(5,107) NPG,NC                                                 PPUTIN     20
      READ (5,107) (NBL(J),J=1,NPG)                                      PPUTIN     21
      DO25 J=1,NPG                                                       PPUTIN     22
   25 NBL(J)=NBL(J)-1                                                    PPUTIN     23
      KMX=NBL(1)                                                         PPUTIN     24
      IF (NPG.LE.1) GO TO 245                                            PPUTIN     25
      DO 241 J=2,NPG                                                     PPUTIN     26
      IF (KMX.LT.NBL(J)) KMX=NBL(J)                                      PPUTIN     27
  241 CONTINUE                                                           PPUTIN     28
  245 CONTINUE                                                           PPUTIN     29
      READ (5,100) (RP(J),J=1,NPG)                                       PPUTIN     30
      IF(NC.EQ.1) GO TO 2                                                PPUTIN     31
      READ(5,100) (WI(J),J=1,NPG)                                        PPUTIN     32
      READ(5,100) (VI(J),J=1,NPG)                                        PPUTIN     33
      READ(5,100) (TPI(J),J=1,NPG)                                       PPUTIN     34
      READ(5,100) (RHPI(J),J=1,NPG)                                      PPUTIN     35
      READ(5,100) (DENGI(J),J=1,NPG)                                     PPUTIN     36
      DO 5 J=1,NPG                                                       PPUTIN     37
      KMA=NBL(J)                                                         PPUTIN     38
      DO 4 K=1,KMA                                                       PPUTIN     39
      W(K,J)=WI(J)                                                       PPUTIN     40
      V(K,J)=(K-1)*VI(J)/(KMA-1)                                         PPUTIN     41
      TP(K,J)=TPI(J)                                                     PPUTIN     42
      RHP(K,J)=RHPI(J)                                                   PPUTIN     43
      DENG(K,J)=DENGI(J)                                                 PPUTIN     44
      W2(K,J)=W(K,J)                                                     PPUTIN     45
      V2(K,J)=V(K,J)                                                     PPUTIN     46
      TP2(K,J)=TP(K,J)                                                   PPUTIN     47
      RHP2(K,J)=RHP(K,J)                                                 PPUTIN     48
    4 CONTINUE                                                           PPUTIN     49
      DNDSP(J)=0.0                                                       PPUTIN     50
      TRBDY(J)=Y(KMA+1)                                                  PPUTIN     51
    5 CONTINUE                                                           PPUTIN     52
      DO 21 J=1, NPG                                                     PPUTIN     53
      KMA=NBL(J)                                                         PPUTIN     54
      DO 21 K=1,KMA                                                      PPUTIN     55
      ICOND(K,J)=0                                                       PPUTIN     56
   21 CONTINUE                                                           PPUTIN     57
      GO TO 3                                                            PPUTIN     58
    2 CONTINUE                                                           PPUTIN     59
      DO 1 K=1,KMX                                                       PPUTIN     60
      READ (5,100) (W(K,J),J=1,NPG)                                      PPUTIN     61
      READ (5,100) (V(K,J),J=1,NPG)                                      PPUTIN     62
      READ (5,100) (TP(K,J),J=1,NPG)                                     PPUTIN     63
      READ (5,100) (RHP(K,J),J=1,NPG)                                    PPUTIN     64
      READ(5,107) (ICOND(K,J),J=1,NPG)                                   PPUTIN     65
      READ(5,100) (DENG(K,J),J=1,NPG)                                    PPUTIN     66
      DO 6 J=1,NPG                                                       PPUTIN     67
      W2(K,J)=W(K,J)                                                     PPUTIN     68
      V2(K,J)=V(K,J)                                                     PPUTIN     69
      TP2(K,J)=TP(K,J)                                                   PPUTIN     70
      RHP2(K,J)=RHP(K,J)                                                 PPUTIN     71
    6 CONTINUE                                                           PPUTIN     72
    1 CONTINUE                                                           PPUTIN     73
      READ( 5,100) (TRBDY(J),J=1,NPG)                                    PPUTIN     74
      READ( 5,100) (DNDSP(J),J=1,NPG)                                    PPUTIN     75
    3 CONTINUE                                                           PPUTIN     76
      WRITE(6,NAM1)                                                      PPUTIN     77
      DO 7 J=1, NPG                                                      PPUTIN     78
      VOLP(J)=1.333333*PI*(RP(J)**3)                                     PPUTIN     79
      WTP(J)=VOLP(J)*RHSS                                                PPUTIN     80
    7 HC(J)=WTP(J)   *HTRAN                                              PPUTIN     81
      DO 12 J=1,NPG                                                      PPUTIN     82
      IF (KMAX-NBL(J)) 12,12,11                                          PPUTIN     83
   11 KMA1=NBL(J)+1                                                      PPUTIN     84
      DO 10 K=KMA1,KMAX                                                  PPUTIN     85
      W(K,J)=0.0                                                         PPUTIN     86
      V(K,J)=0.0                                                         PPUTIN     87
      TP(K,J)=0.0                                                        PPUTIN     88
      RHP(K,J)=0.0                                                       PPUTIN     89
      W2(K,J)=0.0                                                        PPUTIN     90
      V2(K,J)=0.0                                                        PPUTIN     91
      TP2(K,J)=0.0                                                       PPUTIN     92
      RHP2(K,J)=0.0                                                      PPUTIN     93
      DENG(K,J)=0.0                                                      PPUTIN     94
      ICOND(K,J)=0                                                       PPUTIN     95
   10 CONTINUE                                                           PPUTIN     96
   12 CONTINUE                                                           PPUTIN     97
      DO 22 K=1,KMAX                                                     PPUTIN     98
      WRITE(6,101) K                                                     PPUTIN     99
      WRITE(6,102) ( W(K,J),J=1,NPG)                                     PPUTIN    100
      WRITE(6,103) ( V(K,J),J=1,NPG)                                     PPUTIN    101
      WRITE(6,105) ( TP(K,J),J=1,NPG)                                    PPUTIN    102
      WRITE(6,106) ( RHP(K,J),J=1,NPG)                                   PPUTIN    103
   22 CONTINUE                                                           PPUTIN    104
  100 FORMAT(8E10.3)                                                     PPUTIN    105
  101 FORMAT(//1H ,2HK=, I5/)                                            PPUTIN    106
  102 FORMAT(1H ,19HDOWNSTREAM VELOCITY ,2X,1P8E12.3)                    PPUTIN    107
  103 FORMAT(1H ,21HCROSS-STREAM VELOCITY ,1P8E12.3)                     PPUTIN    108
  105 FORMAT(1H ,20HPARTICLE TEMPERATURE ,1X,1P8E12.3)                   PPUTIN    109
  106 FORMAT(1H ,16HPARTICLE DENSITY ,5X,1P8E12.3)                       PPUTIN    110
  107 FORMAT(8I5)                                                        PPUTIN    111
      RETURN                                                             PPUTIN    112
      END                                                                PPUTIN    113
      SUBROUTINE PUTIN                                                   PUTIN       2
C     THIS SUBROUTINE READS IN AND INITIALIZES ALL DATA EXCEPT THAT      PUTIN       3
C     HAVING TO DO WITH AN EXTERNAL NON-UNIFORM FLOW FIELD               PUTIN       4
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    PUTIN       6
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         PUTIN       7
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        PUTIN       8
     * ,      MAP                                                        PUTIN       9
      REAL MASSMD,L1,L2                                                  PUTIN      10
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  PUTIN      11
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          PUTIN      12
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      PUTIN      13
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       PUTIN      14
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    PUTIN      15
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      PUTIN      16
     1 ,SUMP,SUMPV,SUMPE                                                 PUTIN      17
      COMMON/IBUGS1/ IBUGSH                                              PUTIN      18
      COMMON/CHEM1/ ZID(5), IRR(30),IRT(30),RC(30,3),IRRR(30,5),         PUTIN      19
     1 AV,CM(21,21),FI(21),WP(21),                                       PUTIN      20
     2 WM(21),WDOT(21,30),CSI(21),QX(21)                                 PUTIN      21
      COMMON/INPUX/ITD,X0,Y0,FRAC  ,KFL                                  PUTIN      22
      COMMON/TRNSPT/ ALFTD(25),DEXP(25)                                  PUTIN      23
      COMMON/INPRO/ ICSH,IIN                                             PUTIN      24
      EQUIVALENCE (IVISC,IEXTRA(1)),(IPCH,IEXTRA(5))                     PUTIN      25
      COMMON/SHOPUT/ XSHW,RSHW,PSIW,PSHW,TSHW,USHW,CSHW(20)              PUTIN      26
      COMMON/INSHOP/ POO,TOO,UOO,PHOO,COO(20)                            PUTIN      27
      COMMON/INTL/ XLX,IKI,REX                                           PUTIN      28
      COMMON/TURBUL/TLE,TPR,EDDYK,ITURB,DELMIX                           PUTIN      29
      COMMON/CFF/IPTO                                                    PUTIN      30
      COMMON/XLM/XLMD                                                    PUTIN      31
      COMMON/PERGFF/PERGF                                                PUTIN      32
      COMMON/DMD/KMNF                                                    PUTIN      33
      COMMON/SUB/XDIS,L1,L2,PHIO,RSTAR,RMD,MASSMD,RNOZ,THTP,THRU         PUTIN      34
      COMMON/DSL/RDSL,PHDSL,XINIT                                        PUTIN      35
      INTEGER THRU                                                       PUTIN      36
      DIMENSION AB(7)                                                    PUTIN      37
      EQUIVALENCE (PWSH,EXTRA(11)),(ITAPES,IEXTRA(2))                    PUTIN      38
      IIN=0                                                              PUTIN      39
C     INTEGRAL PARAMETERS,LIMITS,AND SWITCHES                            PUTIN      40
      CARD1 = 1.                                                         PUTIN      41
      READ (5,100) ITYPE,IKIND,IPD,IPTUC,ISHOCK,IBUGSH,ITD,ICSH,         PUTIN      42
     *  ITAPES,IPART,IKI,ITURB,IPTO,ISB                                  PUTIN      43
      READ (5,100) KMAX,NN,KP,MMAX,NMAX,NDS,NITER,LPLANE,IKINE, IPCH,KMN PUTIN      44
     *,KMNF                                                              PUTIN      45
  100 FORMAT (16I5)                                                      PUTIN      46
      IF (IPART.EQ.2) IROG=1                                             PUTIN      47
      WRITE (6,610) KMAX,NN,KP,IP,ITYPE,IKIND,MMAX,NMAX,NDS,IPD,NITER,   PUTIN      48
     2  IDIFF,LPLANE,IPTUC,IPCH,ISHOCK,IBUGSH,ITD,ICSH,ITAPES,IKINE,     PUTIN      49
     3  IPART,IKI,ITURB,IPTO,ISB,                                        PUTIN      50
     4KMN,KMNF                                                           PUTIN      51
151   IF(IKI.EQ.0)GO TO 152                                              PUTIN      52
      REWIND 9                                                           PUTIN      53
      REWIND 10                                                          PUTIN      54
      DO 5565 I=1,NDS                                                    PUTIN      55
 5565 READ (9,201) (A(I,J),J=1,NN),CSI(I)                                PUTIN      56
      DO 5566 I=1,NDS                                                    PUTIN      57
 5566 READ (9,400) IDENT(I),MU0(I),T0(I),OMEGA(I),PR(I),SC(I),MW(I)      PUTIN      58
       READ(9,3) XLMD                                                    PUTIN      59
    3 FORMAT(E12.5)                                                      PUTIN      60
      IF(KMN.GE.1) KMAXX=KMAX                                            PUTIN      61
      READ (9,101) KMAX,DELMIX                                           PUTIN      62
      IF(KMN.GE.1) KMAX=KMAXX                                            PUTIN      63
  101 FORMAT (I2,2E12.5)                                                 PUTIN      64
      REWIND 3                                                           PUTIN      65
      IF(IKI.EQ.1)REWIND 4                                               PUTIN      66
  152 EXTRA(3)=KMAX                                                      PUTIN      67
      KFL=KMAX                                                           PUTIN      68
      ALPHAP=KP                                                          PUTIN      69
  200 FORMAT(6E12.4)                                                     PUTIN      70
C     NON-INTEGRAL PARAMETERS                                            PUTIN      71
      READ (5,250) ALPHAH,EPSLON,TOL,DELTA,ATOL,FSTEP,GRAD,FRAC,FRACTN   PUTIN      72
      WRITE(6,612) ALPHAH,EPSLON,TOL,DELTA,ATOL,FSTEP,GRAD,FRAC,FRACTN   PUTIN      73
      READ(5,725) (PAR(I),I=1,10)                                        11AUG      51
  725 FORMAT(3F5.1,4E10.2,F5.1,2E10.2)                                   11AUG      52
      WRITE(6,730) (PAR(I),I=1,10)                                       11AUG      53
  730 FORMAT(1H ,/5X,6HPAR(1),6X,6HPAR(2),6X,6HPAR(3),6X,6HPAR(4),       11AUG      54
     *6X,6HPAR(5),6X,6HPAR(6),6X,6HPAR(7),6X,6HPAR(8),6X,6HPAR(9),       11AUG      55
     *6X,7HPAR(10),/5X,F5.1,7X,F5.1,7X,F5.1,4X,3(E10.4,2X),1X,E10.4,4X,  11AUG      56
     *F5.1,3X,E10.4,4X,E10.4)                                            11AUG      57
  250 FORMAT (8F9.4,1F8.4)                                               PUTIN      74
      EXTRA(4)=FRACTN                                                    PUTIN      75
      IF (ITD) 260,270,260                                               PUTIN      76
  260 READ (5,1600) (ALFTD(I),I=1,NDS)                                   PUTIN      77
      READ (5,1600) ( DEXP(I),I=1,NDS)                                   PUTIN      78
      WRITE (6,613)                                                      PUTIN      79
      DO 614 I=1,NDS                                                     PUTIN      80
  614 WRITE (6,615) I,ALFTD(I),DEXP(I)                                   PUTIN      81
  270 PI=3.14159265                                                      PUTIN      82
      RU=RCON*HJ                                                         PUTIN      83
      RV=RU/BETAP                                                        PUTIN      84
C     ENTHALPY POLYNOMIAL CONSTANTS                                      PUTIN      85
      IF (IKI.NE.0) GO TO 5563                                           PUTIN      86
      DO 300 I=1,NDS                                                     PUTIN      87
      READ (5,201) (A(I,J),J=1,NN),CSI(I)                                PUTIN      88
  300 WRITE(9,201) (A(I,J),J=1,NN),CSI(I)                                PUTIN      89
 5563 CONTINUE                                                           PUTIN      90
  201 FORMAT(4E13.5/3E13.5)                                              PUTIN      91
      DO 341 JK=1,6                                                      PUTIN      92
  341 AB(JK)=0.0                                                         PUTIN      93
C     TRANSPORT PROPERTIES                                               PUTIN      94
      IVISC=0                                                            PUTIN      95
      WRITE (6,616)                                                      PUTIN      96
      DO 350 I=1,NDS                                                     PUTIN      97
      IF (IKI.NE.0) GO TO 5562                                           PUTIN      98
      READ (5,400) IDENT(I),MU0(I),T0(I),OMEGA(I),PR(I),SC(I),MW(I)      PUTIN      99
      WRITE(9,400) IDENT(I),MU0(I),T0(I),OMEGA(I),PR(I),SC(I),MW(I)      PUTIN     100
 5562 WRITE(6,617) IDENT(I),MU0(I),T0(I),OMEGA(I),PR(I),SC(I),MW(I)      PUTIN     101
      DO 5561 JK=1,6                                                     PUTIN     102
      AB(JK)=A(I,JK)                                                     PUTIN     103
 5561 CONTINUE                                                           PUTIN     104
      A(I,1)=-AB(5)*1.0E+6/MW(I)                                         PUTIN     105
      A(I,2)=AB(6)/MW(I)*1000.0                                          PUTIN     106
      A(I,3)=AB(1)/MW(I)                                                 PUTIN     107
      A(I,4)=AB(2)/(2.0E3*MW(I))                                         PUTIN     108
      A(I,5)=AB(3)/(3.0E6*MW(I))                                         PUTIN     109
      A(I,6)=AB(4)/(4.0E9*MW(I))                                         PUTIN     110
      CSI(I)=CSI(I)/MW(I)                                                PUTIN     111
  350 CONTINUE                                                           PUTIN     112
      IF (IROG.EQ.1.AND.IPART.EQ.0) GO TO 9500                           PUTIN     113
      GO TO 9600                                                         PUTIN     114
 9500 NDS=NDS+1                                                          PUTIN     115
      A(NDS,1)=CS                                                        PUTIN     116
      DO 9550 I=2,NN                                                     PUTIN     117
 9550 A(NDS,I)=0.                                                        PUTIN     118
      CSI(NDS)=0.                                                        PUTIN     119
      IDENT(NDS)=ALOX                                                    PUTIN     120
      MU0(NDS)=0.                                                        PUTIN     121
      T0(NDS)=300.                                                       PUTIN     122
      OMEGA(NDS)=0.75                                                    PUTIN     123
      PR(NDS)=1.4                                                        PUTIN     124
      SC(NDS)=1.4                                                        PUTIN     125
      MW(NDS)=1.E+10                                                     PUTIN     126
 9600 CONTINUE                                                           PUTIN     127
      DO 340 J=4,NN                                                      PUTIN     128
      DO 340 I=1,NDS                                                     PUTIN     129
      IF(A(I,1)) 330,351,330                                             PUTIN     130
  351 IF (A(I,J)) 330,340,330                                            PUTIN     131
  330 ICONST=1                                                           PUTIN     132
  340 CONTINUE                                                           PUTIN     133
  400 FORMAT(A4,8X,5E12.4,1E8.2)                                         PUTIN     134
      DELMIX=0.0                                                         PUTIN     135
      IF(ITURB.EQ.0) GO TO 450                                           PUTIN     136
      READ(5,6900) TLE,TPR,EDDYK,PERGF                                   PUTIN     137
      WRITE(6,618) TLE,TPR,EDDYK,PERGF                                   PUTIN     138
      IVISC=1                                                            PUTIN     139
      GO TO 650                                                          PUTIN     140
  450 DO 600 I=1,NDS                                                     PUTIN     141
      IF (MU0(I)) 500,600,500                                            PUTIN     142
  500 IVISC=1                                                            PUTIN     143
  600 CONTINUE                                                           PUTIN     144
      IF(ITURB.EQ.0.AND.IPART.NE.0) IVISC =0                             PUTIN     145
  650 MU=10.0**(-20)                                                     PUTIN     146
      MU2=10.0**(-20)                                                    PUTIN     147
      IF (KMN.GT.1) GO TO 8000                                           PUTIN     148
C     INNER STREAMLINE POSITION                                          PUTIN     149
 1100 K=1                                                                PUTIN     150
      IF (IKI.EQ.0) READ (5,200) X(K),R(K),PHI(K)                        PUTIN     151
      WRITE(6,619)                                                       PUTIN     152
      IF (IKI.NE.0) READ (9,200) X(K),R(K),PHI(K)                        PUTIN     153
      WRITE(6,620) K,X(K),R(K),PHI(K)                                    PUTIN     154
      X0=X(K)                                                            PUTIN     155
      Y(K)=0.0                                                           PUTIN     156
C     OTHER STREAMLINE POSITION AND STREAMTUBE PROPER                    PUTIN     157
      K=2                                                                PUTIN     158
 1200 CONTINUE                                                           PUTIN     159
      IF (IKI.EQ.0) READ(5,200) X(K),R(K),PHI(K),P(K),T(K),U(K)          PUTIN     160
      IF (IKI.NE.0) READ(9,200) X(K),R(K),PHI(K),P(K),T(K),U(K)          PUTIN     161
      WRITE(6,620) K,X(K),R(K),PHI(K),P(K),T(K),U(K)                     PUTIN     162
      B=SQRT((X(K)-X(K-1))**2+(R(K)-R(K-1))**2)                          PUTIN     163
      IF (ABS(PHI(K)-PHI(K-1))-1.0E-06) 1300,1300,1400                   PUTIN     164
 1300 DELY(K)=B                                                          PUTIN     165
      GO TO 1500                                                         PUTIN     166
 1400 DELY(K)=(PHI(K)-PHI(K-1))*B/(2.0*SIN(.5*(PHI(K)-PHI(K-1))))        PUTIN     167
 1500 AA(K)=PI*(R(K)+R(K-1))**DELTA*DELY(K)                              PUTIN     168
      Y(K)=Y(K-1)+DELY(K)                                                PUTIN     169
C     STREAMTUBE COMPOSITION (SPECIES MASS FRACTIONS)                    PUTIN     170
      IF (IKI.EQ.0) READ(5,1600) (C(I,K),I=1,NDS)                        PUTIN     171
      IF (IKI.NE.0) READ(9,1600) (C(I,K),I=1,NDS)                        PUTIN     172
 1600 FORMAT(8E10.3)                                                     PUTIN     173
C     SETUP CALCULATIONS                                                 PUTIN     174
 1900 ZMW=0.0                                                            PUTIN     175
      DO 2000 I=1,NDS                                                    PUTIN     176
 2000 ZMW=ZMW+C(I,K)/MW(I)                                               PUTIN     177
      ZMW=1.0/ZMW                                                        PUTIN     178
      ZMWK(K)=ZMW                                                        PUTIN     179
      DO 2100 I=1,NDS                                                    PUTIN     180
 2100 XS(I,K)=C(I,K)*ZMW/MW(I)                                           PUTIN     181
 2400 RHO(K)=ZMW*P(K)/(RV*T(K))                                          PUTIN     182
      RHABAR=RHO(K)                                                      PUTIN     183
      MDOT(K)=RHO(K)*U(K)*AA(K)                                          PUTIN     184
      FMAX=1.0                                                           PUTIN     185
      KAY=0.0                                                            PUTIN     186
      DO 2403 I=1,NDS                                                    PUTIN     187
      DO 2405 J=1,NN                                                     PUTIN     188
      DIH(I,J)=0.0                                                       PUTIN     189
 2405 CONTINUE                                                           PUTIN     190
 2403 CONTINUE                                                           PUTIN     191
      IF (IVISC) 2406,2402,2406                                          PUTIN     192
 2402 DO 2404 I=1,NDS                                                    PUTIN     193
      CPS(I)=0.0                                                         PUTIN     194
      DO 2404 J=1,NN                                                     PUTIN     195
 2404 CPS(I)=CPS(I)+FLOAT(J-2)*A(I,J)*T(K)**(J-3)                        PUTIN     196
      GO TO 2408                                                         PUTIN     197
 2406 CALL TRANSP(T(K),P(K),K)                                           PUTIN     198
 2408 CP=0.0                                                             PUTIN     199
      DO 2410 I=1,NDS                                                    PUTIN     200
 2410 CP=CP+CPS(I)*C(I,K)                                                PUTIN     201
      IF (KAY-MU*CP) 2430,2430,2420                                      PUTIN     202
 2420 FMAX=KAY/(CP*MU)                                                   PUTIN     203
 2430 DO 2450 I=1,NDS                                                    PUTIN     204
      MAX=I                                                              PUTIN     205
      DO 2450 J=1,MAX                                                    PUTIN     206
      IF (DIH(I,J)*RHO(K)/MU-FMAX) 2450,2450,2440                        PUTIN     207
 2440 FMAX= DIH(I,J)*RHO(K)/MU                                           PUTIN     208
 2450 CONTINUE                                                           PUTIN     209
      RE(K)=RHO(K)*U(K)*DELY(K)/(MU*FMAX)                                PUTIN     210
      MA(K)=U(K)*SQRT((CP*ZMW-RCON)/(CP*T(K)*RU))                        PUTIN     211
      GAMA=CP/(CP-RCON/ZMW )                                             PUTIN     212
      PQ= 4.0*GAMA/(9.*GAMA-5.0)                                         PUTIN     213
      H(K)=0.0                                                           PUTIN     214
      DO 2500 I=1,NDS                                                    PUTIN     215
      DO 2500 J=1,NN                                                     PUTIN     216
 2500 H(K)=H(K)+A(I,J)*C(I,K)*T(K)**(J-2)                                PUTIN     217
      IF (K-KMAX) 2600,2700,2700                                         PUTIN     218
 2600 K=K+1                                                              PUTIN     219
      GO TO 1200                                                         PUTIN     220
 2700 Y0=Y(KMAX)                                                         PUTIN     221
      REX=R(KMAX)                                                        PUTIN     222
      IF(IKI.EQ.0) RNOZ=REX                                              PUTIN     223
C     WALL CONDITIONS                                                    PUTIN     224
      IF (IKI.NE.0) GO TO 2801                                           PUTIN     225
      WRITE(6,621)                                                       PUTIN     226
      DO 2800 I=1,MMAX                                                   PUTIN     227
      READ  (5,200) XW(I),RW(I),PHIW(I),PW(I),SW(I)                      PUTIN     228
 2800 WRITE (6,620) I,XW(I),RW(I),PHIW(I),PW(I),SW(I)                    PUTIN     229
      GO TO 3700                                                         PUTIN     230
 2801 READ (9,200) XW(1),RW(1),XW(2),RW(2)                               PUTIN     231
 3700 SWA=0.0                                                            PUTIN     232
      M=1                                                                PUTIN     233
      PWSH=PW(M)                                                         PUTIN     234
      IPHIW=PHIW(M)                                                      PUTIN     235
      IF(IPHIW   ) 3900,3800,3900                                        PUTIN     236
 3800 PHIW(M)=PHI(M)                                                     PUTIN     237
 3900 M=M+1                                                              PUTIN     238
      IPHIW=PHIW(M)                                                      PUTIN     239
      IF(IPHIW   ) 4300,4000,4300                                        PUTIN     240
 4000 IF (M-MMAX) 4100,4200,4200                                         PUTIN     241
 4100 PHIW(M)=ATAN((RW(M+1)-RW(M-1))/(XW(M+1)-XW(M-1)))                  PUTIN     242
      GO TO 4300                                                         PUTIN     243
 4200 PHIW(M)=2.0*ATAN((RW(M)-RW(M-1))/(XW(M)-XW(M-1)))                  PUTIN     244
      PHIW(M)=PHIW(M)-PHIW(M-1)                                          PUTIN     245
 4300 ISW=SW(M)                                                          PUTIN     246
      IF(ISW   ) 4800,4400,4800                                          PUTIN     247
 4400 FKW=(SIN(PHIW(M))-SIN(PHIW(M-1)))/(XW(M)-XW(M-1))                  PUTIN     248
      IF (ABS(FKW/(XW(M)-XW(M-1)))-1.E-06) 4600,4600,4500                PUTIN     249
 4500 DELSWA=(PHIW(M)-PHIW(M-1))/FKW                                     PUTIN     250
      GO TO 4700                                                         PUTIN     251
 4600 DELSWA=SQRT((XW(M)-XW(M-1))**2+(RW(M)-RW(M-1))**2)                 PUTIN     252
 4700 SWA=SWA+DELSWA                                                     PUTIN     253
      SW(M)=SWA                                                          PUTIN     254
 4800 IF (M-MMAX) 3900,4900,4900                                         PUTIN     255
 4900 IF (IKI.NE.0) GO TO 4901                                           PUTIN     256
      WRITE (6,623)                                                      PUTIN     257
      DO 5000 N=1,NMAX                                                   PUTIN     258
      READ (5,200) XB(N),RB(N),PHIB(N),PB(N),SB(N)                       PUTIN     259
 5000 WRITE (6,620) N,XB(N),RB(N),PHIB(N),PB(N),SB(N)                    PUTIN     260
      GO TO 5700                                                         PUTIN     261
 4901 READ (9,200) XB(1),RB(1),XB(2),RB(2)                               PUTIN     262
 5700 SWA=0.0                                                            PUTIN     263
C     OUTER BOUNDARY CONDITIONS                                          PUTIN     264
      N=1                                                                PUTIN     265
      IPHIB=PHIB(N)                                                      PUTIN     266
      IF(IPHIB   ) 5900,5800,5900                                        PUTIN     267
 5800 PHIB(N)=PHI(KMAX)                                                  PUTIN     268
 5900 N=N+1                                                              PUTIN     269
      IPHIB=PHIB(N)                                                      PUTIN     270
      IF(IPHIB   ) 6300,6000,6300                                        PUTIN     271
 6000 IF (N-NMAX) 6100,6200,6200                                         PUTIN     272
 6100 PHIB(N)=ATAN((RB(N+1)-RB(N-1))/(XB(N+1)-XB(N-1)))                  PUTIN     273
      GO TO 6300                                                         PUTIN     274
 6200 PHIB(N)=2.0*ATAN((RB(N)-RB(N-1))/(XB(N)-XB(N-1)))                  PUTIN     275
      PHIB(N)=PHIB(N)-PHIB(N-1)                                          PUTIN     276
 6300 ISBQ=SB(N)                                                         PUTIN     277
      IF (ISBQ) 6750,6400,6750                                           PUTIN     278
 6400 FKW=(SIN(PHIB(N))-SIN(PHIB(N-1)))/(XB(N)-XB(N-1))                  PUTIN     279
      IF (ABS(FKW/(XB(N)-XB(N-1)))-1.E-06) 6600,6600,6500                PUTIN     280
 6500 DELSWA=(PHIB(N)-PHIB(N-1))/FKW                                     PUTIN     281
      GO TO 6700                                                         PUTIN     282
 6600 DELSWA=SQRT((XB(N)-XB(N-1))**2+(RB(N)-RB(N-1))**2)                 PUTIN     283
 6700 SWA=SWA+DELSWA                                                     PUTIN     284
      SB(N)=SWA                                                          PUTIN     285
 6750 IF (N-NMAX) 5900,6800,6800                                         PUTIN     286
 6800 IF (IKIND-3) 6905,6850,6850                                        PUTIN     287
C     CONDITIONS BEHIND OUTER SHOCK                                      PUTIN     288
 6850 CONTINUE                                                           PUTIN     289
      IF (IKI.EQ.0) READ(5,200) XSH,RSH,PSI,PSH,TSH,USH                  PUTIN     290
      IF(IKI.EQ.0) READ(5,1600)(CSH(I),I=1,NDS)                          PUTIN     291
      IF (IKI.NE.0) READ(9,200) XSH,RSH,PSI,PSH,TSH,USH                  PUTIN     292
      WRITE (6,624) XSH,RSH,PSI,PSH,TSH,USH                              PUTIN     293
      IF(IKI.NE.0) READ(9,1600)(CSH(I),I=1,NDS)                          PUTIN     294
 6900 FORMAT(8E10.3)                                                     PUTIN     295
      PBS=PSH                                                            PUTIN     296
C     EXTERNAL FLOW PROPERTIES AT FIRST SHOCK POINT                      PUTIN     297
 6901 READ (5,200) XSTREM,RSTREM,PHSTRM,PSTREM,TSTREM,USTREM             PUTIN     298
      WRITE (6,625) XSTREM,RSTREM,PHSTRM,PSTREM,TSTREM,USTREM            PUTIN     299
      IF (IROG.EQ.1.AND.IPART.EQ.0) GO TO 9700                           PUTIN     300
      READ (5,6900) (CSTREM(I),I=1,NDS)                                  PUTIN     301
      GO TO 6905                                                         PUTIN     302
 9700 NDD=NDS-1                                                          PUTIN     303
      READ(5,6900) (CSTREM(I),I=1,NDD)                                   PUTIN     304
      CSTREM(NDS)=0.                                                     PUTIN     305
 6905 IF (ITYPE-3) 7000,6910,6910                                        PUTIN     306
C     CONDITIONS BEHIND INNER SHOCK                                      PUTIN     307
 6910 CONTINUE                                                           PUTIN     308
      IF (IKI.EQ.0) READ (5,200) XSHW,RSHW,PSIW,PSHW,TSHW,USHW           PUTIN     309
      IF (IKI.EQ.0) READ(5,1600) (CSHW(I),I=1,NDS)                       PUTIN     310
      IF (IKI.NE.0) READ (9,200) XSHW,RSHW,PSIW,PSHW,TSHW,USHW           PUTIN     311
      WRITE (6,626) XSHW,RSHW,PSIW,PSHW,TSHW,USHW                        PUTIN     312
      IF (IKI.NE.0) READ(9,1600) (CSHW(I),I=1,NDS)                       PUTIN     313
      EXTRA(11)=PSHW                                                     PUTIN     314
 7000 IF (ITYPE-3)10000,7300,7300                                        PUTIN     315
 7300 CONTINUE                                                           PUTIN     316
      IF (IKI.EQ.0) READ(5,200) XOO,ROO,PHOO,POO,TOO,UOO                 PUTIN     317
      IF (IKI.EQ.0) READ(5,1600) (COO(I),I=1,NDS)                        PUTIN     318
      IF (IKI.NE.0) READ(9,200) XOO,ROO,PHOO,POO,TOO,UOO                 PUTIN     319
      WRITE (6,627) XOO,ROO,PHOO,POO,TOO,UOO                             PUTIN     320
      IF (IKI.NE.0) READ(9,1600) (COO(I),I=1,NDS)                        PUTIN     321
      PBS=PSH                                                            PUTIN     322
      GO TO 10000                                                        PUTIN     323
 8000 WRITE (6,619)                                                      PUTIN     324
      FMAX=1.0                                                           PUTIN     325
      KAY=0.0                                                            PUTIN     326
      Y(1)=0.0                                                           PUTIN     327
      IF (ISB.EQ.2) GO TO 550                                            PUTIN     328
      READ(4,203)(C(I,2),I=1,NDS)                                        PUTIN     329
      READ(4,202)X(1),R(2),PSTREM,TSTREM,USTREM,PHSTRM                   PUTIN     330
      READ(4,203)(CSTREM(I),I=1,NDS)                                     PUTIN     331
      READ(4,204)THTP,PHI(2),P(2),T(2),U(2),PSI,PSH,TSH,USH              PUTIN     332
202   FORMAT(6E12.5)                                                     PUTIN     333
203   FORMAT(1E10.3)                                                     PUTIN     334
  204 FORMAT(9E12.5)                                                     PUTIN     335
      PHI(1)=0.0                                                         PUTIN     336
      R  (1)=0.0                                                         PUTIN     337
      X(2)=X(1)                                                          PUTIN     338
      XSTREM=X(1)                                                        PUTIN     339
      RSTREM=R(2)                                                        PUTIN     340
      XSH=X(1)                                                           PUTIN     341
      RSH=R(2)                                                           PUTIN     342
      PHIO=PHI(2)                                                        PUTIN     343
      DO 290 I=1,NDS                                                     PUTIN     344
  290 CSH(I)=CSTREM(I)                                                   PUTIN     345
      GO TO 560                                                          PUTIN     346
  550 READ (5,200) X(1),R(1),PHI(1)                                      PUTIN     347
      READ (5,200) X(2),R(2),PHI(2),P(2),T(2),U(2)                       PUTIN     348
      READ (5,1600) (C(I,2),I=1,NDS)                                     PUTIN     349
      READ (5,1600) (CSTREM(I),I=1,NDS)                                  PUTIN     350
      READ(5,200) XSTREM,RSTREM,PHSTRM,PSTREM,TSTREM,USTREM              PUTIN     351
      READ (5,200) XSH,RSH,PSI,PSH,TSH,USH                               PUTIN     352
      READ (5,1600) (CSH(I),I=1,NDS)                                     PUTIN     353
  560 R(KMN)=RSTREM                                                      PUTIN     354
      RMD=RSTREM                                                         PUTIN     355
      MASSMD=0.0                                                         PUTIN     356
      DR21=R(KMN)/(KMN-1)                                                PUTIN     357
      DO 8001 K=2,KMN                                                    PUTIN     358
      R(K)=R(K-1)+DR21                                                   PUTIN     359
      X(K)=XSTREM                                                        PUTIN     360
      B=SQRT((X(K)-X(K-1))**2+(R(K)-R(K-1))**2)                          PUTIN     361
      DELY(K)=B                                                          PUTIN     362
      AA(K)=PI*(R(K)+R(K-1))**DELTA*DELY(K)                              PUTIN     363
      Y(K)=Y(K-1)+DELY(K)                                                PUTIN     364
      P(K)=P(2)                                                          PUTIN     365
      T(K)=T(2)                                                          PUTIN     366
      U(K)=U(2)                                                          PUTIN     367
      WRITE (6,620) K,X(K),R(K), PHI(K),P(K),T(K),U(K)                   PUTIN     368
      ZMW=0.0                                                            PUTIN     369
      DO 8002 I=1,NDS                                                    PUTIN     370
      C(I,K)=C(I,2)                                                      PUTIN     371
 8002 ZMW=ZMW+C(I,K)/MW(I)                                               PUTIN     372
      ZMW=1.0/ZMW                                                        PUTIN     373
      ZMWK(K)=ZMW                                                        PUTIN     374
      RHO(K)=ZMW*P(K)/(RV*T(K))                                          PUTIN     375
      MDOT(K)=RHO(K)*U(K)*AA(K)                                          PUTIN     376
      MASSMD=MASSMD+MDOT(K)                                              PUTIN     377
      H(K)=0.0                                                           PUTIN     378
      DO 8500 I=1,NDS                                                    PUTIN     379
      DO 8500 J=1,NN                                                     PUTIN     380
 8500 H(K)=H(K)+A(I,J)*C(I,K)*T(K)**(J-2)                                PUTIN     381
 8001 CONTINUE                                                           PUTIN     382
 8509 WRITE (6,624) XSH,RSH,PSI,PSH,TSH,USH                              PUTIN     383
      WRITE (6,625) XSTREM,RSTREM,PHSTRM,PSTREM,TSTREM,USTREM            PUTIN     384
      PBS=PSH                                                            PUTIN     385
      KXX=KMN+1                                                          PUTIN     386
      KXXX=KMN+2                                                         PUTIN     387
      DO 8004    K=KXX,KXXX                                              PUTIN     388
      ZMW=0.0                                                            PUTIN     389
      DO 8012 I=1,NDS                                                    PUTIN     390
      C(I,K)=CSH(I)                                                      PUTIN     391
 8012 ZMW=ZMW+C(I,K)/MW(I)                                               PUTIN     392
      ZMW=1.0/ZMW                                                        PUTIN     393
      ZMWK(K)=ZMW                                                        PUTIN     394
      P(K)=PSH                                                           PUTIN     395
      T(K)=TSH                                                           PUTIN     396
      U(K)=USH                                                           PUTIN     397
      RHO(K)=ZMW*P(K)/(RV*T(K))                                          PUTIN     398
      H(K)=0.0                                                           PUTIN     399
      DO 8600 I=1,NDS                                                    PUTIN     400
      DO 8600 J=1,NN                                                     PUTIN     401
 8600 H(K)=H(K)+A(I,J)*C(I,K)*T(K)**(J-2)                                PUTIN     402
 8004 CONTINUE                                                           PUTIN     403
C                                                                        PUTIN     404
C     CALCULATING SIGNIFICENT DIVIDING STREAMLINE DIMENSIONS-L1 AND L2   PUTIN     405
C                                                                        PUTIN     406
      L2=130.*RMD/(THTP*57.3)**1.55                                      PUTIN     407
      L2=PAR(4)*L2                                                       11AUG      58
      L1=0.264*L2/(RMD/RNOZ)**0.37                                       PUTIN     408
      L1=PAR(5)*L1                                                       11AUG      59
      DDIS=0.02*L1                                                       PUTIN     409
      RDSLP=RMD+TAN(PHIO)*DDIS*(1.0-(DDIS/2./L1))                        PUTIN     410
      PHDSLP=ATAN(TAN(PHIO)*(1.0-DDIS/L1))                               PUTIN     411
      XINIT=XSH                                                          PUTIN     412
      XDIS=XSH+DDIS                                                      PUTIN     413
      X(1)=XDIS                                                          PUTIN     414
      DO 8010 K=2,KMN                                                    PUTIN     415
      R(K)=RDSLP                                                         PUTIN     416
      DELY(K)=R (K)-R (K-1)                                              PUTIN     417
      X(K)=XDIS                                                          PUTIN     418
      Y(K)=Y(K-1)+DELY(K)                                                PUTIN     419
      DO 8100 I=1,NDS                                                    PUTIN     420
 8100 XS(I,K)=C(I,K)*ZMW/MW(I)                                           PUTIN     421
      DO 8404 I=1,NDS                                                    PUTIN     422
      CPS(I)=0.0                                                         PUTIN     423
      DO 8404 J=1,NN                                                     PUTIN     424
 8404 CPS(I)=CPS(I)+FLOAT(J-2)*A(I,J)*T(K)**(J-3)                        PUTIN     425
      CP=0.0                                                             PUTIN     426
      DO 8810 I=1,NDS                                                    PUTIN     427
 8810 CP=CP+CPS(I)*C(I,K)                                                PUTIN     428
      RE(K)=RHO(K)*U(K)*DELY(K)/(MU*FMAX)                                PUTIN     429
      MA(K)=U(K)*SQRT((CP*ZMW-RCON)/(CP*T(K)*RU))                        PUTIN     430
      GAMA=CP/(CP-RCON/ZMW )                                             PUTIN     431
      PQ= 4.0*GAMA/(9.*GAMA-5.0)                                         PUTIN     432
      PHI(K)=PHDSLP                                                      PUTIN     433
      IF(K.GT.2) GO TO 8010                                              PUTIN     434
C                                                                        PUTIN     435
C     CALCULATING TROAT RADIUS FROM MASS FLOW THRU MACH DISC-            PUTIN     436
C    1   ASSUMUNG CONSTANT GAMMA                                         PUTIN     437
C                                                                        PUTIN     438
      FACTOR=(1.+(GAMA-1.)*0.5*MA(2)**2)                                 PUTIN     439
      PSTG=P(2)*FACTOR**(GAMA/(GAMA-1.0))                                PUTIN     440
      TSTG=T(2)*FACTOR                                                   PUTIN     441
      RUG1=(2.0/(GAMA+1.0))**((GAMA+1.0)/(GAMA-1.0))                     PUTIN     442
      RUG2=SQRT(GAMA*ZMWK(K)*RUG1*BETAP/RV)                              PUTIN     443
      ASTAR=MASSMD*SQRT(TSTG)/RUG2/PSTG                                  PUTIN     444
      RSTAR=SQRT(ASTAR/PI)                                               PUTIN     445
      RSTAR=PAR(9)*RSTAR                                                 11AUG      60
      WRITE(6,800) MASSMD,RSTAR,L2,L1,RNOZ,RMD                           PUTIN     446
  800 FORMAT(/5X,*MASS FLOW THRU MACH DISC=*,1PE10.3,* GM/SEC*/5X,*THROA PUTIN     447
     1T RADIUS =*,1PE10.3,* CM*,/5X,*DISTANCE FROM MACH DISC TO THROAT   PUTIN     448
     2=*,1PE10.3,* CM*/5X,*DISTANCE TO DSL MAXIMUM =*,1PE10.3,* CM*      PUTIN     449
     3/5X,*NOZZLE EXIT RADIUS =*,1PE10.3,* CM*/5X,*MACH DISC RADIUS=     PUTIN     450
     4*,1PE10.3,* CM*/)                                                  PUTIN     451
      ZAAA=XINIT/RNOZ                                                    11AUG      61
      ZBBB=RMD/RNOZ                                                      11AUG      62
      WRITE(11) ZAAA,ZBBB                                                11AUG      63
 8010 CONTINUE                                                           PUTIN     452
      AAA=TAN(PSI)                                                       PUTIN     453
      BBB=RMD-XSH*TAN(PSI)                                               PUTIN     454
      CCC=-TAN(PI/2.-PHDSLP)                                             PUTIN     455
      DDD=RDSLP-XDIS*CCC                                                 PUTIN     456
      XSH=-(BBB-DDD)/(AAA-CCC)                                           PUTIN     457
      RSH=AAA*XSH+BBB                                                    PUTIN     458
      NSUPER=KXXX-KXX+1                                                  PUTIN     459
      DELR=(RSH-RDSLP)/NSUPER                                            PUTIN     460
      DELX=(XDIS-XSH)/NSUPER                                             PUTIN     461
      DO 8011 K=KXX,KXXX                                                 PUTIN     462
      R(K)=R(K-1)+DELR                                                   PUTIN     463
      X(K)=X(K-1)-DELX                                                   PUTIN     464
      DELY(K)=SQRT((X(K)-X(K-1))**2+(R(K)-R(K-1))**2)                    PUTIN     465
      Y(K)=Y(K-1)+DELY(K)                                                PUTIN     466
      PHI(K)=PHDSLP                                                      PUTIN     467
      AA(K)=PI*(R(K)+R(K-1))**DELTA*DELY(K)                              PUTIN     468
      DO 8200 I=1,NDS                                                    PUTIN     469
 8200 XS(I,K)=C(I,K)*ZMW/MW(I)                                           PUTIN     470
      MDOT(K)=RHO(K)*U(K)*AA(K)                                          PUTIN     471
      DO 8504 I=1,NDS                                                    PUTIN     472
      CPS(I)=0.0                                                         PUTIN     473
      DO 8504 J=1,NN                                                     PUTIN     474
 8504 CPS(I)=CPS(I)+FLOAT(J-2)*A(I,J)*T(K)**(J-3)                        PUTIN     475
      CP=0.0                                                             PUTIN     476
      DO 8910 I=1,NDS                                                    PUTIN     477
 8910 CP=CP+CPS(I)*C(I,K)                                                PUTIN     478
      RE(K)=RHO(K)*U(K)*DELY(K)/(MU*FMAX)                                PUTIN     479
      MA(K)=U(K)*SQRT((CP*ZMW-RCON)/(CP*T(K)*RU))                        PUTIN     480
      GAMA=CP/(CP-RCON/ZMW )                                             PUTIN     481
      PQ= 4.0*GAMA/(9.*GAMA-5.0)                                         PUTIN     482
 8011 CONTINUE                                                           PUTIN     483
      XW(1)=XDIS                                                         PUTIN     484
      XW(2)=1.E8                                                         PUTIN     485
      RW(1)=0.0                                                          PUTIN     486
      RW(2)=0.0                                                          PUTIN     487
      RB(1)=R(KMAX)                                                      PUTIN     488
      RB(2)=R(KMAX)                                                      PUTIN     489
      XB(1)=X(KMAX)                                                      PUTIN     490
      XB(2)=X(KMAX)+0.01                                                 PUTIN     491
      Y0=Y(KMAX)                                                         PUTIN     492
      SW(1)=0.0                                                          PUTIN     493
      SW(2)=1.E8                                                         PUTIN     494
      PHIW(1)=0.0                                                        PUTIN     495
      PHIW(2)=0.0                                                        PUTIN     496
      SB(1)=0.0                                                          PUTIN     497
      SB(2)=1.E-2                                                        PUTIN     498
      PHIB(1)= PHI(KMAX)                                                 PUTIN     499
C     CARD OMITTED                                                       PUTIN     500
      K=KXXX                                                             PUTIN     501
      XSH=X(K)                                                           PUTIN     502
      RSH=R(K)                                                           PUTIN     503
      XSTREM=X(K)                                                        PUTIN     504
      RSTREM=R(K)                                                        PUTIN     505
      WRITE(6,801) XSH,RSH,XSTREM,RSTREM                                 PUTIN     506
  801 FORMAT(/5X,*REVISED INITIAL SHOCK AND STREAM COORDINATES ARE-      PUTIN     507
     1 XSH=*,1PE10.3,* RSH=*,1PE10.3,* XSTREM=*,1PE10.3,* RSTREM=*,      PUTIN     508
     21PE10.3,/)                                                         PUTIN     509
10000 CALL PUTOUT(1)                                                     PUTIN     510
  610 FORMAT (1H ,/5X, 4HKMAX,4X,2HNN,6X,2HKP,6X,2HIP,6X,5HITYPE,3X,     PUTIN     511
     * 5HIKIND,3X,4HMMAX,4X,4HNMAX,4X,3HNDS,5X,3HIPD,5X,5HNITER,3X,      PUTIN     512
     1   5HIDIFF,4X,6HLPLANE,   /5X,13(I5,3X),/5X,5HIPTUC,3X,4HIPCH,4X,  21OCT       4
     2 6HISHOCK,2X,6HIBUGSH,2X,3HITD,5X,4HICSH,4X,6HITAPES,2X,5HIKINE,   PUTIN     514
     3  3X,5HIPART,3X,3HIKI,5X,5HITURB,3X,4HIPTO,5X,3HISB,5X,3HKMN,5X,   PUTIN     515
     4   4HKMNF,/5X,15(I5,3X))                                           21OCT       5
  612 FORMAT (1H ,/5X,6HALPHAH,4X,6HEPSLON,4X,3HTOL,7X,5HDELTA,5X,       PUTIN     517
     *   4HATOL,6X,  5HFSTEP,5X,                                         PUTIN     518
     1 4HGRAD,6X,4HFRAC,6X,6HFRACTN,/3X,9(F8.4,2X))                      PUTIN     519
  613 FORMAT (1H,/5X,2HI=,8X,6HALFTD=,9X,5HDEXP=)                        PUTIN     520
  615 FORMAT (5X,I5,5X,1PE10.3,5X,E10.3)                                 PUTIN     521
  616 FORMAT (1H , /5X,5HIDENT,10X,3HMUO,12X,2HTO,12X,5HOMEGA,10X,2HPR,1 PUTIN     522
     13X,2HSC,13X,2HMW)                                                  PUTIN     523
  617 FORMAT (5X,A4,9X,6(1PE10.3,5X))                                    PUTIN     524
  618 FORMAT(1H ,/5X,22HVISCOUS OPTION VALUES%,5X,4HTLE=,1PE10.3,5X,     PUTIN     525
     * 4HTPR=,E10.3,5X,6HEDDYK=,E10.3,5X,6HPERGF=,E10.3)                 PUTIN     526
  619 FORMAT (1H ,/2X,1HK,2X,1HX,14X,1HR,14X,3HPHI,12X,1HP,14X,          PUTIN     527
     1 1HT,14X,1HU)                                                      PUTIN     528
  620 FORMAT (1H ,1X,I2,1X, 6(1PE10.3,5X))                               PUTIN     529
  621 FORMAT (1H ,/2X,1HI,2X,2HXW,13X,2HRW,13X,4HPHIW,11X,2HPW,13X,      PUTIN     530
     1  2HSW)                                                            PUTIN     531
  623 FORMAT (1H ,/2X,1HN,2X,2HXB,13X,2HRB,13X,4HPHIB,11X,2HPB,13X,2HSB) PUTIN     532
  624 FORMAT (1H ,/5X,4HXSH=,1PE10.3,6X,4HRSH=,E10.3,6X,4HPSI=,E10.3,6X  PUTIN     533
     *  , 4HPSH=,E10.3,6X,4HTSH=,E10.3,6X,4HUSH=,E10.3)                  PUTIN     534
  625 FORMAT (1H ,/5X,7HXSTRM=,1PE10.3,3X,7HRSTREM=,E10.3,3X,7HPHSTRM=,  PUTIN     535
     *  E10.3,3X,7HPSTREM=,E10.3,3X,7HTSTREM=,E10.3,3X,7HUSTREM=,E10.3)  PUTIN     536
  626 FORMAT (1H ,/5X,5HXSHW=,1PE10.3,5X,5HRSHW=,E10.3,5X,5HPSIW=,E10.3, PUTIN     537
     1  5X,5HPSHW=,E10.3,5X,5HTSHW=,E10.3,5X,5HUSHW=,E10.3)              PUTIN     538
  627 FORMAT (1H ,/5X,4HXOO=,1PE10.3,6X,4HROO=,E10.3,6X,5HPHOO=,E10.3,   PUTIN     539
     *  5X,4HPOO=,E10.3,6X,4HTOO=,E10.3,6X,4HUOO=,E10.3)                 PUTIN     540
      RETURN                                                             PUTIN     541
      END                                                                PUTIN     542
      SUBROUTINE PUTOUT(IOUT)                                            PUTOUT      2
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    PUTOUT      4
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         PUTOUT      5
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        PUTOUT      6
     * ,      MAP                                                        PUTOUT      7
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  PUTOUT      8
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          PUTOUT      9
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      PUTOUT     10
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       PUTOUT     11
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    PUTOUT     12
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      PUTOUT     13
     1 ,SUMP,SUMPV,SUMPE                                                 PUTOUT     14
      COMMON/CHEM1/ ZID(5), IRR(30),IRT(30),RC(30,3),IRRR(30,5),         PUTOUT     15
     1 AV,CM(21,21),FI(21),WP(21),                                       PUTOUT     16
     2 WM(21),WDOT(21,30),CSI(21),QX(21)                                 PUTOUT     17
      COMMON/SHOPUT/ XSHW,RSHW,PSIW,PSHW,TSHW,USHW,CSHW(20)              PUTOUT     18
      COMMON/CFF/IPTO                                                    PUTOUT     19
      COMMON/INTL/XLX,IKI,REX                                            11AUG      64
      COMMON/SUB/XDIS,L1,L2,PHIO,RSTAR,RMD,MASSMD,RNOZ,THTP,THRU         11AUG      65
      DIMENSION SUMI(24),SLMD(20)                                        11AUG      66
      REAL LMD(20,30)                                                    11AUG      67
      DATA IQ1/4HCO  /                                                   PUTOUT     21
      DATA IQ2/4HCO2 /                                                   PUTOUT     22
      DATA IQ3/4HH2O /                                                   PUTOUT     23
      DATA IQ4/4HHCL /                                                   PUTOUT     24
      DATA IQ5/4HN2  /                                                   PUTOUT     25
      DATA IQ6/4HH2  /                                                   PUTOUT     26
      DATA IQ7/4HE   /                                                   PUTOUT     27
      GO TO (50,1300,10), IOUT                                           PUTOUT     28
   10 L=K                                                                PUTOUT     29
      GO TO 250                                                          PUTOUT     30
   50 L=1                                                                PUTOUT     31
      SUMDOT=0.0                                                         PUTOUT     32
      DO 75 I=1,NDS                                                      PUTOUT     33
   75 SUMI(I)=0.0                                                        PUTOUT     34
      WRITE (6,100) LL,X2(L),R2(L),PHI2(L)                               PUTOUT     35
  100 FORMAT ( 1H0,I5,8X,3HXW=,   E11.4,3X,3HRW=,   E11.4,3X,5HPHIW=,    PUTOUT     36
     *E11.4)                                                             PUTOUT     37
      IF ((ISB.NE.-1).OR.(X2(1).LT.XLMD)) GO TO 135                      11AUG      68
      ZZZ=X2(1)/RNOZ                                                     11AUG      69
      WRITE(12) ZZZ,K                                                    11AUG      70
  135 CONTINUE                                                           11AUG      71
      L=2                                                                PUTOUT     38
  250 IF(LL) 225,260,260                                                 PUTOUT     39
  225 WRITE(6,300) L,X(L),R(L),PHI(L),T(L),P(L),U(L)                     PUTOUT     40
      XL=X(L)/RNOZ                                                       11AUG      72
      RL=R(L)/RNOZ                                                       11AUG      73
      GO TO 325                                                          PUTOUT     41
  260 WRITE (6,300) L,X2(L),R2(L),PHI2(L),T2(L),P2(L),U2(L)              PUTOUT     42
      XL=X2(L)/RNOZ                                                      11AUG      74
      RL=R2(L)/RNOZ                                                      11AUG      75
  300 FORMAT(1H0,5X,I5,3X,2HX=,1P1E11.4,4X,2HR=,1P1E11.4,4X,4HPHI=,1P1E1 PUTOUT     43
     *1.4,2X,2HT=,1P1E11.4,4X,2HP=,1P1E11.4,4X,2HU=,1P1E11.4)            PUTOUT     44
  325 HTK=H(L)+U(L)**2/(2.0*HJ)                                          PUTOUT     45
      PTK=P(L)+RHO(L)*U(L)**2/(2.0*BETAP)                                PUTOUT     46
      SUMDOT=SUMDOT+MDOT(L)                                              PUTOUT     47
  375 IF(LL) 350,380,380                                                 PUTOUT     48
  350 WRITE (6,400) MA(L),DELY(L),H(L),HTK,TAW(L),Q(L),PTK,RHO(L),SX(L)  PUTOUT     49
     *,SUMDOT,XL,RL                                                      11AUG      76
  400 FORMAT(14X,3HMA=,   E11.4,3X,5HDELY=,   E11.4,1X,2HH=,   E11.4,4X, PUTOUT     51
     *3HHT=,   E11.4,3X,4HTAW=,   E11.4,2X,2HQ=,   E11.4 / 14X,3HPT=,    PUTOUT     52
     *E11.4,3X,4HRHO=,   E11.4,2X,3HSX=,   E11.4,3X,7HSUMDOT=,   E11.4   PUTOUT     53
     *,2X,6HX/REX=,F6.2,2X,6HR/REX=,F6.2)                                11AUG      77
      GO TO 410                                                          PUTOUT     55
  380 WRITE (6,400) MA(L),DELY(L),H(L),HTK,TAW(L),Q(L),PTK,RHO2(L),SX(L) PUTOUT     56
     *,SUMDOT,XL,RL                                                      11AUG      78
  410 WRITE (6,1000)                                                     PUTOUT     58
 1000 FORMAT(1H0)                                                        PUTOUT     59
      IF (NDS-1) 450,450,1050                                            PUTOUT     60
 1050 DO 1299 I=1,NDS                                                    PUTOUT     61
      IF (IEXTRA(1)) 1120,1110,1120                                      PUTOUT     62
 1110 IF (LL) 1105,1115,1115                                             PUTOUT     63
 1105 LMD(I,L)=MDOT(L)*C(I,L)/U(L)                                       11AUG      79
      WRITE(6,1200) IDENT(I),C(I,L),XS(I,L),WDOT(I,L),LMD(I,L)           11AUG      80
      GO TO 1299                                                         PUTOUT     65
 1115 LMD(I,L)=MDOT(L)*C(I,L)/U2(L)                                      11AUG      81
      WRITE(6,1200) IDENT(I),C2(I,L),XS(I,L),WDOT(I,L),LMD(I,L)          11AUG      82
 1200 FORMAT(14X,6HSPECIE,2X, A4,7X,2HC=,   E11.4,4X,2HX=,   E11.4,4X,   PUTOUT     67
     *5HWDOT=,E11.4,4X,4HLMD=,E11.4)                                     11AUG      83
      GO TO 1299                                                         PUTOUT     69
 1120 SUMI(I)=SUMI(I)+MDOT(L)*C(I,L)                                     PUTOUT     70
 1150 IF (LL) 1125,1160,1160                                             PUTOUT     71
 1125 LMD(I,L)=MDOT(L)*C(I,L)/U(L)                                       11AUG      84
      WRITE(6,1225) IDENT(I),C(I,L),XS(I,L),WDOT(I,L),SUMI(I),           11AUG      85
     *ZJ(I,L),LMD(I,L)                                                   11AUG      86
 1225 FORMAT(14X,6HSPECIE,1X,A4,2X,2HC=,1P1E11.4,3X,2HX=,1P1E11.4,3X,    11AUG      87
     *5HWDOT=,E11.4,3X,3HF1=,1P1E11.4,3X,3HZJ=,1P1E11.4,3X,4HLMD=,       11AUG      88
     *1P1E11.4)                                                          11AUG      89
      GO TO 1299                                                         PUTOUT     76
 1160 LMD(I,L)=MDOT(L)*C(I,L)/U2(L)                                      11AUG      90
      WRITE(6,1225) IDENT(I),C2(I,L),XS(I,L),WDOT(I,L),SUMI(I),ZJ(I,L),  11AUG      91
     *LMD(I,L)                                                           11AUG      92
 1299 CONTINUE                                                           PUTOUT     78
      IF ((ISB.NE.-1).OR.(X2(1).LT.XLMD)) GO TO 130                      11AUG      93
      ZZZ=R2(L)/RNOZ                                                     11AUG      94
      WRITE(12) ZZZ,LMD(3,L),LMD(13,L)                                   11AUG      95
  130 CONTINUE                                                           11AUG      96
  450 IF (IPTO .EQ. 0) GO TO 457                                         PUTOUT     79
      XL=X2(L)/REX                                                       PUTOUT     80
      RL=R2(L)/REX                                                       PUTOUT     81
      IZ2=25                                                             PUTOUT     82
      IZ3=25                                                             PUTOUT     83
      IZ4=25                                                             PUTOUT     84
      IZ5=25                                                             PUTOUT     85
      IZ6=25                                                             PUTOUT     86
      IZ7=25                                                             PUTOUT     87
      DO 60 J=1,NDS                                                      PUTOUT     88
      IF (IDENT(J) .EQ. IQ1) IZ1=J                                       PUTOUT     89
      IF (IDENT(J) .EQ. IQ2) IZ2=J                                       PUTOUT     90
      IF (IDENT(J) .EQ. IQ3) IZ3=J                                       PUTOUT     91
      IF (IDENT(J) .EQ. IQ4) IZ4=J                                       PUTOUT     92
      IF (IDENT(J) .EQ. IQ5) IZ5=J                                       PUTOUT     93
      IF (IDENT(J) .EQ. IQ6) IZ6=J                                       PUTOUT     94
      IF (IDENT(J) .EQ. IQ7) IZ7=J                                       PUTOUT     95
   60 CONTINUE                                                           PUTOUT     96
      ENE=0.733E22*P2(L)/T2(L)*C2(IZ7,L)                                 PUTOUT     97
      VEE=6.21E5*SQRT(T(L))                                              PUTOUT     98
      SMQ=C2(IZ1,L)*(2.08E-23*VEE+2.46E-16)+C2(IZ2,L)*4.7E-8/VEE+C2(IZ3, PUTOUT     99
     1L)*5.9/(VEE**2)+C2(IZ4,L)*1.85/(VEE*VEE)+C2(IZ5,L)*3.29E-23*VEE+   PUTOUT    100
     2C2(IZ6,L)*(1.45E-23*VEE+8.9E-16)                                   PUTOUT    101
      ENUE=4.57E27*P2(L)/SQRT(T2(L))*SMQ                                 PUTOUT    102
      SGM=7.14549E-4*ENE/ENUE                                            PUTOUT    103
      IF(IPTO.GT.4) GO TO 61                                             PUTOUT    104
      WRITE (6,1400) XL,RL,ENE,ENUE,SGM                                  PUTOUT    105
 1400 FORMAT (2X,6HX/REX=,1PE11.4,5X,6HR/REX=,E11.4,5X,3HNE=,E11.4,5X,   PUTOUT    106
     1 4HNUE=,E11.4,5X,6HSIGMA=,E11.4)                                   PUTOUT    107
      IF (IPTO .EQ. 1 .OR. IPTO .EQ. 3)                                  PUTOUT    108
     1WRITE (7,1600) XL,RL,ENE,ENUE,SGM                                  PUTOUT    109
 1600 FORMAT (4E19.12/3E19.12)                                           PUTOUT    110
      IF (IPTO .EQ. 2 .OR. IPTO .EQ. 4)                                  PUTOUT    111
     1WRITE (8,1601) XL,RL,ENE,ENUE,SGM                                  PUTOUT    112
 1601 FORMAT (7E19.12)                                                   PUTOUT    113
   61 WRITE (6,1500)XL,RL,T2(L),P2(L),XS(IZ2,L),XS(IZ3,L),XS(IZ1,L)      PUTOUT    114
 1500 FORMAT (5X,6HX/REX=,1PE11.4,5X,6HR/REX=,E11.4,9X,2HT=,E11.4,9X,    PUTOUT    115
     1 2HP=,E11.4/10X,6H(CO2)=,E11.4,6X,6H(H2O)=,E11.4,7X,5H(CO)=,E11.4) PUTOUT    116
      IF (IPTO .EQ. 5 .OR. IPTO .EQ. 3)                                  PUTOUT    117
     1WRITE (7,1600) XL,RL,T2(L),P2(L),XS(IZ2,L),XS(IZ3,L),XS(IZ1,L)     PUTOUT    118
      IF (IPTO .EQ. 6 .OR. IPTO .EQ.3)                                   PUTOUT    119
     1WRITE (8,1601) XL,RL,T2(L),P2(L),XS(IZ2,L),XS(IZ3,L),XS(IZ1,L)     PUTOUT    120
  457 IF (L-K) 500,700,700                                               11AUG      97
  500 L=L+1                                                              PUTOUT    122
      GO TO 250                                                          PUTOUT    123
  700 IF (ISB.NE.1) GO TO 600                                            11AUG      98
      IF (NDS-1) 600,600,610                                             11AUG      99
  610 DO 800 I=1,NDS                                                     11AUG     100
  800 SLMD(I)=0.0                                                        11AUG     101
      DO 810 I=1,NDS                                                     11AUG     102
      DO 810 L=2,K                                                       11AUG     103
  810 SLMD(I)=SLMD(I)+LMD(I,L)                                           11AUG     104
      WRITE(6,815)                                                       11AUG     105
  815 FORMAT(1H0,13X,27HTOTAL LINEAR MASS DENSITIES)                     11AUG     106
      WRITE(6,1000)                                                      11AUG     107
      DO 820 I=1,NDS                                                     11AUG     108
  820 WRITE(6,850) IDENT(I),SLMD(I)                                      11AUG     109
  850 FORMAT(14X,6HSPECIE,1X,A4,2X,7HSUMLMD=,1P1E11.4)                   11AUG     110
      IF (LL.LE.10) GO TO 600                                            11AUG     111
      ZZZ=X2(1)/RNOZ                                                     11AUG     112
      XXX=R2(K)/RNOZ                                                     11AUG     113
      WRITE(13) ZZZ,XXX,SLMD(3),SLMD(13)                                 11AUG     114
      GO TO 600                                                          11AUG     115
 1300 IF (NBOUND) 1320,1310,1320                                         PUTOUT    124
 1310 K=1                                                                PUTOUT    125
      DELPHI=PHI(K)-PHISH1                                               PUTOUT    126
      WRITE (6,1401) LL,K,X2(K),R2(K),PHI2(K),PSIW,DELPHI                PUTOUT    127
      IF (ISB.NE.-1) GO TO 842                                           11AUG     116
      AAA=X2(K)/RNOZ                                                     11AUG     117
      BBB=R2(K)/RNOZ                                                     11AUG     118
      WRITE(11) AAA,BBB                                                  11AUG     119
  842 CONTINUE                                                           11AUG     120
      K=2                                                                PUTOUT    128
      GO TO 600                                                          PUTOUT    129
 1320 DELPHI=PHI(KMAX)-PHISH1                                            PUTOUT    130
      WRITE (6,1401) LL,KMAX,X(KMAX),R(KMAX),PHI(KMAX),PSI,DELPHI        PUTOUT    131
 1401 FORMAT (1H0,5HSHOCK,2X,3HLL=,I4,2X,2HK=,I2,2X,2HX=,1P1E11.4,2X,2HR PUTOUT    132
     *=,1P1E11.4,2X,4HPHI=,1P1E11.4,2X,4HPSI=,1P1E11.4,2X,7HDELPHI=,1P1E PUTOUT    133
     *11.4)                                                              PUTOUT    134
  600 RETURN                                                             PUTOUT    135
      END                                                                PUTOUT    136
      SUBROUTINE SHOCKE                                                  SHOCKE      2
C     THIS SUBROUTINE DOES THE SHOCK CALCULATION                         SHOCKE      3
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    SHOCKE      5
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         SHOCKE      6
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        SHOCKE      7
     * ,      MAP                                                        SHOCKE      8
      COMMON/SHOPUT/ XSHW,RSHW,PSIW,PSHW,TSHW,USHW,CSHW(20)              SHOCKE      9
      COMMON/SHOSHO/X3SH,R3SH                                            SHOCKE     10
      COMMON/TURPLE/DEL2,CPSHW,GAMSHW,ZMWSH1                             SHOCKE     11
      COMMON/MAINSH/ KOUNT,KINT                                          SHOCKE     12
      EQUIVALENCE (PWSH,EXTRA(11))                                       SHOCKE     13
      DIMENSION SUMASB(25),CSH2(25),CSH3(25),SUMASW(25)                  SHOCKE     14
      DIMENSION G(2),DGD(2,2),XX(2)                                      SHOCKE     15
      FL=LL                                                              SHOCKE     16
      FPLANE=LPLANE                                                      SHOCKE     17
      FMULT=FL/FPLANE                                                    SHOCKE     18
      IF (ABS(EXTRA(4)).GT.1.0E-7) GO TO 5                               SHOCKE     19
      GSTEP=FSTEP                                                        SHOCKE     20
      GO TO 10                                                           SHOCKE     21
    5 GSTEP=FSTEP-(FSTEP-EXTRA(3))*(1.-FMULT)/EXTRA(4)                   SHOCKE     22
   10 IF (LL) 24,24,50                                                   SHOCKE     23
C     DETERMINING UPSTREAM PROPERTIES AT INITIAL SHOCK POINT             SHOCKE     24
   24 IF (IFLAG) 50,25,50                                                SHOCKE     25
   25 ZMB=0.0                                                            SHOCKE     26
      ROLD=RSHW                                                          SHOCKE     27
      GO TO (27,26,27,27,26), ISHOCK                                     SHOCKE     28
   26 IF (NBOUND) 265,27,265                                             SHOCKE     29
  265 NK=K                                                               SHOCKE     30
      K=KMAX                                                             SHOCKE     31
      R2SH=RSH                                                           SHOCKE     32
      X2SH=XSH                                                           SHOCKE     33
      CALL SHOPRO                                                        SHOCKE     34
      PHSTRM=PHISH1                                                      SHOCKE     35
      PSTREM = PSH1                                                      SHOCKE     36
      TSTREM=TSH1                                                        SHOCKE     37
      USTREM=USH1                                                        SHOCKE     38
      K=NK                                                               SHOCKE     39
   27 IF (IKIND-3) 305,305,28                                            SHOCKE     40
   28 CPB=0.0                                                            SHOCKE     41
      DO 30 I=1,NDS                                                      SHOCKE     42
      ZMB=ZMB+CSH(I)/MW(I)                                               SHOCKE     43
   30 CPB=CPB+CSH(I)*A(I,3)                                              SHOCKE     44
      ZMB=1.0/ZMB                                                        SHOCKE     45
      GBOLD=ZMB*PSTREM*USTREM/(RV*TSTREM)                                SHOCKE     46
      BMASUM=0.0                                                         SHOCKE     47
      DO 3001 I=1,NDS                                                    SHOCKE     48
      SUMASB(I)=0.                                                       SHOCKE     49
 3001 CSH2(I)=CSH(I)                                                     SHOCKE     50
      IF (ICONST) 302,301,302                                            SHOCKE     51
  301 FHBOLD=GBOLD*(CPB*TSTREM+USTREM**2/(2.0*HJ))                       SHOCKE     52
      GO TO 304                                                          SHOCKE     53
  302 FHBOLD=GBOLD*USTREM**2/(2.0*HJ)                                    SHOCKE     54
      DO 303 I=1,NDS                                                     SHOCKE     55
      DO 303 J=1,NN                                                      SHOCKE     56
  303 FHBOLD=FHBOLD+GBOLD*A(I,J)*CSH1(I)*TSTREM**(J-2)                   SHOCKE     57
  304 PHBOLD=PHSTRM                                                      SHOCKE     58
      ZWM=0.0                                                            SHOCKE     59
      IF (NBOUND) 50,305,50                                              SHOCKE     60
  305 IF (ISHOCK-4) 32,31,32                                             SHOCKE     61
   31 MK=K                                                               SHOCKE     62
      K=1                                                                SHOCKE     63
      R3SH=RSHW                                                          SHOCKE     64
      X3SH=XSHW                                                          SHOCKE     65
      CALL SHOPRO                                                        SHOCKE     66
      PHOO=PHISH1                                                        SHOCKE     67
      POO=PSH1                                                           SHOCKE     68
      TOO=TSH1                                                           SHOCKE     69
      UOO=USH1                                                           SHOCKE     70
      K=MK                                                               SHOCKE     71
   32 IF (ITYPE-2) 50,50,33                                              SHOCKE     72
   33 CPW=0.0                                                            SHOCKE     73
      DO 35 I=1,NDS                                                      SHOCKE     74
      ZWM=ZWM+CSHW(I)/MW(I)                                              SHOCKE     75
   35 CPW=CPW+CSHW(I)*A(I,3)                                             SHOCKE     76
      ZWM=1.0/ZWM                                                        SHOCKE     77
      GWOLD=ZWM*POO*UOO/(RV*TOO)                                         SHOCKE     78
      WMASUM=0.0                                                         SHOCKE     79
      WHSUM=0.0                                                          SHOCKE     80
      DO 351 I=1,NDS                                                     SHOCKE     81
      SUMASW(I)=0.                                                       SHOCKE     82
  351 CSH3(I)=CSHW(I)                                                    SHOCKE     83
      IF (ICONST) 42,40,42                                               SHOCKE     84
   40 FHWOLD=GWOLD*(CPW*TOO+UOO**2/(2.0*HJ))                             SHOCKE     85
      GO TO 46                                                           SHOCKE     86
   42 FHWOLD=GWOLD*UOO**2/(2.0*HJ)                                       SHOCKE     87
      DO 44 I=1,NDS                                                      SHOCKE     88
      DO 44 J=1,NN                                                       SHOCKE     89
   44 FHWOLD=FHWOLD+GWOLD*A(I,J)*CSH1(I)*TOO   **(J-2)                   SHOCKE     90
   46 PHWOLD=PHOO                                                        SHOCKE     91
C     LOCATING NEW SHOCK POINT                                           SHOCKE     92
   50 TPH2K=TAN(PHI2(K))                                                 SHOCKE     93
      IF (NBOUND) 100,200,100                                            SHOCKE     94
  100 TPSI=TAN(PSI)                                                      SHOCKE     95
      R2SH=(RSH-XSH*TPSI    +R2(K)*TPH2K       *TPSI    +X2(K)*TAN(PSI)) SHOCKE     96
     */(1.0+TPSI    *TPH2K)                                              SHOCKE     97
      X2SH=(R2(K)-R2SH)*TPH2K       +X2(K)                               SHOCKE     98
      GO TO 300                                                          SHOCKE     99
  200 TPSIW=TAN(PSIW)                                                    SHOCKE    100
      R3SH=(RSHW-XSHW*TPSIW    +R2(K)*TPH2K       *TPSIW   + X2(K)*TPSIW SHOCKE    101
     *    )/(1.0+TPSIW    * TPH2K )                                      SHOCKE    102
      X3SH=(R2(K)-R3SH)* TPH2K      +X2(K)                               SHOCKE    103
  300 CALL SHOPRO                                                        SHOCKE    104
      CPSH=0.0                                                           SHOCKE    105
      MWSH=0.0                                                           SHOCKE    106
      DO 500 I= 1,NDS                                                    SHOCKE    107
      DO 333 J=1,NN                                                      SHOCKE    108
  333 CPSH=CPSH+A(I,J)*FLOAT(J-2)*CSH1(I)*TSH1**(J-3)                    SHOCKE    109
  500 MWSH=MWSH+CSH1(I)/MW(I)                                            SHOCKE    110
      MWSH=1./MWSH                                                       SHOCKE    111
      GAMMA=CPSH/(CPSH-RCON/MWSH)                                        SHOCKE    112
      MASH1=USH1/SQRT(GAMMA*RU*TSH1/MWSH)                                SHOCKE    113
      IF(ICONST) 1500,400,1500                                           SHOCKE    114
C     SHOCK CALCULATION FOR CONSTANT GAMMA                               SHOCKE    115
C     DETERMINATION OF SHOCK ANGLE                                       SHOCKE    116
  400 DELPHI=PHI2(K)-PHISH1                                              SHOCKE    117
      B1=-(MASH1**2+2.0)/(MASH1**2)-GAMMA*SIN(DELPHI)**2                 SHOCKE    118
      B2=(2.0*MASH1**2+1.0)/(MASH1**4)                                   SHOCKE    119
      B2=B2+((GAMMA+1.0)**2/4.0+(GAMMA-1.0)/(MASH1**2))*SIN(DELPHI)**2   SHOCKE    120
      B3=COS(DELPHI)**2/(MASH1**4)*(-1.0)                                SHOCKE    121
      ITER=0                                                             SHOCKE    122
      IF (NBOUND) 620,600,620                                            SHOCKE    123
  600 IF (DELPHI) 625,605,605                                            SHOCKE    124
  605 ZETA=(1.0/MASH1)**2                                                SHOCKE    125
      US=USH1*(1.+ABS(DELPHI)/SQRT(MASH1**2-1.))                         SHOCKE    126
      TS=TSH1-(US**2-USH1**2)/(2.0*HJ*CPSH)                              SHOCKE    127
      PS=PSH1*(TS/TSH1)**(GAMMA/(GAMMA-1.))                              SHOCKE    128
      IF (NBOUND) 615,610,615                                            SHOCKE    129
  610 PSHW=PS                                                            SHOCKE    130
      TSHW=TS                                                            SHOCKE    131
      USHW=US                                                            SHOCKE    132
      GO TO 1350                                                         SHOCKE    133
  615 PSH=PS                                                             SHOCKE    134
      TSH=TS                                                             SHOCKE    135
      USH=US                                                             SHOCKE    136
      GO TO 1175                                                         SHOCKE    137
  620 IF (DELPHI) 605,605,630                                            SHOCKE    138
  625 ZETA=(1.0/MASH1-SIN(DELPHI))**2                                    SHOCKE    139
      GO TO 700                                                          SHOCKE    140
  630 ZETA=(1.0/MASH1+SIN(DELPHI))**2                                    SHOCKE    141
  700 ITER=ITER+1                                                        SHOCKE    142
      GG=ZETA**3+B1*ZETA**2+B2*ZETA+B3                                   SHOCKE    143
      DGDZ=3.0*ZETA**2+2.0*B1*ZETA+B2                                    SHOCKE    144
      DLZETA=-GG/DGDZ                                                    SHOCKE    145
      IF(ABS(DLZETA/ZETA)-TOL) 1100,800,800                              SHOCKE    146
  800 IF (ITER-NITER) 900,900,1000                                       SHOCKE    147
  900 ZETA=ZETA+DLZETA                                                   SHOCKE    148
      GO TO 700                                                          SHOCKE    149
 1000 WRITE (6,1050)                                                     SHOCKE    150
 1050 FORMAT(27H1ITERATIONS FOR ZETA FAILED)                             SHOCKE    151
      WRITE(6,1025) ITER,NITER,K,LL,IFLAG,TOL,ZETA,GG,B1,B2,B3           SHOCKE    152
 1025 FORMAT(1X,5HITER=,I5,5X,6HNITER=,I5,5X,2HK=,I5,5X,3HLL=,I5,5X,     SHOCKE    153
     1  6HIFLAG=,I5/5H TOL=,1PE15.6,5X,5HZETA=,1PE15.6,5X,3HGG=,1PE15.6/ SHOCKE    154
     2  1X,3HB1=,1PE15.6,5X,3HB2=,1PE15.6,5X,3HB3=,1PE15.6)              SHOCKE    155
      CALL PDUMP (A(1,1),N,5)                                            SHOCKE    156
C     DETERMINATION OF SHOCKED GAS PROPERTIES                            SHOCKE    157
 1100 CON4=CPSH*TSH1+USH1**2/(2.0*HJ)                                    SHOCKE    158
      IF (NBOUND) 1150,1300,1150                                         SHOCKE    159
 1150 PSH=(2.0*GAMMA*MASH1**2*ZETA-GAMMA+1.0)/(GAMMA+1.0)*PSH1           SHOCKE    160
      TTSH=(PSH/PSH1)*((GAMMA-1.0)*MASH1**2*ZETA+2.0)                    SHOCKE    161
      TSH=TTSH/((GAMMA+1.0)*MASH1**2*ZETA)*TSH1                          SHOCKE    162
      USH=SQRT(2.0*HJ*(CON4-CPSH*TSH))                                   SHOCKE    163
 1175 MASH=MASH1*USH/USH1*SQRT(TSH1/TSH)                                 SHOCKE    164
      DO 1200 I=1,NDS                                                    SHOCKE    165
      CSH(I)=CSH1(I)                                                     11AUG     121
      IF (ISB.EQ.1) CSH(I)=ABS(CSH1(I))                                  18JUNE     19
 1200 CONTINUE                                                           11AUG     122
      GB=MWSH*PSH1*USH1/(RV*TSH1)                                        11AUG     123
      IF (ICONST) 1240,1230,1240                                         SHOCKE    168
 1230 FHB=GB*(CPSH*TSH1+USH1**2/(2.0*HJ))                                SHOCKE    169
      GO TO 1260                                                         SHOCKE    170
 1240 FHB=GB*USH1**2/(2.0*HJ)                                            SHOCKE    171
      DO 1250 I=1,NDS                                                    SHOCKE    172
      DO 1250 J=1,NN                                                     SHOCKE    173
 1250 FHB=FHB+GB*A(I,J)*CSH1(I)*TSH1**(J-2)                              SHOCKE    174
 1260 ANGLE=0.5*(PHISH1+PHBOLD)                                          SHOCKE    175
      GO TO 6000                                                         SHOCKE    176
 1300 PSHW=(2.0*GAMMA*MASH1**2*ZETA-GAMMA+1.0)/(GAMMA+1.0)*PSH1          SHOCKE    177
      TTSH=(PSHW/PSH1)*((GAMMA-1.0)*MASH1**2*ZETA+2.0)                   SHOCKE    178
      TSHW=TTSH/((GAMMA+1.0)*MASH1**2*ZETA)*TSH1                         SHOCKE    179
      USHW=SQRT(2.0*HJ*(CON4-CPSH*TSHW))                                 SHOCKE    180
 1350 MASH=MASH1*USHW/USH1*SQRT(TSH1/TSHW)                               SHOCKE    181
      DO 1400 I=1,NDS                                                    SHOCKE    182
 1400 CSHW(I)=CSH1(I)                                                    SHOCKE    183
      GW=MWSH*PSH1*USH1/(RV*TSH1)                                        SHOCKE    184
      IF (ICONST) 1440,1430,1440                                         SHOCKE    185
 1430 FHW=GW*(CPSH*TSH1+USH1**2/(2.0*HJ))                                SHOCKE    186
      GO TO 1460                                                         SHOCKE    187
 1440 FHW=GW*USH1**2/(2.0*HJ)                                            SHOCKE    188
      DO 1450 I=1,NDS                                                    SHOCKE    189
      DO 1450 J=1,NN                                                     SHOCKE    190
 1450 FHW=FHW+GW*A(I,J)*CSH1(I)*TSH1**(J-2)                              SHOCKE    191
 1460 ANGLE=0.5*(PHISH1+PHWOLD)                                          SHOCKE    192
      GO TO 6000                                                         SHOCKE    193
 1500 H1=0.0                                                             SHOCKE    194
      DO 1600 J=1,NN                                                     SHOCKE    195
      DO 1600 I=1,NDS                                                    SHOCKE    196
 1600 H1=H1+A(I,J)*CSH1(I)*TSH1**(J-2)                                   SHOCKE    197
      DO 1900 I=1,NDS                                                    SHOCKE    198
      IF (NBOUND) 1700,1800,1700                                         SHOCKE    199
 1700 CSH(I)=CSH1(I)                                                     SHOCKE    200
      GO TO 1900                                                         SHOCKE    201
 1800 CSHW(I)=CSH1(I)                                                    SHOCKE    202
 1900 CONTINUE                                                           SHOCKE    203
      ITER=0                                                             SHOCKE    204
      IF (NBOUND) 2000,2100,2000                                         SHOCKE    205
 2000 TS=TSH                                                             SHOCKE    206
      THS=PSI-PHISH1                                                     SHOCKE    207
      DELPHI=PHI(KMAX)-PHISH1                                            SHOCKE    208
      IF (DELPHI) 605,605,2200                                           SHOCKE    209
 2100 TS=TSHW                                                            SHOCKE    210
      THS=PHISH1-PSIW                                                    SHOCKE    211
      DELPHI=PHISH1-PHI(K)                                               SHOCKE    212
      DEL2=ABS(DELPHI)                                                   SHOCKE    213
      IF (DELPHI) 2150,2150,2200                                         SHOCKE    214
 2150 DELPHI=-DELPHI                                                     SHOCKE    215
      GO TO 605                                                          SHOCKE    216
 2200 E=MASH1**2                                                         SHOCKE    217
      F=GAMMA+1.                                                         SHOCKE    218
      TERM1=GAMMA*E*DELPHI/SQRT(E-1.)                                    SHOCKE    219
      TERM2=TERM1*(F*E**2-4.*(E-1.))*DELPHI/(4.*(E-1.)**(3./2.))         SHOCKE    220
      IF (TERM2.GT.0.001*TERM1) GO TO 2250                               SHOCKE    221
      TERM3=TERM1*(F**2*E**4/32.-(7.+12.*GAMMA-3.*GAMMA**2)*E**3+.75*F*E SHOCKE    222
     ***2-E+2./3.)*DELPHI**2/(E-1.)**3                                   SHOCKE    223
      XI=1.+TERM1+TERM2+TERM3                                            SHOCKE    224
      ZETA=(F*XI+F-2.)/(2.*GAMMA*E)                                      SHOCKE    225
      GO TO 1100                                                         SHOCKE    226
 2250 ITER=ITER+1                                                        SHOCKE    227
      H2=0.0                                                             SHOCKE    228
      CP=0.0                                                             SHOCKE    229
      DO 2300 I=1,NDS                                                    SHOCKE    230
      DO 2300 J=1,NN                                                     SHOCKE    231
      H2=H2+A(I,J)*CSH1(I)*TS**(J-2)                                     SHOCKE    232
 2300 CP=CP+FLOAT(J-2)*A(I,J)*TS**(J-3)*CSH1(I)                          SHOCKE    233
      SIT=SIN(THS)                                                       SHOCKE    234
      SID=SIN(THS-DELPHI)                                                SHOCKE    235
      COOT=COS(THS)                                                      SHOCKE    236
      COD=COS(THS-DELPHI)                                                SHOCKE    237
      TAT=TAN(THS)                                                       SHOCKE    238
      TAD=TAN(THS-DELPHI)                                                SHOCKE    239
      G(1)=-(H2-H1-USH1**2*(1.-(COOT/COD)**2)/(2.*HJ))                   SHOCKE    240
      G(2)=-(PSH1*(TSH1/TAT-TS/TAD)+PSH1*MWSH*USH1**2/(RV*BETAP)*SIT*COO SHOCKE    241
     *T*(1.-TAD/TAT))                                                    SHOCKE    242
      DGD(1,1)=CP                                                        SHOCKE    243
      DGD(1,2)=USH1**2*COOT*(COOT*TAD-SIT)/(HJ*COD**2)                   SHOCKE    244
      DGD(2,1)=-PSH1/TAD                                                 SHOCKE    245
      DGD(2,2)=PSH1*(TS/SID**2-TSH1/SIT**2)+PSH1*MWSH*USH1**2/(RV*BETAP) SHOCKE    246
     **((COOT**2-SIT**2)*(1.-TAD/TAT)         -COOT**2/COD**2+TAD/TAT)   SHOCKE    247
      YYY=0.0                                                            SHOCKE    248
      CALL MATE7(2,2,1,DGD,G,YYY,XX,J)                                   SHOCKE    249
      GO TO (2600,2400,2500),J                                           SHOCKE    250
 2400 WRITE (6,2405)                                                     SHOCKE    251
 2405 FORMAT (42H1DETERMINANT OVERFLOW IN SUBROUTINE SHOCKE)             SHOCKE    252
      GO TO 2510                                                         SHOCKE    253
 2500 WRITE (6,2505)                                                     SHOCKE    254
 2505 FORMAT (42H1SINGULAR DETERMINANT IN SUBROUTINE SHOCKE)             SHOCKE    255
 2510 CALL PDUMP(A(1,1),N,1)                                             SHOCKE    256
      CALL EXIT                                                          SHOCKE    257
 2600 DO 2650 I=1,2                                                      SHOCKE    258
 2650 XX(I)=DGD(I,1)                                                     SHOCKE    259
      IF (ABS(XX(1)/TS)-TOL ) 2800,2700,2700                             SHOCKE    260
 2700 TS=TS+XX(1)                                                        SHOCKE    261
      THS=THS+XX(2)                                                      SHOCKE    262
      IF (ITER-NITER) 2200,2200,2750                                     SHOCKE    263
 2750 WRITE (6,1050)                                                     SHOCKE    264
      WRITE(6,1025) ITER,NITER,K,LL,IFLAG,TOL,ZETA,GG,B1,B2,B3           SHOCKE    265
      GO TO 2510                                                         SHOCKE    266
 2800 IF (ABS(XX(2)/THS)-SQRT(TOL)) 2900,2700,2700                       SHOCKE    267
 2900 IF (NBOUND) 3100,3000,3100                                         SHOCKE    268
 3000 TSHW=TS                                                            SHOCKE    269
      USHW=SQRT(2.*HJ*(H1-H2)+USH1**2)                                   SHOCKE    270
      PSHW=PSH1*(1.+MWSH/(RV*BETAP*TSH1)*USH1**2*SIT**2*(1.-TAD/TAT))    SHOCKE    271
      ZETA=SIN(THS)**2                                                   SHOCKE    272
      DELPHI=-DELPHI                                                     SHOCKE    273
      GO TO 1350                                                         SHOCKE    274
 3100 TSH=TS                                                             SHOCKE    275
      USH =SQRT(2.*HJ*(H1-H2)+USH1**2)                                   SHOCKE    276
      PSH =PSH1*(1.+MWSH/(RV*BETAP*TSH1)*USH1**2*SIT**2*(1.-TAD/TAT))    SHOCKE    277
      ZETA=SIN(THS)**2                                                   SHOCKE    278
      GO TO 1175                                                         SHOCKE    279
 6000 IF (NBOUND) 6005,6050,6005                                         SHOCKE    280
 6005 PBS=PSH                                                            SHOCKE    281
      IF (DELPHI) 6007,6006,6006                                         SHOCKE    282
 6006 PSITRY=ASIN(SQRT(ZETA))+PHISH1                                     SHOCKE    283
      GO TO 6008                                                         SHOCKE    284
 6007 PSITRY=ASIN(SQRT(ZETA))+PHI2(K)                                    SHOCKE    285
 6008 IF (IFLAG) 6010,6009,6010                                          SHOCKE    286
 6009 PSI=0.5*(PSI+PSITRY)                                               SHOCKE    287
      GO TO 10000                                                        SHOCKE    288
C     EXTERNAL SHOCK -- CALCULATION OF PROPERTIES IN STREAMTUBE          SHOCKE    289
C     BETWEEN SHOCK AND OUTERMOST STREAMLINE CARRIED                     SHOCKE    290
 6010 B=SQRT((R2SH-R(K))**2+(X2SH-X(K))**2)                              SHOCKE    291
      BFACT=SQRT((XSH-X2SH)**2+(RSH-R2SH)**2)*ABS(SIN(PSI-ANGLE))        SHOCKE    292
      PROJA=BFACT*(RSH+R2SH)**DELTA*PI                                   SHOCKE    293
      RESH=RE(KMAX)*PSH*USH*T(KMAX)**(1.0+OMEGA(1))/(DELY(KMAX)*P(KMAX)* SHOCKE    294
     *U(KMAX)*TSH**(1.0+OMEGA(1)))                                       SHOCKE    295
      SUMDOT=0.0                                                         SHOCKE    296
      DO 6015 L=2,KMAX                                                   SHOCKE    297
 6015 SUMDOT=SUMDOT+MDOT(L)/(.5*(R2(L)+R2(L-1)))**2                      SHOCKE    298
      BMASUM=BMASUM+PROJA*0.5*(GB+GBOLD)                                 SHOCKE    299
      BHSUM=BHSUM+PROJA*0.5*(FHB+FHBOLD)                                 SHOCKE    300
      DO 6014 I=1,NDS                                                    SHOCKE    301
 6014 SUMASB(I)=SUMASB(I)+.5*PROJA*(GB*CSH(I)+GBOLD*CSH2(I))             SHOCKE    302
 6016 IF (BMASUM/(.5*(R2SH+R2(KMAX-1)))**2-1.2*SUMDOT/GSTEP) 7400,6020,  SHOCKE    303
     *6020                                                               SHOCKE    304
C     ADDING NEW STREAMTUBE TO SHOCKED FLOW                              SHOCKE    305
 6020 KMAX=KMAX+1                                                        SHOCKE    306
      X(KMAX)=X2SH                                                       SHOCKE    307
      R(KMAX)=R2SH                                                       SHOCKE    308
      DO 6021 I=1,NDS                                                    SHOCKE    309
 6021 CSH(I)=SUMASB(I)/BMASUM                                            SHOCKE    310
      IF (DELPHI) 6025,6025,6022                                         SHOCKE    311
 6022 PHI(KMAX)=PHI(K)                                                   SHOCKE    312
      GO TO 6027                                                         SHOCKE    313
 6025 PHI(KMAX)=0.5*(PHI(K)+PHISH1)                                      SHOCKE    314
 6027 P(KMAX)=PSH                                                        SHOCKE    315
      AA(KMAX)=PI*(R(KMAX)+R(K))**DELTA*B                                SHOCKE    316
      IF (KOUNT) 6026,6028,6026                                          SHOCKE    317
 6026 Z=(BMASUM*RV/(AA(KMAX)*MWSH*P(KMAX)))**2/(2.0*HJ)                  SHOCKE    318
      IF (ICONST) 4100,4000,4100                                         SHOCKE    319
 4000 T(KMAX)=(SQRT(CPSH**2+4.0*Z*BHSUM/BMASUM)-CPSH)/(2.0*Z)            SHOCKE    320
      GO TO 4700                                                         SHOCKE    321
 4100 ITER=0                                                             SHOCKE    322
      TS=TSH                                                             SHOCKE    323
 4200 ITER=ITER+1                                                        SHOCKE    324
      GG=Z*TS**2-BHSUM/BMASUM                                            SHOCKE    325
      DGG=2.0*Z*TS                                                       SHOCKE    326
      DO 4250 I=1,NDS                                                    SHOCKE    327
      DO 4250 J=1,NN                                                     SHOCKE    328
      GG=GG+A(I,J)*CSH(I)*TS**(J-2)                                      SHOCKE    329
 4250 DGG=DGG+FLOAT(J-2)*A(I,J)*CSH(I)*TS**(J-3)                         SHOCKE    330
      DELT=-GG/DGG                                                       SHOCKE    331
      TS=TS+DELT                                                         SHOCKE    332
      IF (ABS(DELT/TS)-TOL) 4600,4300,4300                               SHOCKE    333
 4300 IF (ITER-NITER) 4200,4400,4400                                     SHOCKE    334
 4400 WRITE (6,4500)                                                     SHOCKE    335
 4500 FORMAT (30H1TEMPERATURE ITERATIONS FAILED)                         SHOCKE    336
      GO TO 2510                                                         SHOCKE    337
 4600 T(KMAX)=TS                                                         SHOCKE    338
 4700 U(KMAX)=BMASUM*RV*T(KMAX)/(AA(KMAX)*MWSH*P(KMAX))                  SHOCKE    339
      GO TO 6029                                                         SHOCKE    340
 6028 T(KMAX)=TSH                                                        SHOCKE    341
      U(KMAX)=USH                                                        SHOCKE    342
      KOUNT=1                                                            SHOCKE    343
 6029 BMASUM=0.0                                                         SHOCKE    344
      BHSUM=0.0                                                          SHOCKE    345
      DO6030 I=1,NDS                                                     SHOCKE    346
      C(I,KMAX)=CSH(I)                                                   SHOCKE    347
      SUMASB(I)=0.                                                       SHOCKE    348
 6030 XS(I,KMAX)=CSH(I)*MWSH/MW(I)                                       SHOCKE    349
      RHO(KMAX)=MWSH*P(KMAX)/(RV*T(KMAX))                                SHOCKE    350
      DELY(KMAX)=B                                                       SHOCKE    351
      Y(KMAX)=Y(K)+B                                                     SHOCKE    352
      MDOT(KMAX)=RHO(KMAX)*U(KMAX)*AA(KMAX)                              SHOCKE    353
      RE(KMAX)=RESH*B                                                    SHOCKE    354
      MA(KMAX)=U(KMAX)/(SQRT(CPSH*T(KMAX)*RU/(CPSH*MWSH-RCON)))          SHOCKE    355
      H(KMAX)=0.0                                                        SHOCKE    356
      DO6040 I=1,NDS                                                     SHOCKE    357
      DO6040 J=1,NN                                                      SHOCKE    358
 6040 H(KMAX)=H(KMAX)+A(I,J)*CSH(I)*T(KMAX)**(J-2)                       SHOCKE    359
      J=KMAX                                                             SHOCKE    360
      X2(J)=X(J)                                                         SHOCKE    361
      R2(J)=R(J)                                                         SHOCKE    362
      T2(J)=T(J)                                                         SHOCKE    363
      P2(J)=P(J)                                                         SHOCKE    364
      U2(J)=U(J)                                                         SHOCKE    365
      PHI2(J)=PHI(J)                                                     SHOCKE    366
      GO TO 6099                                                         SHOCKE    367
 6050 PWSH=PSHW                                                          SHOCKE    368
      IF (DELPHI) 6051,6051,6052                                         SHOCKE    369
 6051 PSIWTR=PHISH1-ASIN(SQRT(ZETA))                                     SHOCKE    370
      GO TO 6053                                                         SHOCKE    371
 6052 PSIWTR=PHI2(K)-ASIN(SQRT(ZETA))                                    SHOCKE    372
 6053 IF (IFLAG) 6055,6054,6055                                          SHOCKE    373
 6054 PSIW=0.5*(PSIW+PSIWTR)                                             SHOCKE    374
      DO6041 I=1,NDS                                                     SHOCKE    375
 6041 ZJ(I,KMAX)=ZJ(I,KMAX-1)                                            SHOCKE    376
      GO TO 10000                                                        SHOCKE    377
C     INTERNAL SHOCK -- CALCULATION OF PROPERTIES IN STREAMTUBE          SHOCKE    378
C     BETWEEN SHOCK AND INNERMOST STREAMLINE CARRIED                     SHOCKE    379
 6055 B=SQRT((R3SH-R2(K))**2+(X3SH-X2(K))**2)                            SHOCKE    380
      DO6042 I=1,NDS                                                     SHOCKE    381
 6042 ZJ(I,KMAX)=ZJ(I,KMAX-1)                                            SHOCKE    382
      BFACT=SQRT((XSHW-X3SH)**2+(RSHW-R3SH)**2)*ABS(SIN(PSIW-ANGLE))     SHOCKE    383
      PROJAW=BFACT*(RSHW+R3SH)**DELTA*PI                                 SHOCKE    384
      RESH=RE(2)*PSHW*USHW*T(2)**(1.0+OMEGA(1))/(DELY(2)*P(2)*U(2)*TSHW* SHOCKE    385
     **(1.0+OMEGA(1)))                                                   SHOCKE    386
      SUMDOT=0.0                                                         SHOCKE    387
      DO 6058 L=2,KMAX                                                   SHOCKE    388
 6058 SUMDOT=SUMDOT+MDOT(L)/(.5*(R2(L)+R2(L-1)))**2                      SHOCKE    389
      WMASUM=WMASUM+PROJAW*0.5*(GW+GWOLD)                                SHOCKE    390
      WHSUM=WHSUM+PROJAW*0.5*(FHW+FHWOLD)                                SHOCKE    391
      DO 6047 I=1,NDS                                                    SHOCKE    392
 6047 SUMASW(I)=SUMASW(I)+.5*PROJAW*(GW*CSHW(I)+GWOLD*CSH3(I))           SHOCKE    393
 6061 J=1                                                                SHOCKE    394
      IF (IKIND.NE.3) GO TO 6062                                         SHOCKE    395
      IF ((R3SH-ROLD) -  (1.25*(ROLD-ROLDER))) 7600,6060,6060            SHOCKE    396
 6062 IF (WMASUM/(.5*(R3SH+R2(J)))**2-1.2*SUMDOT/GSTEP) 7600,6060,6060   SHOCKE    397
 6060 KMAX=KMAX+1                                                        SHOCKE    398
C     REINDEXING STREAMLINES IN SHOCKED GAS                              SHOCKE    399
      J=KMAX                                                             SHOCKE    400
 6065 AA(J)=AA(J-1)                                                      SHOCKE    401
      DO 6070 I=1,NDS                                                    SHOCKE    402
      C(I,J)=C(I,J-1)                                                    SHOCKE    403
      C2(I,J)=C2(I,J-1)                                                  SHOCKE    404
 6070 XS(I,J)=XS(I,J-1)                                                  SHOCKE    405
      DELY(J)=DELY(J-1)                                                  SHOCKE    406
      H(J)=H(J-1)                                                        SHOCKE    407
      MA(J)=MA(J-1)                                                      SHOCKE    408
      MDOT(J)=MDOT(J-1)                                                  SHOCKE    409
      P(J)=P(J-1)                                                        SHOCKE    410
      PHI(J)=PHI(J-1)                                                    SHOCKE    411
      R(J)=R(J-1)                                                        SHOCKE    412
      RE(J)=RE(J-1)                                                      SHOCKE    413
      RHO(J)=RHO(J-1)                                                    SHOCKE    414
      SX(J)=SX(J-1)                                                      SHOCKE    415
      T(J)=T(J-1)                                                        SHOCKE    416
      U(J)=U(J-1)                                                        SHOCKE    417
      X(J)=X(J-1)                                                        SHOCKE    418
      Y(J)=Y(J-1)+B                                                      SHOCKE    419
      P2(J)=P2(J-1)                                                      SHOCKE    420
      PHI2(J)=PHI2(J-1)                                                  SHOCKE    421
      R2(J)=R2(J-1)                                                      SHOCKE    422
      RHO2(J)=RHO2(J-1)                                                  SHOCKE    423
      T2(J)=T2(J-1)                                                      SHOCKE    424
      U2(J)=U2(J-1)                                                      SHOCKE    425
      X2(J)=X2(J-1)                                                      SHOCKE    426
      Y2(J)=Y2(J-1)+B                                                    SHOCKE    427
      DELSS(J)=DELSS(J-1)                                                SHOCKE    428
      IEXTRA(7)=IEXTRA(7)+1                                              SHOCKE    429
      J=J-1                                                              SHOCKE    430
      IF (J-2) 6075,6075,6065                                            SHOCKE    431
C     ADDING NEW STREAMTUBE TO SHOCKED FLOW                              SHOCKE    432
 6075 J=2                                                                SHOCKE    433
      DO 6087 I=1,NDS                                                    SHOCKE    434
 6087 CSHW(I)=SUMASW(I)/WMASUM                                           SHOCKE    435
      P(J)=PSHW                                                          SHOCKE    436
      P2(J)=PSHW                                                         SHOCKE    437
      AA(J)=PI*(R3SH+R(J-1))**DELTA*B                                    SHOCKE    438
      IF (KINT) 6076,6077,6076                                           SHOCKE    439
 6076 Z=      (WMASUM*RV/(AA(J)*MWSH*P(J)))**2/(2.0*HJ)                  SHOCKE    440
      IF (ICONST) 5100,5000,5100                                         SHOCKE    441
 5000 T(J)=(SQRT(CPSH**2+4.0*Z*WHSUM/WMASUM)-CPSH)/(2.0*Z)               SHOCKE    442
      T2(J)=T(J)                                                         SHOCKE    443
      GO TO 5700                                                         SHOCKE    444
 5100 ITER=0                                                             SHOCKE    445
      TS=TSHW                                                            SHOCKE    446
 5200 ITER=ITER+1                                                        SHOCKE    447
      GG=Z*TS**2-WHSUM/WMASUM                                            SHOCKE    448
      DGG=2.0*Z*TS                                                       SHOCKE    449
      DO 5250 I=1,NDS                                                    SHOCKE    450
      DO 5250 L=1,NN                                                     SHOCKE    451
      GG=GG+A(I,L)*CSHW(I)*TS**(L-2)                                     SHOCKE    452
 5250 DGG=DGG+FLOAT(L-2)*A(I,L)*CSHW(I)*TS**(L-3)                        SHOCKE    453
      DELT=-GG/DGG                                                       SHOCKE    454
      TS=TS+DELT                                                         SHOCKE    455
      IF (ABS(DELT/TS)-TOL) 5600,5300,5300                               SHOCKE    456
 5300 IF (ITER-NITER) 5200,4400,4400                                     SHOCKE    457
 5600 T(J)=TS                                                            SHOCKE    458
      T2(J)=TS                                                           SHOCKE    459
 5700 U(J)=WMASUM*RV*T(J)/(AA(J)*MWSH*P(J))                              SHOCKE    460
      U2(J)=U(J)                                                         SHOCKE    461
      GO TO 6078                                                         SHOCKE    462
 6077 T(J)=TSHW                                                          SHOCKE    463
      T2(J)=TSHW                                                         SHOCKE    464
      U(J)=USHW                                                          SHOCKE    465
      U2(J)=USHW                                                         SHOCKE    466
      KINT=1                                                             SHOCKE    467
 6078 WMASUM=0.0                                                         SHOCKE    468
      WHSUM=0.0                                                          SHOCKE    469
      DO 6080 I=1,NDS                                                    SHOCKE    470
      C(I,J)=CSHW(I)                                                     SHOCKE    471
      C2(I,J)=C(I,J)                                                     SHOCKE    472
      SUMASW(I)=0.                                                       SHOCKE    473
 6080 XS(I,J)=C(I,J)*MWSH/MW(I)                                          SHOCKE    474
      RHO(J)=MWSH*P(J)/(RV*T(J))                                         SHOCKE    475
      RHO2(J)=RHO(J)                                                     SHOCKE    476
      X(J)=X(J-1)                                                        SHOCKE    477
      X2(J)=X2(J-1)                                                      SHOCKE    478
      R(J)=R(J-1)                                                        SHOCKE    479
      R2(J)=R2(J-1)                                                      SHOCKE    480
      PHI2(J)=PHI2(J-1)                                                  SHOCKE    481
      PHI(J)=PHI(J-1)                                                    SHOCKE    482
      DELY(J)=B                                                          SHOCKE    483
      Y(J)=B                                                             SHOCKE    484
      Y2(J)=B                                                            SHOCKE    485
      MDOT(J)=RHO(J)*U(J)*AA(J)                                          SHOCKE    486
      RE(J)=RESH*B                                                       SHOCKE    487
      MA(J)=U(J)/(SQRT(CPSH*T(J)*RU/(CPSH*MWSH-RCON)))                   SHOCKE    488
      H(J)=0.0                                                           SHOCKE    489
      DO 6090 I=1,NDS                                                    SHOCKE    490
      DO 6090 JJ=1,NN                                                    SHOCKE    491
 6090 H(J)=H(J)+A(I,JJ)*C(I,J)*T(J)**(JJ-2)                              SHOCKE    492
      J=1                                                                SHOCKE    493
      X2(J)=X3SH                                                         SHOCKE    494
      R2(J)=R3SH                                                         SHOCKE    495
      IF (DELPHI) 6091,6092,6092                                         SHOCKE    496
 6091 PHI2(J)=PHI2(1)                                                    SHOCKE    497
      GO TO 6093                                                         SHOCKE    498
 6092 PHI2(J)=0.5*(PHI2(1)+PHISH1)                                       SHOCKE    499
 6093 Y2(J)=0.0                                                          SHOCKE    500
      DO 7700 J=2,KMAX                                                   SHOCKE    501
 7700 Y2(J)=Y2(J-1)+DELY(J)                                              SHOCKE    502
      IF (IKIND.NE.3) GO TO 6099                                         SHOCKE    503
      ROLDER=ROLD                                                        SHOCKE    504
      ROLD=R3SH                                                          SHOCKE    505
      IF (IKIND.NE.3.OR.NBOUND.NE.0) GO TO 7400                          SHOCKE    506
      K=2                                                                SHOCKE    507
      CALL PUTOUT(3)                                                     SHOCKE    508
 6099 CALL PUTOUT(2)                                                     SHOCKE    509
C        PREPARING FOR NEXT STEP DOWNSTREAM                              SHOCKE    510
 7400 IF (NBOUND) 7500,7600,7500                                         SHOCKE    511
 7500 XSH=X2SH                                                           SHOCKE    512
      RSH=R2SH                                                           SHOCKE    513
      PSI=PSITRY                                                         SHOCKE    514
      GBOLD=GB                                                           SHOCKE    515
      FHBOLD=FHB                                                         SHOCKE    516
      PHBOLD=PHISH1                                                      SHOCKE    517
      DO 7550 I=1,NDS                                                    SHOCKE    518
 7550 CSH2(I)=CSH1(I)                                                    SHOCKE    519
      GO TO 10000                                                        SHOCKE    520
 7600 XSHW=X3SH                                                          SHOCKE    521
      RSHW=R3SH                                                          SHOCKE    522
      PSIW=PSIWTR                                                        SHOCKE    523
      GWOLD=GW                                                           SHOCKE    524
      FHWOLD=FHW                                                         SHOCKE    525
      PHWOLD=PHISH1                                                      SHOCKE    526
      DO 7650 I=1,NDS                                                    SHOCKE    527
 7650 CSH3(I)=CSH1(I)                                                    SHOCKE    528
      K=2                                                                SHOCKE    529
10000 RETURN                                                             SHOCKE    530
      END                                                                SHOCKE    531
      SUBROUTINE SHOPRO                                                  SHOPRO      2
C     THIS SUBROUTINE DETERMINES THE CONDITIONS UPSTREAM OF THE SHOCK    SHOPRO      3
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    SHOPRO      5
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         SHOPRO      6
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        SHOPRO      7
     * ,      MAP                                                        SHOPRO      8
      COMMON /INTRP1/ NSTRM(2),TSFC(2),PSFC(2),USFC(2),PHISFC(2),        SHOPRO      9
     1CSFC (2,25), DPTSFC(2)                                             SHOPRO     10
      COMMON/TURPLE/DEL2,CPSHW,GAMSHW,ZMWSH1                             SHOPRO     11
      COMMON /JND/ JNDL(2,120),JNDR(2,120)                               SHOPRO     12
      COMMON/INSHOP/ POO,TOO,UOO,PHOO,COO(20)                            SHOPRO     13
      COMMON/INPRO/ ICSH,IIN                                             SHOPRO     14
      COMMON/ORSHOK/XTRY,RTRY                                            SHOPRO     15
      COMMON/SHOSHO/X3SH,R3SH                                            SHOPRO     16
      COMMON/UTPP/PSH11,TSH11,USH11,FLANG,CSH11(20)                      SHOPRO     17
      INTEGER R1S2,R2S2,R1,R3,R2M1,R1P1                                  SHOPRO     18
      DIMENSION LOCF(2,120),         NTOT(2)                             SHOPRO     19
      DIMENSION ARHO(6,6), ATHET(6,6), AP(6,6)                           SHOPRO     20
      DIMENSION CDUM(25),CSH11(20)                                       SHOPRO     21
      EQUIVALENCE (ITAPES,IEXTRA(2))                                     SHOPRO     22
      IF (LL) 130,120,130                                                SHOPRO     23
  120 RESH=RE(KMAX)                                                      SHOPRO     24
C     TESTS FOR UNIFORM OR NON-UNIFORM FLOW                              SHOPRO     25
  130 GO TO (131,147,141,144,146), ISHOCK                                SHOPRO     26
  131 TSH1=TSTREM                                                        SHOPRO     27
      PSH1=PSTREM                                                        SHOPRO     28
      USH1=USTREM                                                        SHOPRO     29
      DO 140  I=1,NDS                                                    SHOPRO     30
  140 CSH1(I) = CSTREM(I)                                                SHOPRO     31
      PHISH1=PHSTRM                                                      SHOPRO     32
      GO TO 10000                                                        SHOPRO     33
  141 IF (K-1) 131,142,131                                               SHOPRO     34
  142 TSH1=TOO                                                           SHOPRO     35
      PSH1=POO                                                           SHOPRO     36
      USH1=UOO                                                           SHOPRO     37
      DO 143 I=1,NDS                                                     SHOPRO     38
  143 CSH1(I)=COO(I)                                                     SHOPRO     39
      PHISH1=PHOO                                                        SHOPRO     40
      GO TO 10000                                                        SHOPRO     41
  144 IF (K-1) 131,145,131                                               SHOPRO     42
  145 XTRY=X3SH                                                          SHOPRO     43
      RTRY=R3SH                                                          SHOPRO     44
      GO TO 150                                                          SHOPRO     45
  146 IF (K-1) 147,142,147                                               SHOPRO     46
  147 XTRY=X2SH                                                          SHOPRO     47
      RTRY=R2SH                                                          SHOPRO     48
  150 IF (ICSH.NE.0) GO TO 400                                           SHOPRO     49
C     NON-UNIFORM EXTERNAL FLOW WITH TABULAR DATA                        SHOPRO     50
 1502 FORMAT (///57H BEGIN LOGIC TO FIND PROPERTIES FOR POINT PRECEDING  SHOPRO     51
     1SHOCK/14H POINT IS-- X=E15.6, 3H R=E15.6)                          SHOPRO     52
      IF (IFLAG.NE.0) GO TO 1925                                         SHOPRO     53
      IF (CARD1.GT.1.1) GO TO 173                                        SHOPRO     54
      CARD1 = 2.                                                         SHOPRO     55
      MXSTRM = 60                                                        SHOPRO     56
      MXTOT = 120                                                        SHOPRO     57
      ICTSFC = 0                                                         SHOPRO     58
      I9 = 1                                                             SHOPRO     59
      GO TO 153                                                          SHOPRO     60
  151 I9 = 2                                                             SHOPRO     61
  153 ICTSFC = ICTSFC+1                                                  SHOPRO     62
      J = 0                                                              SHOPRO     63
      IF(ICTSFC.GT.1) J=1                                                SHOPRO     64
  154 FORMAT (/19H ORTHOGONAL SURFACEI4/2H L9X,1HX14X,1HR13X,3HPHI13X,1H SHOPRO     65
     1P14X,1HT14X,1HU8X,10HJNDL  JNDR)                                   SHOPRO     66
      DO 165 L=1,MXTOT                                                   SHOPRO     67
      J = J+1                                                            SHOPRO     68
      IF (( ITAPES.NE.0).OR.(ISB.EQ.1)) GO TO 1545                       SHOPRO     69
      READ (5,155)          FX(I9,J),FR(I9,J),FPHI(I9,J),FP(I9,J),FT(I9, SHOPRO     70
     1J),FU(I9,J),JNDL(I9,L),JNDR(I9,L)                                  SHOPRO     71
      IF (EOF(5))  6999,1644                                             SHOPRO     72
 1644 READ(5,1700) (FC(I9,J,I),I=1,NDS)                                  SHOPRO     73
 1545 IF (ISB.EQ.1) GO TO 1546                                           SHOPRO     74
      READ(10,155)          FX(I9,J),FR(I9,J),FPHI(I9,J),FP(I9,J),FT(I9, SHOPRO     75
     1J),FU(I9,J),JNDL(I9,L),JNDR(I9,L)                                  SHOPRO     76
      IF (EOF(10))  6999,1645                                            SHOPRO     77
 1645 READ(10,1700)(FC(I9,J,I),I=1,NDS)                                  SHOPRO     78
      GO TO 1550                                                         SHOPRO     79
 1546 READ  (3,155)         FX(I9,J),FR(I9,J),FPHI(I9,J),FP(I9,J),FT(I9, SHOPRO     80
     1 J),FU(I9,J),JNDL(I9,L),JNDR(I9,L)                                 SHOPRO     81
      IF (EOF(3)) 6999,1646                                              SHOPRO     82
 1646 READ(3,1700) (FC(I9,J,I),I=1,NDS)                                  SHOPRO     83
  155 FORMAT (6E12.5,2I4)                                                SHOPRO     84
 1700 FORMAT(8E10.3)                                                     SHOPRO     85
 1550 IF (JNDR(I9,L)-1)  1551,1559,1551                                  SHOPRO     86
 1551 IF(J.EQ.2.AND.I9.EQ.2) FR(2,1)=DUM2                                SHOPRO     87
      IF(J.EQ.2.AND.I9.EQ.2) FX(2,1)=DUM1                                SHOPRO     88
      RRR=.5*(FR(I9,J)+FR(I9,J-1))                                       SHOPRO     89
      XXX=.5*(FX(I9,J)+FX(I9,J-1))                                       SHOPRO     90
      SMW=0.0                                                            SHOPRO     91
      FCP=0.0                                                            SHOPRO     92
      DO 1554 I=1,NDS                                                    SHOPRO     93
 1552 SMW=SMW+FC(I9,J,I)/MW(I)                                           SHOPRO     94
      FCP=FCP+FC(I9,J,I)*A(I,3)                                          SHOPRO     95
 1554 CONTINUE                                                           SHOPRO     96
      SMW=1.0/SMW                                                        SHOPRO     97
      DENSTY=SMW*FP(I9,J)/(RV*FT(I9,J))                                  SHOPRO     98
      FP(I9,J)=DENSTY*(RRR**2+XXX**2)                                    SHOPRO     99
 1559 IF (JNDR(I9,L).GE.1) GO TO 157                                     SHOPRO    100
      J = J-1                                                            SHOPRO    101
      GO TO 165                                                          SHOPRO    102
  157 IF (J.NE.1) GO TO 160                                              SHOPRO    103
      IF(JNDL(I9,L).NE.1) WRITE(6,3)                                     SHOPRO    104
      IF (JNDL(I9,L).NE.1) GO TO 9999                                    SHOPRO    105
      GO TO 162                                                          SHOPRO    106
  160 IF (JNDL(I9,L).EQ.1) GO TO 170                                     SHOPRO    107
  162 CONTINUE                                                           SHOPRO    108
  163 FORMAT (I3,1P6E15.6,2I6)                                           SHOPRO    109
  165 LOCF(I9,L) = J                                                     SHOPRO    110
      NSTRM(I9) = J                                                      SHOPRO    111
      NTOT(I9) = MXTOT                                                   SHOPRO    112
      GO TO 172                                                          SHOPRO    113
  170 DUM1=FX(I9,J)                                                      SHOPRO    114
      DUM2=FR(I9,J)                                                      SHOPRO    115
      DUM3=FPHI(I9,J)                                                    SHOPRO    116
      DUM4=FP(I9,J)                                                      SHOPRO    117
      DUM5=FT(I9,J)                                                      SHOPRO    118
      DUM6=FU(I9,J)                                                      SHOPRO    119
      IDUM1=JNDL(I9,J)                                                   SHOPRO    120
      IDUM2=JNDR(I9,J)                                                   SHOPRO    121
      DO 1702 I=1,NDS                                                    SHOPRO    122
      CDUM(I)=FC(I9,J,I)                                                 SHOPRO    123
 1702 CONTINUE                                                           SHOPRO    124
  171 NSTRM(I9) = J-1                                                    SHOPRO    125
      NTOT(I9) = L-1                                                     SHOPRO    126
  172 IF (I9.NE.2) GO TO 151                                             SHOPRO    127
  173 NOTUBE=0                                                           SHOPRO    128
      L=0                                                                SHOPRO    129
  175 L=L+1                                                              SHOPRO    130
      IF (JNDR(2,L).GE.1) GO TO 177                                      SHOPRO    131
      IF (L.LT.NTOT(2)) GO TO 175                                        SHOPRO    132
      WRITE(6,2)                                                         SHOPRO    133
      GO TO 9999                                                         SHOPRO    134
  177 R1=L                                                               SHOPRO    135
  178 L=L+1                                                              SHOPRO    136
      IF (JNDR(2,L).GT.1) GO TO 180                                      SHOPRO    137
  179 IF (L.LT.NTOT(2)) GO TO 178                                        SHOPRO    138
      IF(NOTUBE.EQ.0) WRITE(6,1)                                         SHOPRO    139
      IF (NOTUBE.EQ.0) GO TO 9999                                        SHOPRO    140
      GO TO 300                                                          SHOPRO    141
  180 R3=L                                                               SHOPRO    142
 1802 FORMAT ( 30H POINTS FOUND    ON RIGHT. R1=I3,4H R3=I3)             SHOPRO    143
      NOTUBE=1                                                           SHOPRO    144
C     TEST TO SEE IF POINT IS BOUNDED BY STREAMTUBE                      SHOPRO    145
      R1S2=LOCF(2,R1)                                                    SHOPRO    146
      R2S2=LOCF(2,R3)                                                    SHOPRO    147
      IF(ISB.EQ.1) R1S2=LOCF(2,R1)-1                                     SHOPRO    148
      IF(ISB.EQ.1) R2S2=LOCF(2,R3)-1                                     SHOPRO    149
      CALL LOCATE (FX(2,R1S2),FR(2,R1S2),XTRY,RTRY,FX(2,R2S2),FR(2,R2S2) SHOPRO    150
     1,FX(1,R1),FR(1,R1),IFGOOD)                                         SHOPRO    151
      GO TO (182,181) , IFGOOD                                           SHOPRO    152
  181 R1=R3                                                              SHOPRO    153
      GO TO 178                                                          SHOPRO    154
  182 CALL LOCATE (FX(1,R3),FR(1,R3),XTRY,RTRY,FX(1,R1),FR(1,R1),        SHOPRO    155
     1FX(2,R2S2),FR(2,R2S2),IFGOOD)                                      SHOPRO    156
      GO TO (185,181), IFGOOD                                            SHOPRO    157
  185 IF (R3-R1.NE.1) GO TO 186                                          SHOPRO    158
      L1=R1                                                              SHOPRO    159
      L2=R3                                                              SHOPRO    160
      GO TO 192                                                          SHOPRO    161
  186 R2M1=R3-1                                                          SHOPRO    162
      R1P1=R1+1                                                          SHOPRO    163
      DO 188 J=R1P1,R2M1                                                 SHOPRO    164
      XXX=FX(2,R1S2)+(FX(2,R2S2)-FX(2,R1S2))*(FX(1,J)-FX(1,R1))/         SHOPRO    165
     1(FX(1,R3)-FX(1,R1))                                                SHOPRO    166
      RRR=FR(2,R1S2)+(FR(2,R2S2)-FR(2,R1S2))*(FR(1,J)-FR(1,R1))/         SHOPRO    167
     1(FR(1,R3)-FR(1,R1))                                                SHOPRO    168
      CALL LOCATE(FX(1,J),FR(1,J),XTRY,RTRY,FX(1,J-1),FR(1,J-1),         SHOPRO    169
     1XXX,RRR,IFGOOD)                                                    SHOPRO    170
      GO TO (190,188) , IFGOOD                                           SHOPRO    171
  188 CONTINUE                                                           SHOPRO    172
      L1=R2M1                                                            SHOPRO    173
      L2=R3                                                              SHOPRO    174
      GO TO 192                                                          SHOPRO    175
  190 L1=J-1                                                             SHOPRO    176
      L2=J                                                               SHOPRO    177
C     PROJECT POINT BACK TO ORTHOGONAL SURFACES ALONG NORMAL FROM POINT  SHOPRO    178
C     TO THE SURFACES                                                    SHOPRO    179
  192 CONTINUE                                                           SHOPRO    180
 1922 FORMAT ( 41H POINT BRACKETED BOTH LEFT AND RIGHT. R1=I3,4H R3=I3,  SHOPRO    181
     14H L1=I3,4H L2=I3)                                                 SHOPRO    182
 1925 CALL ORTHOG(2,R1S2,R2S2)                                           SHOPRO    183
      CALL ORTHOG (1,L1,L2)                                              SHOPRO    184
      RATIO1 = DPTSFC(2)/(DPTSFC(2)+DPTSFC(1))                           SHOPRO    185
      TSH1 = TSFC(2)+RATIO1*(TSFC(1)-TSFC(2))                            SHOPRO    186
      PSH1 = PSFC(2)+RATIO1*(PSFC(1)-PSFC(2))                            SHOPRO    187
      USH1 = USFC(2)+RATIO1*(USFC(1)-USFC(2))                            SHOPRO    188
      PHISH1 = PHISFC(2)+RATIO1*(PHISFC(1)-PHISFC(2))                    SHOPRO    189
  195 DO 200 I=1,NDS                                                     SHOPRO    190
  200 CSH1(I) = CSFC(2,I)+RATIO1*(CSFC(1,I)-CSFC(2,I))                   SHOPRO    191
  204 DENSTY=PSH1/(RTRY**2+XTRY**2)                                      SHOPRO    192
      SMW=0.0                                                            SHOPRO    193
      FCP=0.0                                                            SHOPRO    194
      DO 205 I=1,NDS                                                     SHOPRO    195
      SMW=SMW+CSH1(I)/MW(I)                                              SHOPRO    196
  205 FCP=FCP+CSH1(I)*A(I,3)                                             SHOPRO    197
      SMW=1.0/SMW                                                        SHOPRO    198
      ZMWSH1=SMW                                                         SHOPRO    199
      PSH1=DENSTY*RV*TSH1/SMW                                            SHOPRO    200
      PSH11=PSH1                                                         SHOPRO    201
      TSH11=TSH1                                                         SHOPRO    202
      USH11=USH1                                                         SHOPRO    203
      FLANG=PHISH1                                                       SHOPRO    204
      DO 299 I=1,NDS                                                     SHOPRO    205
  299 CSH11(I)=CSH1(I)                                                   SHOPRO    206
  210 FORMAT (/34H FINAL PROPERTIES FOR SHOCK POINT./3H T=E15.6,3H P=E15 SHOPRO    207
     1.6,3H U=E15.6,5H PHI=E15.6)                                        SHOPRO    208
      GO TO 10000                                                        SHOPRO    209
  300 NSTRM2 = NSTRM(I9)                                                 SHOPRO    210
      NTOT2 = NTOT(I9)                                                   SHOPRO    211
      DO 305 J=1,NSTRM2                                                  SHOPRO    212
      FX(1,J) = FX(2,J)                                                  SHOPRO    213
      FR(1,J) = FR(2,J)                                                  SHOPRO    214
      FPHI(1,J) = FPHI(2,J)                                              SHOPRO    215
      FP(1,J) = FP(2,J)                                                  SHOPRO    216
      FT(1,J) = FT(2,J)                                                  SHOPRO    217
      FU(1,J) = FU(2,J)                                                  SHOPRO    218
      DO 305 I=1,NDS                                                     SHOPRO    219
  305 FC(1,J,I) = FC(2,J,I)                                              SHOPRO    220
      DO 310 L=1,NTOT2                                                   SHOPRO    221
      JNDL(1,L) = JNDL(2,L)                                              SHOPRO    222
  310 JNDR(1,L) = JNDR(2,L)                                              SHOPRO    223
      FX(2,1)=DUM1                                                       SHOPRO    224
      FR(2,1)=DUM2                                                       SHOPRO    225
      FPHI(2,1)=DUM3                                                     SHOPRO    226
      FP(2,1)=DUM4                                                       SHOPRO    227
      FT(2,1)=DUM5                                                       SHOPRO    228
      FU(2,1)=DUM6                                                       SHOPRO    229
      JNDL(2,1)=IDUM1                                                    SHOPRO    230
      JNDR(2,1)=IDUM2                                                    SHOPRO    231
      DO 1704 I=1,NDS                                                    SHOPRO    232
       FC(2,1,I)=CDUM(I)                                                 SHOPRO    233
 1704  CONTINUE                                                          SHOPRO    234
      NSTRM(1) = NSTRM(2)                                                SHOPRO    235
      NTOT(1) = NTOT(2)                                                  SHOPRO    236
      GO TO 151                                                          SHOPRO    237
C     NON-UNIFORM FLOW WITH ANALYTICAL COEFFICIENTS                      SHOPRO    238
  400 IF (IIN) 420,410,420                                               SHOPRO    239
  410 READ (5,411) THETOO,RHOE,POE,TOE,REX,NEND,NEMD,NENT,NEMT,NENP,NEMP SHOPRO    240
  411 FORMAT (5E12.6,6I3)                                                SHOPRO    241
      DO 412 I=1,NEND                                                    SHOPRO    242
      READ (5,419) (ARHO(I,J), J=1,NEMD)                                 SHOPRO    243
  412 CONTINUE                                                           SHOPRO    244
      DO 413 I=1,NENT                                                    SHOPRO    245
      READ (5,419) (ATHET(I,J), J=1,NEMT)                                SHOPRO    246
  413 CONTINUE                                                           SHOPRO    247
      DO 414 I=1,NENP                                                    SHOPRO    248
      READ (5,419) (AP(I,J), J=1,NEMP)                                   SHOPRO    249
  414 CONTINUE                                                           SHOPRO    250
      SMW=0.0                                                            SHOPRO    251
      DO 415 I=1,NDS                                                     SHOPRO    252
  415 SMW=SMW+MW(I)*COO(I)                                               SHOPRO    253
      RHOO=SMW*POE/(RV*TOE)                                              SHOPRO    254
      IIN=1                                                              SHOPRO    255
      THT=THETOO-0.5*PI                                                  SHOPRO    256
      XOE= REX*TAN(THT)                                                  SHOPRO    257
  418 FORMAT (6E12.5)                                                    SHOPRO    258
  419 FORMAT (6E12.6)                                                    SHOPRO    259
  420 ETA=REX/SQRT(RTRY**2+(XTRY-XOE)**2)                                SHOPRO    260
      IF (XTRY-XOE) 421,422,423                                          SHOPRO    261
  421 THETA=PI-ATAN(RTRY/(XOE-XTRY))                                     SHOPRO    262
      GO TO 424                                                          SHOPRO    263
  422 THETA=0.5*PI                                                       SHOPRO    264
                                                                         SHOPRO    265
  423 THETA=ATAN(RTRY/(XTRY-XOE))                                        SHOPRO    266
  424 CP=0.0                                                             SHOPRO    267
      DO 425 I=1,NDS                                                     SHOPRO    268
      CSH1(I)=COO(I)                                                     SHOPRO    269
  425 CP=CP+A(I,3)*COO(I)                                                SHOPRO    270
      GAM=CP/(CP-RCON/SMW)                                               SHOPRO    271
      SUMRHO=0.0                                                         SHOPRO    272
      SUMPHI=0.0                                                         SHOPRO    273
      SUMP=0.0                                                           SHOPRO    274
      DO 430 I=1,NEND                                                    SHOPRO    275
      DO 430 J=1,NEMD                                                    SHOPRO    276
  430 SUMRHO=SUMRHO+ARHO(I,J)*ETA**(J-1)*COS(PI*(FLOAT(I)-0.5)*THETA/    SHOPRO    277
     *THETOO)                                                            SHOPRO    278
      DO 435 I=1,NENT                                                    SHOPRO    279
      DO 435 J=1,NEMT                                                    SHOPRO    280
  435 SUMPHI=SUMPHI+ATHET(I,J)*ETA**(J-1)*COS(.5*PI*(FLOAT(2)-.5)*THETA/ SHOPRO    281
     *THETOO)                                                            SHOPRO    282
      DO 440 I=1,NENP                                                    SHOPRO    283
      DO 440 J=1,NEMP                                                    SHOPRO    284
  440 SUMP=SUMP+AP(I,J)*ETA**(J-1)*COS(.5*PI*(FLOAT(I)-.5)*THETA/THETOO) SHOPRO    285
      RHOSH=RHOE*ETA**2*SUMRHO**(2./(GAM-1.))                            SHOPRO    286
      PHISH1=THETA*(1.+ETA*SUMPHI)                                       SHOPRO    287
      POSH=POE*(1.+ETA*SUMPHI)                                           SHOPRO    288
      RHOOSH=POSH*SMW/(RV*TOE)                                           SHOPRO    289
      PSH1=(RHOSH/RHOOSH)**GAM*POSH                                      SHOPRO    290
      TSH1=PSH1*SMW/(RV*RHOSH)                                           SHOPRO    291
      USH1=SQRT(2.*HJ*CP*(TOE-TSH1))                                     SHOPRO    292
10000 RETURN                                                             SHOPRO    293
 9999 WRITE (6,9998)                                                     SHOPRO    294
      CALL PDUMP(A(1,1),N,5)                                             SHOPRO    295
 9998 FORMAT ( 16H ERROR IN SHOPRO)                                      SHOPRO    296
    5 FORMAT(2X,4I4,14HI9 L JNDL JNDR)                                   SHOPRO    297
    3 FORMAT(2X,9HSTATE 157)                                             SHOPRO    298
    2 FORMAT(2X,9HSTATE 175)                                             SHOPRO    299
    1 FORMAT(2X,9HSTATE 179)                                             SHOPRO    300
 6999 WRITE(6,1802) R1,R3                                                SHOPRO    301
      WRITE(6,1502) XTRY,RTRY                                            SHOPRO    302
      WRITE(6,154) ICTSFC                                                SHOPRO    303
      WRITE(6,5) I9,L,JNDL(I9,L),JNDR(I9,L)                              SHOPRO    304
                       WRITE (6,163) L,FX(I9,J),FR(I9,J),FPHI(I9,J),     SHOPRO    305
     1FP(I9,J),FT(I9,J),FU(I9,J),JNDL(I9,L),JNDR(I9,L)                   SHOPRO    306
      WRITE(6,1922) R1,R3,L1,L2                                          SHOPRO    307
      WRITE(6,210) TSH1,PSH1,USH1,PHISH1                                 SHOPRO    308
      ENDFILE 13                                                         11AUG     124
      CALL EXIT                                                          SHOPRO    309
      END                                                                SHOPRO    310
      SUBROUTINE STABLE                                                  STABLE      2
C     THIS SUBROUTINE DETERMINES STABLE STEPPING DISTANCE AND PUNCHES    STABLE      3
C     OUTPUT DATA WHEN CALLED FOR                                        STABLE      4
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    STABLE      6
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         STABLE      7
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        STABLE      8
     * ,      MAP                                                        STABLE      9
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  STABLE     10
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          STABLE     11
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      STABLE     12
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       STABLE     13
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    STABLE     14
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      STABLE     15
     1 ,SUMP,SUMPV,SUMPE                                                 STABLE     16
      DIMENSION INDEX2(120)                                              STABLE     17
      COMMON/INTL/XLX,IKI,REX                                            STABLE     18
      DIMENSION CA(30)                                                   STABLE     19
      IF((ISB.EQ.-1).AND.(X2(2).EQ.XLX)) GO TO 1500                      STABLE     20
      IF (LL) 10,10,40                                                   STABLE     21
C     INDEXING                                                           STABLE     22
   10 IEXTRA(6)=0                                                        STABLE     23
      DO 20 I=1,KMAX                                                     STABLE     24
   20 INDEX2(I)=I                                                        STABLE     25
      MAX=KMAX+1                                                         STABLE     26
      DO 30 I=MAX,120                                                    STABLE     27
   30 INDEX2(I)=0                                                        STABLE     28
   40 K=2                                                                STABLE     29
      I=2                                                                STABLE     30
      IF (KMN.GT.1) I=1                                                  STABLE     31
      DELS=1.0E10                                                        STABLE     32
   45 IF (IEXTRA(5)-LPLANE) 50,50,90                                     STABLE     33
   50 IF (INDEX2(I)) 75,90,90                                            STABLE     34
   75 I=I+1                                                              STABLE     35
      GO TO 50                                                           STABLE     36
C     VISCOUS STABILITY CRITERION                                        STABLE     37
   90 DEL1=DELY(K)*RE(K)/2.0                                             STABLE     38
C     INERTIAL STABILITY CRITERION                                       STABLE     39
      IF (KMN.LE.1) GO TO 101                                            STABLE     40
C     CARD OMITTED                                                       STABLE     41
      IF (K.GT.KMN) GO TO 101                                            STABLE     42
      IF (LL.NE.0) GO TO 61                                              STABLE     43
      R2(K)=R(K)                                                         STABLE     44
      Y2(K)=Y(K)                                                         STABLE     45
      X2(K)=X(K)                                                         STABLE     46
      PHI2(K)=PHI(K)                                                     STABLE     47
      U2(K)=U(K)                                                         STABLE     48
      P2(K)=P(K)                                                         STABLE     49
      T2(K)=T(K)                                                         STABLE     50
      RHO2(K)=RHO(K)                                                     STABLE     51
      R(1)=0.0                                                           STABLE     52
      R2(1)=0.0                                                          STABLE     53
      Y(1)=0.0                                                           STABLE     54
      Y2(1)=0.0                                                          STABLE     55
      DO 112 I=1,NDS                                                     STABLE     56
  112 C2(I,K)=C(I,K)                                                     STABLE     57
   61 KMNN=KMN+1                                                         STABLE     58
      AMAK=MA(KMNN)                                                      STABLE     59
  51  IF(AMAK-1.0-EPSLON) 100,100,601                                    STABLE     60
  101 IF(MA(K)-1.0-EPSLON) 110,110,600                                   STABLE     61
  100 WRITE(6,501) AMAK                                                  STABLE     62
  501 FORMAT(/*AMAK=*,E12.5)                                             STABLE     63
      AMAK=1.0+EPSLON                                                    STABLE     64
  601 DEL2=0.5*DELY(K)*(AMAK**2-1.0)**(0.5)                              STABLE     65
      GO TO 750                                                          STABLE     66
  110 WRITE(6,502) K,MA(K)                                               STABLE     67
  502 FORMAT(/*K=*,I2,5X,*M=*,E12.5)                                     STABLE     68
      MA(K)=1.0+EPSLON                                                   STABLE     69
  600 DEL2=.5*DELY(K)*(MA(K)**2-1.0)**(.5)                               STABLE     70
  750 CONTINUE                                                           STABLE     71
      IF (DEL1.EQ.0.0)  GO TO 590                                        STABLE     72
      DELSS(K)=ALPHAH/(1.0/DEL1+1.0/DEL2)                                STABLE     73
      GO TO 595                                                          STABLE     74
  590 DELSS(K)=ALPHAH*DEL2                                               STABLE     75
  595 CONTINUE                                                           STABLE     76
      IF((ISB.EQ.1).AND.(K.LE.3)) GO TO 690                              STABLE     77
C     COMBINING SMALL TUBES                                              STABLE     78
      IF (LL) 608,602,602                                                STABLE     79
  602 FL=LL                                                              STABLE     80
      FPLANE=LPLANE                                                      STABLE     81
      FMULT=FL/FPLANE                                                    STABLE     82
      GSTEP=FSTEP                                                        STABLE     83
      IF (EXTRA(4).LT.1.E-5) GO TO 604                                   STABLE     84
       FSTEP=GSTEP-(GSTEP-EXTRA(3))*(1.-FMULT)/EXTRA(4)                  STABLE     85
      GO TO 608                                                          STABLE     86
  604 FSTEP=GSTEP                                                        STABLE     87
  608 L=K                                                                STABLE     88
      CALL COMBO(L)                                                      STABLE     89
      FSTEP=GSTEP                                                        STABLE     90
      IF (L-K) 610,690,620                                               STABLE     91
  610 K=L                                                                STABLE     92
      IF (IEXTRA(5)-LPLANE) 630,630,90                                   STABLE     93
  620 K=L-1                                                              STABLE     94
      I=I+1                                                              STABLE     95
      IF (IEXTRA(5)-LPLANE) 630,630,90                                   STABLE     96
  630 IJ=I                                                               STABLE     97
  640 IJ=IJ-1                                                            STABLE     98
      IF (INDEX2(IJ)) 640,650,650                                        STABLE     99
  650 INDEX2(IJ)=-1                                                      STABLE    100
      IEXTRA(6)=IEXTRA(6)+1                                              STABLE    101
      GO TO 50                                                           STABLE    102
C     AREA CHANGE LIMITATION                                             STABLE    103
  690 DLNA=(SIN(.5*(PHI(K)+PHI(K-1)))/(.5*(R(K)+R(K-1)))*DELTA+(PHI(K)-  STABLE    104
     *PHI(K-1))/DELY(K))*DELSS(K)                                        STABLE    105
      IF (ABS(DLNA)-ATOL)  800,800,700                                   STABLE    106
  700 DELSS(K)=DELSS(K)*ATOL/ABS(DLNA)                                   STABLE    107
  800 IF (DELSS(K)-DELS) 900,1000,1000                                   STABLE    108
  900 IF((ISB.EQ.1).AND.(K.LE.3)) GO TO 1000                             STABLE    109
      DELS=DELSS(K)                                                      STABLE    110
      IEXTRA(7)=K                                                        STABLE    111
 1000 IF (IEXTRA(5)-LPLANE) 1025,1025,1050                               STABLE    112
 1025 INDEX2(I)=K                                                        STABLE    113
      IEXTRA(8)=I                                                        STABLE    114
      I=I+1                                                              STABLE    115
 1050 K=K+1                                                              STABLE    116
      IF (K-KMAX) 45,45,1055                                             STABLE    117
 1055 IF (KMAX-28) 1057,1057,1060                                        STABLE    118
C     COMBINING SMALLEST TUBE WHEN NUMBER OF TUBES GETS TOO LARGE        STABLE    119
 1057 ITUBE=FSTEP                                                        STABLE    120
      IF (KMAX-ITUBE) 1400,1400,1060                                     STABLE    121
 1060 L=IEXTRA(7)                                                        STABLE    122
      K=L                                                                STABLE    123
      STORE1=GRAD                                                        STABLE    124
      STORE2=FSTEP                                                       STABLE    125
      STORE3=Y(KMAX)                                                     STABLE    126
      GRAD=10.**10                                                       STABLE    127
      FSTEP=10.**(-10)                                                   STABLE    128
      Y(KMAX)=10.**20                                                    STABLE    129
      CALL COMBO(L)                                                      STABLE    130
      GRAD=STORE1                                                        STABLE    131
      FSTEP=STORE2                                                       STABLE    132
      Y(KMAX)=STORE3                                                     STABLE    133
      K=KMAX+1                                                           STABLE    134
 1063 IF (IEXTRA(5)-LPLANE) 1065,1065,2000                               STABLE    135
 1065 IF (L-IEXTRA(7)) 1085,1080,1080                                    STABLE    136
 1080 I=IEXTRA(8)                                                        STABLE    137
      GO TO 1090                                                         STABLE    138
 1085 I=IEXTRA(8)-1                                                      STABLE    139
 1090 IEXTRA(6)=IEXTRA(6)+1                                              STABLE    140
      JMAX=KMAX+IEXTRA(6)                                                STABLE    141
      JMIN=I+1                                                           STABLE    142
      J=JMAX                                                             STABLE    143
 1095 INDEX2(J)=INDEX2(J-1)                                              STABLE    144
      J=J-1                                                              STABLE    145
      IF (J-JMIN) 1097,1095,1095                                         STABLE    146
 1097 INDEX2(I)=-1                                                       STABLE    147
 1400 IF (IEXTRA(5).GT.LPLANE) GO TO 2000                                STABLE    148
      IF (X2(2).LT. XLX) GO TO 2000                                      STABLE    149
      IF  (X2(2).EQ. XLX) GO TO 1500                                     STABLE    150
      IF (MOD(LL,IEXTRA(5))) 2000,1500,2000                              STABLE    151
C     PUNCHING OUTPUT CARDS                                              STABLE    152
 1500 I=1                                                                STABLE    153
      P(1)=P(2)                                                          STABLE    154
      T(1)=T(2)                                                          STABLE    155
      U(1)=U(2)                                                          STABLE    156
      DO 1550 N=1,NDS                                                    STABLE    157
 1550 C(N,1)=C(N,2)                                                      STABLE    158
      NDDP=NDS                                                           STABLE    159
      IF(IPART.EQ.2) NDDP=NDS+1                                          STABLE    160
      IF(IPART.EQ.2) C(NDDP,1)=0.                                        STABLE    161
      IF(IKI.EQ.9)INT=1                                                  STABLE    162
      WRITE(6,1650) IKI,MMAX,LL,X(I)                                     11AUG     125
 1650 FORMAT(6X,4HIKI=,I4,4X,5HMMAX=,I4,4X,3HLL=,I5,4X,5HX(1)=,E10.4)    11AUG     126
      IF(INT.EQ.0.OR.IKI.NE.0)                                           STABLE    165
     *WRITE(10,1600) X(I),R(I),PHI(I),P(I),T(I),U(I),I,I                 STABLE    166
      IF(ISB.LT.0)                                                       STABLE    167
     * WRITE(3,1600) X(I),R(I),PHI(I),P(I),T(I),U(I),I,I                 STABLE    168
 1600 FORMAT(6E12.5,2I4)                                                 STABLE    169
      IF(INT.EQ.0.OR.IKI.NE.0)                                           STABLE    170
     *WRITE(10,1700) (C(J,I),J=1,NDDP)                                   STABLE    171
      IF(ISB.LT.0)                                                       STABLE    172
     *WRITE( 3,1700) (C(J,I),J=1,NDDP)                                   STABLE    173
 1700 FORMAT(8E10.3)                                                     STABLE    174
      KMXX=KMAX+IEXTRA(6)                                                STABLE    175
      IF (IPART.LE.1) GO TO 1802                                         STABLE    176
      KBAO=KMAX-1                                                        STABLE    177
      DO 1701 I=2,KBAO                                                   STABLE    178
      XMV=0.0                                                            STABLE    179
      XM=0.0                                                             STABLE    180
      XMM=0.0                                                            STABLE    181
      XMVV=0.                                                            STABLE    182
      RHTT=0.0                                                           STABLE    183
      EU=0.0                                                             STABLE    184
      EE=0.0                                                             STABLE    185
      II=I+1                                                             STABLE    186
      DO 31 J=1,NPG                                                      STABLE    187
      XM=XM+RHP2(II,J)*W2(II,J)**2                                       STABLE    188
      XMM=XMM+RHP2(II,J)*(W2(II,J)+V2(II,J))                             STABLE    189
      XMV=XMV+RHP2(II,J)*V2(II,J)**2                                     STABLE    190
      XMVV=XMVV+RHP2(II,J)*V2(II,J)                                      STABLE    191
      EU=EU+RHP2(II,J)*(W2(II,J)**3/2.0+V2(II,J)**3/2.0)                 STABLE    192
      RHTT=RHTT+RHP2(II,J)                                               STABLE    193
   31 EE=EE+RHP2(II,J)*TP2(II,J)*CS*(W2(II,J)    +V2(II,J)  )            STABLE    194
      CW=XM+XMV+RHO(I)*U(I)**2                                           STABLE    195
      AW=XMM-XMVV+RHO(I)*U(I)                                            STABLE    196
      BW=XMVV                                                            STABLE    197
      UP=CW*AW/(AW**2+BW**2)                                             STABLE    198
      VP=BW*CW/(AW**2+BW**2)                                             STABLE    199
      RHOP=(AW**2+BW**2)/CW                                              STABLE    200
      HP=(RHO(I)*U(I)*(H(I)+U(I)**2/(2.*HJ))+EU/HJ+EE)/(AW+BW)-.5/HJ*(CW STABLE    201
     C**2/(AW**2+BW**2)-CW**2*AW*BW/(AW**2+BW**2)**2)                    STABLE    202
      PHIA=PHI(I)+ATAN(VP/UP)                                            STABLE    203
      UA=SQRT(UP**2+VP**2)                                               STABLE    204
      RHTOT=RHO (I)+RHTT                                                 STABLE    205
      WRITE(6,202) UP,VP,RHOP,HP,RHTOT,RHTT                              STABLE    206
  202 FORMAT(6E12.5)                                                     STABLE    207
      NDSP=NDS+NPG                                                       STABLE    208
      NDDP=NDS+1                                                         STABLE    209
      DO 102 J=NDDP,NDSP                                                 STABLE    210
      JJ=J-NDS                                                           STABLE    211
  102 CA(J)=RHP2(II,JJ)/RHTOT                                            STABLE    212
      DO 103 J=1,NDS                                                     STABLE    213
  103 CA(J)=C(J,I)*RHO(I)/RHTOT                                          STABLE    214
      TL=ABS(1.E-3*HP)                                                   STABLE    215
      TA=T(I)                                                            STABLE    216
      DO 104 IT=1,100                                                    STABLE    217
      HA=0.0                                                             STABLE    218
      DGH=0.0                                                            STABLE    219
      DO 105 J=1,NDS                                                     STABLE    220
      DO 105 JJ=1,NN                                                     STABLE    221
      HA=HA+A(J,JJ)*TA**(JJ-2)*CA(J)                                     STABLE    222
  105 DGH=DGH+A(J,JJ)*FLOAT(JJ-2)*TA**(JJ-3)*CA(J)                       STABLE    223
      HPP=0.0                                                            STABLE    224
      DHP=0.0                                                            STABLE    225
      DO 106 J=NDDP,NDSP                                                 STABLE    226
      HPP=HPP+CS*TA*CA(J)                                                STABLE    227
  106 DHP=DHP+CS*CA(J)                                                   STABLE    228
      G=HA+HPP-HP                                                        STABLE    229
      IF (ABS(G) .LT. TL) GO TO 107                                      STABLE    230
      DG=DHP+DGH                                                         STABLE    231
      TA=TA-G/DG                                                         STABLE    232
  104 CONTINUE                                                           STABLE    233
      WRITE (6,108) IT,HA,HPP,DGH,DHP                                    STABLE    234
  108 FORMAT(8X,50HITERATION DOES NOT CONVERGE TO CORRECT TEMPERATURE  , STABLE    235
     1  I4,2X,4HHA= ,1PE10.3,5X,4HHPP=,E10.3,5X,4HDGH=,E10.3,5X,4HDHP=,  STABLE    236
     2 E10.3)                                                            STABLE    237
  107 CONTINUE                                                           STABLE    238
      ZMW=0.0                                                            STABLE    239
      DO 109 J=1,NDS                                                     STABLE    240
  109 ZMW=ZMW+CA(J)/MW(J)                                                STABLE    241
      PA=RHTOT*RV*TA*ZMW                                                 STABLE    242
      NDDD=NDDP+1                                                        STABLE    243
      DO 120 J =NDDD,NDSP                                                STABLE    244
  120 CA(NDDP)=CA(NDDP)+CA (J)                                           STABLE    245
      IF(INT.EQ.0.OR.IKI.NE.0)                                           STABLE    246
     *WRITE(10,1600)X(I),R(I),PHIA,PA,TA,UA,I,I                          STABLE    247
      IF(INT.EQ.0.OR.IKI.NE.0)                                           STABLE    248
     *WRITE(10,1700)(CA(J),J=1,NDDP)                                     STABLE    249
 1701 CONTINUE                                                           STABLE    250
      GO TO 1960                                                         STABLE    251
 1802 KCHU=KMXX-1                                                        STABLE    252
      IF(IEXTRA(6).EQ.0) KCHU=KMXX                                       18JUNE     20
      DO 1950 I=2,KCHU                                                   STABLE    253
      IF (INDEX2(I)) 1800,1800,1850                                      STABLE    254
 1800 JJ=I                                                               STABLE    255
 1825 JJ=JJ+1                                                            STABLE    256
      II=INDEX2(JJ)                                                      STABLE    257
      IF(II) 1860,1860,1900                                              STABLE    258
 1860 IF((KMAX.EQ.28).AND.(INDEX2(JJ+1).EQ.0)) GO TO 1960                STABLE    259
      GO TO 1825                                                         STABLE    260
 1850 II=INDEX2(I)                                                       STABLE    261
 1900 IF(INT.EQ.0.OR.IKI.NE.0)                                           STABLE    262
     *WRITE(10,1600) X(II),R(II),PHI(II),P(II),T(II),U(II),I,INDEX2(I)   STABLE    263
      IF (ISB.LT.0)                                                      STABLE    264
     * WRITE(3,1600) X(II),R(II),PHI(II),P(II),T(II),U(II),I,INDEX2(I)   STABLE    265
      IF(INT.EQ.0.OR.IKI.NE.0)                                           STABLE    266
     *WRITE(10,1700)(C(J,II),J=1,NDS)                                    STABLE    267
      IF (ISB.LT.0)                                                      STABLE    268
     * WRITE(3,1700)(C(J,II),J=1,NDS)                                    STABLE    269
 1950 CONTINUE                                                           STABLE    270
 1960 IEXTRA(6)=0                                                        STABLE    271
      DO 1970 I=2,KMAX                                                   STABLE    272
 1970 INDEX2(I)=I                                                        STABLE    273
      MAX=KMAX+1                                                         STABLE    274
      DO 1980 I=MAX,120                                                  STABLE    275
 1980 INDEX2(I)=0                                                        STABLE    276
 2000 RETURN                                                             STABLE    277
      DO 2200 K=2,KMAX                                                   STABLE    278
      WRITE (6,2100) DELSS(K)                                            STABLE    279
 2100 FORMAT (7H DELSS=,E11.4)                                           STABLE    280
 2200 CONTINUE                                                           STABLE    281
      RETURN                                                             STABLE    282
      END                                                                STABLE    283
      SUBROUTINE SLDP(X,A,N)                                             SLDP        2
C     THIS PROGRAM FINDS THE SOLUTIONS TO A SET OF N SIMULTANEOUS LINEAR SLDP        3
C     EQUATIONS BY USING THE GAUSS-GORDAN REDUCTION ALGORITHM WITH THE   SLDP        4
C      DIAGONAL PIVOT STRATEGY                                           SLDP        5
      DIMENSION A(21,21),X(21)                                           SLDP        6
      DO 9 K=1,N                                                         SLDP        7
      IF (ABS(A(K,K)) .GT. 1.E-10) GO TO 5                               SLDP        8
      WRITE (6,101)   K,A(K,K)                                           SLDP        9
      DO 10 IR=1,N                                                       SLDP       10
      WRITE(6,100)(A(IR,JR),JR=1,N),X(IR)                                SLDP       11
   10 CONTINUE                                                           SLDP       12
  100 FORMAT(1X,     10E12.3)                                            SLDP       13
  101 FORMAT(22H ERROR--- SMALL PIVOT  ,I5,  E12.5)                      SLDP       14
      STOP                                                               SLDP       15
    5 KP1= K+1                                                           SLDP       16
      DO 6 J= KP1, N                                                     SLDP       17
    6 A(K,J)= A(K,J)/A(K,K)                                              SLDP       18
      X(K)= X(K)/A(K,K)                                                  SLDP       19
      A(K,K)= 1.0                                                        SLDP       20
      DO 9 I=1,N                                                         SLDP       21
      IF (I.EQ.K .OR. A(I,K).EQ.0.) GO TO 9                              SLDP       22
      DO 8 J=KP1,N                                                       SLDP       23
    8 A(I,J)= A(I,J)- A(I,K)*A(K,J)                                      SLDP       24
      X(I)= X(I)- A(I,K)*X(K)                                            SLDP       25
      A(I,K)=0.                                                          SLDP       26
    9 CONTINUE                                                           SLDP       27
      RETURN                                                             SLDP       28
      END                                                                SLDP       29
      SUBROUTINE STEP                                                    STEP        2
C     THIS SUBROUTINE CALCULATES STATE PROPERTIES IN A STREAMTUBE        STEP        3
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    STEP        5
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         STEP        6
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        STEP        7
     * ,      MAP                                                        STEP        8
      REAL MASSMD,L1,L2                                                  STEP        9
      COMMON/PT1/XMOMV(8), XMOMP(8),ENEP1(8),REP(30,8),V(30,8),W(30,8),  STEP       10
     1V2(30,8), W2(30,8), TRBDY(8), TP(30,8), TP2(30,8), RP(8),          STEP       11
     2RHP(30,8), RHP2(30,8) ,ENEP2(8),NBL(8),UM(30)                      STEP       12
     3,VOLP(8),WTP(8),HC(8),DENG(30,8),ICOND(30,8)                       STEP       13
      COMMON/PT2/FFF,FFG,GAMA,UMI,PQ,NPG,KMX,DNDSP(8)                    STEP       14
       COMMON/PT3/CL,CS,TPS,RHSS,WT,HTRAN,SIG,EP,IPART,IKINE,TR(30)      STEP       15
     1 ,SUMP,SUMPV,SUMPE                                                 STEP       16
      COMMON/TURPLE/DEL2,CPSHW,GAMSHW,ZMWSH1                             STEP       17
      COMMON/CHEM1/ ZID(5), IRR(30),IRT(30),RC(30,3),IRRR(30,5),         STEP       18
     1 AV,CM(21,21),FI(21),WP(21),                                       STEP       19
     2 WM(21),WDOT(21,30),CSI(21),QX(21)                                 STEP       20
      COMMON/DSL/RDSL,PHDSL                                              STEP       21
      COMMON/SUB/XDIS,L1,L2,PHIO,RSTAR,RMD,MASSMD,RNOZ,THTP,THRU         STEP       22
      INTEGER THRU                                                       STEP       23
      DIMENSION ZAO(25)                                                  STEP       24
      EQUIVALENCE (IVISC,IEXTRA(1))                                      STEP       25
      EQUIVALENCE (KALARM,IEXTRA(20))                                    STEP       26
C     EVALUATION OF TRANSPORT TERMS                                      STEP       27
      IF (IVISC) 50,50,200                                               STEP       28
   50 RHSMOM=0.0                                                         STEP       29
      RHSEN=0.0                                                          STEP       30
      DO 100 I=1,NDS                                                     STEP       31
  100 RHS(I)=0.0                                                         STEP       32
      IF (IFLAG) 125,150,125                                             STEP       33
  125 UBAR(K)=U2(K)                                                      STEP       34
      GO TO 300                                                          STEP       35
  150 UBAR(K)=U(K)                                                       STEP       36
      GO TO 300                                                          STEP       37
  200 CALL VISCO                                                         STEP       38
      IF (K.LT.KMAX) GO TO 250                                           STEP       39
      TBBAR=TABAR                                                        STEP       40
      PBBAR=PABAR                                                        STEP       41
      DO 225 I=1,NDS                                                     STEP       42
  225 XBBAR(I)=XABAR(I)                                                  STEP       43
  250 CONTINUE                                                           STEP       44
  300 AOLD=PI*(R(K)+R(K-1))**DELTA*(Y(K)-Y(K-1))                         STEP       45
      ABAR=.5*(AA(K)+AOLD)                                               STEP       46
C     CARD OMITTED                                                       STEP       47
C     CARD OMITTED                                                       STEP       48
C     CARD OMITTED                                                       STEP       49
  310 IF(T2(K).LT.400.) GO TO 350                                        STEP       50
      IF(IKINE.NE.0.AND.IFLAG.EQ.1) GO TO 401                            STEP       51
      IF (IKINE.NE.0.AND.IFLAG.EQ.1.AND.ISB.EQ.1) GO TO 401              18JUNE     21
  350 DO 400 I=1,NDS                                                     STEP       52
      WDOT(I,K)=0.                                                       21OCT       6
  400 C2(I,K)=C(I,K)+RHS(I)/MDOT(K)                                      STEP       53
      GO TO 402                                                          STEP       54
  401 CALL CHEM(IKINE)                                                   STEP       55
  402 CONTINUE                                                           STEP       56
      DO403 I=1,NDS                                                      STEP       57
      IF(C2(I,K)) 404,403,403                                            STEP       58
  403 CONTINUE                                                           STEP       59
      GO TO 405                                                          STEP       60
  404 DELS=DELS*.5                                                       STEP       61
      ICOUNT=ICOUNT+1                                                    STEP       62
      KALARM=2                                                           STEP       63
      GO TO 10000                                                        STEP       64
  405 ZMW=0.0                                                            STEP       65
      DO 500 I=1,NDS                                                     STEP       66
  500 ZMW=ZMW+C2(I,K)/MW(I)                                              STEP       67
      ZMW=1.0/ZMW                                                        STEP       68
      ZMWK(K)=ZMW                                                        STEP       69
      DO 600 J=1,NN                                                      STEP       70
      ZA(J)=0.0                                                          STEP       71
      ZAO(J)=0.                                                          STEP       72
      DO 600 I=1,NDS                                                     STEP       73
      ZAO(J)=ZAO(J)+A(I,J)*C(I,K)                                        STEP       74
  600 ZA(J)=ZA(J)+A(I,J)*C2(I,K)                                         STEP       75
      ITER=0                                                             STEP       76
  700 US=UBAR(K)                                                         STEP       77
      CP=0.0                                                             STEP       80
      CPOLD=0.                                                           STEP       81
      DO 702 J=1,NN                                                      STEP       82
      CPOLD=CPOLD+FLOAT(J-2)*ZAO(J)*T(K)**(J-3)                          STEP       83
  702 CP=CP+ZA(J)*FLOAT(J-2)*T   (K)**(J-3)                              STEP       84
  707 B1=(RHSMOM+MDOT(K)*U(K))/(BETAP*ABAR)+P(K)                         STEP       85
      B1= B1-DLS(K)*SUMP/BETAP                                           STEP       86
      B2=MDOT(K)/(BETAP*ABAR)                                            STEP       87
  706 B3=ZMW*AA(K)/RV/MDOT(K)                                            STEP       88
  703 IF((MA(K).LE.1.002).AND.(K.GT.KMN)) GO TO 1400                     STEP       89
  704 IF(ICONST.NE.0) GO TO 800                                          STEP       90
C     CARD OMITTED                                                       STEP       91
C     CONSTANT GAMMA                                                     STEP       92
  710 B5=HJ*CP*B3*B1                                                     STEP       93
      B6=2.0*HJ*CP*B3*B2-1.0                                             STEP       94
      B4=U(K)**2+2.0*HJ*(RHSEN/MDOT(K)+CPOLD*T(K)+ZAO(2)-ZA(2))          STEP       95
      B4=B4+SUMPE*ABAR*DLS(K)/MDOT(K)                                    STEP       96
      DISCR=B5**2-B6*B4                                                  STEP       97
      IF (DISCR) 730,750,750                                             STEP       98
  730 IF (ICOUNT-9) 740,740,9400                                         STEP       99
  740 ICOUNT=ICOUNT+1                                                    STEP      100
      DELS=DELS/2.0                                                      STEP      101
      KALARM=2                                                           STEP      102
      GO TO 10000                                                        STEP      103
  750 US=(B5+SQRT(DISCR))/B6                                             STEP      104
      GO TO 1200                                                         STEP      105
C     VARIABLE HEAT CAPACITY                                             STEP      106
  800 ITER=ITER+1                                                        STEP      107
      B4=2.0*HJ*RHSEN/MDOT(K)+2.0*HJ*H(K)+U(K)**2                        STEP      108
      B4=B4+SUMPE*ABAR*DLS(K)/MDOT(K)                                    STEP      109
      DUM1=0.0                                                           STEP      110
      DUM2=0.0                                                           STEP      111
      DO 900 I=1,NN                                                      STEP      112
      DUM1=DUM1+ZA(I)*(B3*(B1-B2*US)*US)**(I-2)                          STEP      113
  900 DUM2=DUM2+ZA(I)*FLOAT(I-2)*   (B1*US-B2*US**2) **(I-3)*B3**(I-2)   STEP      114
      G=2.0*HJ*DUM1+US**2-B4                                             STEP      115
      DGDU=2.0*US+2.0*HJ*DUM2*(B1-2.0*B2*US)                             STEP      116
      DELTAU=-G/DGDU                                                     STEP      117
      IF (ABS(DELTAU/US)-TOL) 1200,1000,1000                             STEP      118
 1000 IF (ITER-NITER) 1100,1010,1010                                     STEP      119
 1010 IF(ICOUNT-9) 1020,1020,9700                                        STEP      120
 9700 IF((K.GT.2).OR.(MA(2).LT.0.9)) GO TO 9500                          STEP      121
 9800 CONTINUE                                                           18JUNE     22
      WRITE(6,9706)                                                      STEP      134
 9706 FORMAT(/5X,*FLOW HAS CHOKED-GO TO FULL SUPERSONIC SOLUTION*)       STEP      135
      PHI2(2)=0.                                                         STEP      136
      DPHIDS(2)=0.                                                       18JUNE     23
      KMN=0                                                              STEP      138
      WRITE(6,9707) US                                                   STEP      139
 9707 FORMAT(/5X,*USOLD=*,E12.5)                                         STEP      140
      US=US*1.005/MA(2)                                                  18JUNE     24
      MA(2)=1.005                                                        18JUNE     25
      ICOUNT=0                                                           18JUNE     26
      ITER=0                                                             18JUNE     27
      AA(K)=AOLD                                                         18JUNE     28
      ABAR=AOLD                                                          18JUNE     29
      R2(K)=R(K)                                                         18JUNE     30
      PHI(K)=0.                                                          18JUNE     31
      Y2(K)=Y(K)                                                         18JUNE     32
      WRITE(6,9865) US,X2(1)                                             18JUNE     33
 9865 FORMAT(5X,3HUS=,E12.5,6X,2HX=,E12.5)                               11AUG     127
      GO TO 707                                                          STEP      142
 1020 ICOUNT=ICOUNT+1                                                    STEP      143
      KALARM=2                                                           STEP      144
      DELS=DELS/2.0                                                      STEP      145
      GO TO 10000                                                        STEP      146
 1100 US=US+DELTAU                                                       STEP      147
      GO TO 800                                                          STEP      148
 1200 U2(K)=US                                                           STEP      149
      P2(K)=B1-B2*US                                                     STEP      150
      IF((IFLAG.EQ.1).AND.(K.EQ.KMN+1)) DELTAP=P2(K)-P(K)                STEP      151
      T2(K)=B3*P2(K)*US                                                  STEP      152
 1300 RHO2(K)=ZMW*P2(K)/(RV*T2(K))                                       STEP      153
      IF (P2(K)) 1301,1301,1304                                          STEP      154
 1301 IF (ICOUNT.LT.9) GO TO 1020                                        STEP      155
      WRITE (6,1302)                                                     STEP      156
 1302 FORMAT(26H1 PRESSURE BECAME NEGATIVE)                              STEP      157
 1303 CALL PDUMP(A(1,1),N,1)                                             STEP      158
      CALL EXIT                                                          STEP      159
 1304 IF (T2(K)) 1305,1305,1307                                          STEP      160
 1305 IF (ICOUNT.LT.9) GO TO 1020                                        STEP      161
      WRITE (6,1306)                                                     STEP      162
 1306 FORMAT(29H1 TEMPERATURE BECAME NEGATIVE)                           STEP      163
      GO TO 1303                                                         STEP      164
C     STREAMTUBE MACH AND REYNOLDS NUMBERS                               STEP      165
 1307 FMAX=1.0                                                           STEP      166
      IF (K.NE.KMAX) GO TO 1309                                          STEP      167
      MU2=MU                                                             STEP      168
      KAY2=KAY                                                           STEP      169
      DO 1308 I=1,NDS                                                    STEP      170
      D2EFF(I)=DEFF(I)                                                   STEP      171
      DO 1308 J=1,NDS                                                    STEP      172
      D2IH(I,J)=DIH(I,J)                                                 STEP      173
 1308 CONTINUE                                                           STEP      174
 1309 CP=0.                                                              STEP      175
      DO 1310 I=1,NN                                                     STEP      176
 1310 CP=CP+FLOAT(I-2)*ZA(I)*T2(K)**(I-3)                                STEP      177
      IF(K.EQ.2.AND.ISB.EQ.-1)                                           STEP      178
     1CPSHW=CP                                                           STEP      179
      IF (IVISC) 1315,1360,1315                                          STEP      180
 1315 IF (KAY2-MU2*CP) 1330,1330,1320                                    STEP      181
 1320 FMAX=KAY2/(CP*MU2)                                                 STEP      182
 1330 IF (MULT.NE.0.AND.XS(IBIG,K+1).GT.0.75) GO TO 1352                 STEP      183
      IMAX=NDS-1                                                         STEP      184
      DO 1350 I=1,IMAX                                                   STEP      185
      J=I                                                                STEP      186
 1335 J=J+1                                                              STEP      187
      IF (D2IH(I,J)*RHO2(K)/MU2-FMAX) 1345,1345,1340                     STEP      188
 1340 IF (MULT.NE.0.AND.XS(IBIG,K+1).GT.0.75) GO TO 1342                 STEP      189
      FMAX=D2IH(I,J)*RHO2(K)/MU2                                         STEP      190
      GO TO 1345                                                         STEP      191
 1342 FMAX=D2EFF(J)*RHO2(K)/MU2                                          STEP      192
 1345 IF (J.LT.NDS) GO TO 1335                                           STEP      193
 1350 CONTINUE                                                           STEP      194
      GO TO 1355                                                         STEP      195
 1352 DO 1353 I=1,NDS                                                    STEP      196
      IF (D2EFF(I)*RHO2(K)/MU2.GT.FMAX) FMAX=D2EFF(I)*RHO2(K)/MU2        STEP      197
 1353 CONTINUE                                                           STEP      198
 1355 CONTINUE                                                           STEP      199
      RE(K)=RHO2(K)*U2(K)*DELY(K)/(MU2*FMAX)                             STEP      200
 1360 MA(K)=U2(K)*SQRT((CP*ZMW-RCON)/(CP*T2(K)*RU))                      STEP      201
      IF((ISB.EQ.1).AND.(K.EQ.2)) WRITE(6,670) MA(K)                     STEP      202
      IF ((ISB.NE.1).OR.(K.NE.2).OR.(PAR(3).EQ.0.0)) GO TO 550           11AUG     128
      IPAR3=PAR(3)                                                       11AUG     129
      IF (MOD(LL,IPAR3).EQ.0) WRITE(6,555) X2(K),P2(K),U2(K),T2(K),      11AUG     130
     *CP,ZMW                                                             11AUG     131
  555 FORMAT(4X,2HX=,E11.4,4X,2HP=,E11.4,4X,2HU=,E11.4,4X,2HT=,E11.4,    11AUG     132
     *4X,3HCP=,E11.4,4X,4HZMW=,E11.4)                                    11AUG     133
  550 CONTINUE                                                           11AUG     134
  670 FORMAT(/5X,13HMACH NUMBER =,E12.5)                                 11AUG     135
      IF(KMN.EQ.0.AND.ISB.EQ.1.AND.MA(2).LT.1.1)  GO TO 7421             18JUNE     35
      IF(KMN.EQ.0.OR.K.GT.2) GO TO 7422                                  18JUNE     36
      IF (MA(2).LE.0.98.OR.IFLAG.EQ.0) GO TO 7422                        18JUNE     37
      GO TO 9800                                                         18JUNE     38
 7421 U2(2)=1.10*U2(2)/MA(2)                                             18JUNE     39
      MA(2)=1.1                                                          18JUNE     40
      Y2(K)=Y(K)                                                         18JUNE     41
      PHI(K)=0.                                                          18JUNE     42
      DPHIDS(2)=0.                                                       18JUNE     43
      PHI2(2)=0.                                                         18JUNE     44
      R2(K)=R(K)                                                         18JUNE     45
      ABAR=AOLD                                                          18JUNE     46
      AA(K)=AOLD                                                         18JUNE     47
 7422 CONTINUE                                                           18JUNE     48
      IF((ISB.EQ.1).AND.(K.EQ.2).AND.(MA(2).GE.1.0)) KMN=0               STEP      204
      GAMA=CP/(CP-RCON/ZMW )                                             STEP      205
      IF(K.EQ.2.AND.ISB.EQ.-1)                                           STEP      206
     1GAMSHW=GAMA                                                        STEP      207
      PQ= 4.0*GAMA/(9.*GAMA-5.0)                                         STEP      208
      GO TO 10000                                                        STEP      209
 1400 CONTINUE                                                           STEP      210
C     ERROR MESSAGES                                                     STEP      211
 9300 NUCASE=2250                                                        STEP      212
      GO TO 9900                                                         STEP      213
 9400 NUCASE=730                                                         STEP      214
      WRITE (6,8888) NUCASE                                              STEP      215
      GO TO 9900                                                         STEP      216
 9500 NUCASE=1010                                                        STEP      217
      WRITE (6,8888) NUCASE                                              STEP      218
 8888 FORMAT (1H1,15X,* ------------- NUCASE=*,I5//)                     STEP      219
 9900 IERROR=3                                                           STEP      220
10000 RETURN                                                             STEP      221
      END                                                                STEP      222
      SUBROUTINE TRANSP (TT,PP,KKK)                                      TRANSP      2
C     -- THIS SUBROUTINE CALCULATES THE TURBULENT TRANSPORT PROPERTIES - TRANSP      3
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    TRANSP      5
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         TRANSP      6
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        TRANSP      7
     * ,      MAP                                                        TRANSP      8
      COMMON/TURBUL/TLE,TPR,EDDYK,ITURB,DELMIX                           TRANSP      9
      COMMON/INPUX/ITD,X0,Y0,FRAC  ,KFL                                  TRANSP     10
      COMMON/PERGFF/PERGF                                                TRANSP     11
      KAY2=KAY                                                           TRANSP     12
      MU2=MU                                                             TRANSP     13
      D2IH(1,2)=DIH(1,2)                                                 TRANSP     14
      IF (KKK-2) 100,100,450                                             TRANSP     15
  100 IF (LL .LT. 0) GO TO 400                                           TRANSP     16
      IF (ITURB -2) 301,302,400                                          TRANSP     17
  302 PUMAX=RHO(2)*U(2)                                                  TRANSP     18
      PUMIN=RHO(2)*U(2)                                                  TRANSP     19
      DO 300 L=2,KMAX                                                    TRANSP     20
      TEST = RHO(L)*U(L)                                                 TRANSP     21
      IF (TEST .GT. PUMAX) GO TO 200                                     TRANSP     22
      IF (TEST .GE. PUMIN) GO TO 300                                     TRANSP     23
      PUMIN = TEST                                                       TRANSP     24
      GO TO  300                                                         TRANSP     25
  200 PUMAX=TEST                                                         TRANSP     26
  300 CONTINUE                                                           TRANSP     27
      DELMIX=Y(KMAX)                                                     TRANSP     28
      MU=         (DELMIX/EDDYK)*(PUMAX-PUMIN)    +.047896               TRANSP     29
      WRITE(6,11) PUMAX,PUMIN,DELMIX,MU,RHO(KMAX),U(KMAX),RHABAR         TRANSP     30
      GO TO 450                                                          TRANSP     31
  301 KMM=KMAX-1                                                         TRANSP     32
C     ----- DETERMINE DIVIDING STREAMLINE -----                          TRANSP     33
      TAWM=TAW(2)                                                        TRANSP     34
      KDSL=2                                                             TRANSP     35
      DO 800 IF=2,KMM                                                    TRANSP     36
      IF (ABS(TAW(IF+1)).LE.ABS(TAWM)) GO TO 800                         TRANSP     37
      KDSL=IF+1                                                          TRANSP     38
      TAWM=TAW(KDSL)                                                     TRANSP     39
  800 CONTINUE                                                           TRANSP     40
      RDV=R(KDSL)                                                        TRANSP     41
C     ----- COMPUTE DELMIX AND MU -----                                  TRANSP     42
      PERG=PERGF*ABS(TAWM)                                               TRANSP     43
      INN=2                                                              TRANSP     44
      DO 810 IF=3,KDSL                                                   TRANSP     45
      IF (ABS(TAW(IF)).LT.PERG) INN=IF                                   TRANSP     46
  810 CONTINUE                                                           TRANSP     47
      RINN=R(INN)                                                        TRANSP     48
      DELMIX=RDV-RINN                                                    TRANSP     49
      MU=0.5*DELMIX*RHO(KKK)*ABS(U(2)-U(KMAX))/EDDYK                     18JUNE     49
      IF(DELMIX.LE.0.0) MU=1.0E-5                                        TRANSP     51
C     CARD OMITTED                                                       TRANSP     52
      GO TO 450                                                          TRANSP     53
  400 MU=1.0E-5                                                          TRANSP     54
  450 CP=0.0                                                             TRANSP     55
      DO 600 I=1,NDS                                                     TRANSP     56
      CPS(I)=0.0                                                         TRANSP     57
      DO 500 J=1,NN                                                      TRANSP     58
  500 CPS(I)=CPS(I)+FLOAT(J-2)*A(I,J)*TT**(J-3)                          TRANSP     59
      IF (LL .LT. 0) GO TO 550                                           TRANSP     60
      CP=CP+CPS(I)*CABAR(I)                                              TRANSP     61
      GO TO 600                                                          TRANSP     62
  550 CP=CP+CPS(I)*C(I,KKK)                                              TRANSP     63
  600 CONTINUE                                                           TRANSP     64
      KAY=CP*MU/TPR                                                      TRANSP     65
      IF (IBUGSH.NE.0)                                                   TRANSP     66
     1WRITE(6,702) CP,KAY,RHABAR                                         TRANSP     67
      IF (LL .LT. 0) GO TO 650                                           TRANSP     68
      DIH(1,2)=KAY*TLE/(RHABAR*CP)                                       TRANSP     69
      GO TO 10000                                                        TRANSP     70
  650 DIH(1,2)=KAY*TLE/(RHO(KKK)*CP)                                     TRANSP     71
   11 FORMAT(1H ,6HPUMAX=,1PE9.2,2X,6HPUMIN,E9.2,2X,7HDELMIX=,E9.2,2X    TRANSP     72
     1 ,3HMU=,E9.2,2X,4HRHO=,E9.2,2X,2HU=,E9.2,2X,7HRHABAR=,E9.2)        TRANSP     73
  702 FORMAT(1H ,3HCP=,1PE9.2,2X,4HKAY=,E9.2,2X,7HRHABAR=,E9.2)          TRANSP     74
10000 RETURN                                                             TRANSP     75
      END                                                                TRANSP     76
      SUBROUTINE VISCO                                                   VISCO       2
C     THIS SUBROUTINE CALCULATES THE FLUX CONTRIBUTIONS TO THE           VISCO       3
C     CONSERVATION EQUATIONS                                             VISCO       4
      COMMON A(20,7)    ,AA(30)     ,ALFA(20,20),ALPHAH     ,ALPHAP      A           2
     1      ,ATOL       ,BETAP      ,BMIX       ,C11(20)    ,C(20,30)    A           3
     2      ,C12(20)    ,C2(20,30)  ,CABAR(20)  ,CBBAR(20)  ,CP          A           4
     3      ,CPS(20)    ,CPSH       ,CSH(20)    ,CSH1(20)   ,CSTREM(20)  A           5
     4      ,MXSTRM     ,D2IH(20,20),DEFF(25)   ,D2EFF(20)  ,DELTA       A           6
     5      ,D11        ,DELSS(30)  ,DELS       ,DELSO      ,DLS(30)     A           7
     6      ,DIH(20,20) ,D12        ,DELY(30)   ,D13        ,DPDY(30)    A           8
     7      ,D14        ,DPHIDS(30) ,EPCON                               A           9
     8      ,EPSLON     ,EXTRA(20)  ,FSTEP      ,FMAX       ,GRAD        A          10
     9      ,H11        ,H(30)      ,HH         ,HJ         ,HPM(20)     A          11
     *      ,H2PM(20)   ,H3PM(20)   ,ICONST     ,ICOUNT     ,IDENT(20)   A          12
     1      ,IERROR     ,IEXTRA(20) ,IFLAG      ,IKIND      ,ISB         A          13
     2      ,IPTUC      ,ISHOCK     ,ITYPE      ,IPD                     A          14
     3      ,IDIFF      ,K          ,KAY        ,KAYS       ,KAY2        A          15
     4      ,KLO        ,KMAX       ,KMN                                 A          16
     5      ,KUP        ,KW         ,LL         ,LPLANE     ,MA          A          17
     6      ,MASH       ,MDOT       ,MMAX       ,MU0        ,MU          A          18
     7      ,MU2        ,MUS        ,MW         ,MW2        ,MWSH        A          19
     8      ,NBOUND     ,NDS        ,NITER      ,NMAX       ,NN          A          20
      COMMON NUCASE     ,OMEGA(20)  ,P11        ,P(30)      ,P12         A          21
     1      ,P2(30)                 ,PB(25)     ,PABAR      ,PBBAR       A          22
     2      ,PBS        ,P15        ,PHI(40)                ,PHIB(25)    A          23
     3      ,PHISH1     ,PHSTRM                 ,PHIW(25)   ,P18         A          24
     4      ,PHI2(30)   ,PHIBS      ,PI         ,PR(20)     ,PSH         A          25
     5      ,PSH1       ,PSI        ,PSTREM                 ,PW(25)      A          26
     6      ,Q11        ,Q(30)      ,QXTR1      ,QXTR2                   A          27
     7      ,QW(25)     ,R11        ,R(30)                  ,RB(25)      A          28
     8      ,RBS        ,R13        ,RBAR(30)   ,R14        ,R2(30)      A          29
     9      ,RCON       ,R15        ,RE(30)     ,RESH       ,R16         A          30
     *      ,RHO(30)    ,R17        ,RHO2(30)   ,RHS(20)    ,RHSEN       A          31
     1      ,RHSMOM     ,RHABAR     ,RHBBAR     ,RU         ,RSH         A          32
     2      ,RSTREM     ,RV         ,R19        ,RW(25)     ,S           A          33
     3                  ,SB(25)     ,SC(20)                 ,SW(25)      A          34
     4      ,S13        ,SX(30)     ,T11        ,T(30)      ,T12         A          35
     5      ,T2(30)     ,TABAR      ,TBBAR      ,T0(20)     ,T14         A          36
     6      ,TAW(30)    ,TXTR1      ,TXTR2      ,TOL        ,TSH         A          37
     7      ,TSH1       ,TSTREM                 ,TW(25)     ,TWS         A          38
     8      ,TS         ,U11        ,U(30)      ,U12        ,U2(30)      A          39
      COMMON UXTR1      ,UXTR2      ,U14        ,UBAR(30)   ,USH         A          40
     1      ,USH1       ,USTREM                 ,UW(25)     ,UWS         A          41
     2      ,X11        ,X(30)      ,X12        ,X2(30)                  A          42
     3      ,XB(25)     ,XBS        ,XABAR(20)  ,XBBAR(20)  ,X15         A          43
     4      ,XS(20,30)  ,XSH        ,XSTREM                 ,XW(25)      A          44
     5      ,ZMWK(30)               ,Y11        ,Y(30)      ,Y12         A          45
     6      ,Y2(30)     ,YABAR      ,YBBAR      ,ZA(20)     ,Z11(20)     A          46
     7      ,ZJ(20,30)  ,ZMW        ,S2X        ,R2SH       ,X2SH        A          47
     8      ,FX(2,30)   ,FR(2,30)   ,FPHI(2,30) ,FP(2,30)   ,FT(2,30)    A          48
     9      ,FU(2,30)   ,INDL(2,30) ,INDR(2,30) ,FC(2,30,20),CARD1       A          49
     *      ,M          ,N          ,PAR(10)                             11AUG       1
      REAL   KAY        ,KAYS(20)   ,KAY2       ,KW         ,MDOT(30)    VISCO       6
     *      ,MA(30)     ,MU         ,MUS(20)    ,MU0(20)    ,MU2         VISCO       7
     *      ,MW(20)     ,MW2        ,MASH       ,MASH1      ,MWSH        VISCO       8
     * ,      MAP                                                        VISCO       9
      IF (P(K)) 100,400,400                                              VISCO      10
  100 WRITE (6,150)                                                      VISCO      11
  150 FORMAT(28H1NEGATIVE PRESSURE IN VISCO. )                           VISCO      12
      CALL PDUMP(A(1,1),N,1)                                             VISCO      13
  400 CALL FLUX                                                          VISCO      14
  500 IF (IFLAG) 600,700,600                                             VISCO      15
  600 RBAR(K)=.5*(R(K)+R2(K))                                            VISCO      16
      GO TO 800                                                          VISCO      17
  700 RBAR(K)=R(K)                                                       VISCO      18
 800  IF(RBAR(K-1))901,1000,900                                          21OCT       7
 901  WRITE(6,902)RBAR(K-1),K,DELTA                                      21OCT       8
      STOP                                                               21OCT       9
 902  FORMAT(20H IN VISCO RBAR(K-1)=,E16.8,3H K=,I5,7H DELTA=,E16.8)     21OCT      10
  900 DUMM=RBAR(K-1)**DELTA                                              VISCO      20
      GO TO 1200                                                         VISCO      21
 1000 IF (DELTA) 900,1100,900                                            VISCO      22
 1100 DUMM=1.0                                                           VISCO      23
C     MOMENTUM TRANSFER                                                  VISCO      24
 1200 RHSMOM=(RBAR(K)**DELTA*TAW(K)*DLS(K)-DUMM*TAW(K-1)*DLS(K-1))       VISCO      25
     **PI*2.0**DELTA                                                     VISCO      26
C     KINETIC ENERGY TRANSFER                                            VISCO      27
      IF (K-2) 1300,1300,1400                                            VISCO      28
 1300 DSSPTN=RBAR(K)**DELTA*TAW(K)*(UBAR(K)+UBAR(K+1))/2.0*DLS(K)-DUMM*T VISCO      29
     *AW(K)*UWS*DLS(K-1)                                                 VISCO      30
      GO TO 1500                                                         VISCO      31
 1400 DSSPTN=RBAR(K)**DELTA*TAW(K)*(UBAR(K)+UBAR(K+1))/2.0*DLS(K)-DUMM*T VISCO      32
     *AW(K-1)*(UBAR(K)+UBAR(K-1))/2.0*DLS(K-1)                           VISCO      33
C     ENERGY TRANSFER BY DIFFUSION                                       VISCO      34
 1500 DFFLX=0.0                                                          VISCO      35
      DO 1700 I=1,NDS                                                    VISCO      36
      H3PM(I)=H2PM(I)                                                    VISCO      37
      H2PM(I)=HPM(I)                                                     VISCO      38
      HPM(I)=0.0                                                         VISCO      39
      IF(K+1-KMAX)1550,1650,1650                                         VISCO      40
 1550 IF (IFLAG) 1570,1560,1570                                          VISCO      41
 1560 HPM(I)=CPS(I)*T(K+1)                                               VISCO      42
      GO TO 1650                                                         VISCO      43
 1570 HPM(I)=CPS(I)*.5*(T(K+1)+T2(K+1))                                  VISCO      44
 1650 DFFLX=DFFLX+.5*RBAR(K)**DELTA*ZJ(I,K)*DLS(K)*(HPM(I)+H2PM(I))      VISCO      45
     *-.5*DUMM*ZJ(I,K-1)*DLS(K-1)*(H2PM(I)+H3PM(I))                      VISCO      46
C   SPECIES TRANSFER                                                     VISCO      47
 1700 RHS(I)=(RBAR(K)**DELTA*ZJ(I,K)*DLS(K)-DUMM*ZJ(I,K-1)*DLS(K-1))*PI  VISCO      48
     **2.0**DELTA                                                        VISCO      49
C   TOTAL ENERGY TRANSFER                                                VISCO      50
      RHSEN=(DFFLX+DSSPTN/HJ+RBAR(K)**DELTA*Q(K)*DLS(K)-DUMM*Q(K-1)*DLS( VISCO      51
     *K-1))*PI*2.0**DELTA                                                VISCO      52
10000 RETURN                                                             VISCO      53
      END                                                                VISCO      54
CQ%%A/
